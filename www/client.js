!function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){!function(){n(52),Scrimbla=n(37);var t=n(6).App;return APP=new t,APP.schedule(),n(19),q$("._page").map(function(t){return t}),q$(".awaken").map(function(t){return t})}()},function(t,e,n){!function(){function t(t){return/^[\n\t\ ]+$/.test(t)}function r(t,e){if(t instanceof Array){var n=t.slice();return n.reduce(function(t,e,n){return r(t,e)},n.shift())}if(!t||!e)return t||e;for(t=t._dom||t,e=e._dom||e;!t.contains(e);)t=t.parentNode;for(;!e.contains(t);)e=e.parentNode;return tag$wrap(t)}function i(t,e,n){return n||(n=d[e]),"'"==e&&(t=t.replace(/\'/g,"\\'")),(e||"")+t+(n||"")}function o(t){for(var e,n,r="[{(\"'",i="]})\"'",o=[],s=0;e=t[s++];){var a=r.indexOf(e);e==n?(o.pop(),n=o[o.length-1]):a>=0&&o.push(n=i[a])}return 0==o.length?!0:!1}function s(t,e,n){void 0===n&&(n=4);var r,i=0,o=0;if(0==e)return 0;for(;r=t[i++];){if("	"==r){var s=n-o%n;o+=s}else o+=1;if(o>=e)return i}return t.length}function a(t,e,n){void 0===n&&(n=4);var r,i=0,o=0;if(0==e)return 0;for(;r=t[i++];){if("	"==r){var s=n-o%n;if(s>3&&o+2>=e)break;o+=s}else o+=1;if(o>=e)break}return o}function u(t,e){void 0===e&&(e=4);for(var n,r=0,i=0;n=t[i++];)if("	"==n){var o=e-r%e;r+=o}else r+=1;return r}function h(t,e,n){void 0===n&&(n=4),t=t.toString();for(var r,i=e,o=0,s=0;(r=t[i-1])&&"\n"!=r;)i--;for(;e>i&&(r=t[i]);){if("	"==r){var a=n-o%n;o+=a}else o+=1;i++}for(;r=t[i-1];)"\n"==r&&s++,i--;return[s,o]}function c(t){var e=/^(\s*(.*\=\s*)?(export |global |extend )?(class|def|tag|unless|if|else|elif|switch|try|catch|finally|for|while|until|do))/,n=/\b(do)\b/;return e.test(t)||n.test(t)}function p(t,e){return new Array(e+1).join(t)}function l(t,e,n){var r,i=t.toString();return"append"==n?i+e:"prepend"==n?""+e+i:(r=f.normalize(n))?i.substr(0,r.start())+e+i.slice(r.end()):void 0}var f=n(2).Region;e.isWhitespace=t,e.commonAncestor=r;var d={'"':'"',"'":"'","(":")","<":">","[":"]","{":"}"};return e.wrapText=i,e.stringIsBalanced=o,e.colToLoc=s,e.colToViewCol=a,e.colsForLine=u,e.rowcol=h,e.increaseIndent=c,e.repeatString=p,e.patchString=l,l}()},function(t,e){!function(){function t(t){return t?t.toArray?t.toArray():t:[]}function n(t,e,n,r){return this._a=t,this._b=e,this._root=n,this._view=r,this}return e.Region=n,n.prototype.a=function(t){return this._a},n.prototype.setA=function(t){return this._a=t,this},n.prototype.b=function(t){return this._b},n.prototype.setB=function(t){return this._b=t,this},n.prototype.view=function(t){return this._view},n.prototype.setView=function(t){return this._view=t,this},n.prototype.root=function(t){return this._root},n.prototype.setRoot=function(t){return this._root=t,this},n.normalize=function(e,r){var i;if(e instanceof n)return e;if(e instanceof Array)return new n(e[0],e[1],null,r);if("number"==typeof e||e instanceof Number)return new n(e,e,null,r);if(e instanceof Object&&("number"==typeof(i=e.line)||i instanceof Number)){for(var o=r._buffer.lines(),s=0,a=0,u=t(o),h=u.length;h>a&&a<e.line-1;a++)s+=u[a].length+1;return s+=e.column||0,new n(s,s,null,r)}},n.prototype.start=function(){return Math.min(this._a,this._b)},n.prototype.end=function(){return Math.max(this._a,this._b)},n.prototype.clone=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),new n(this._a+t,this._b+e,this._root,this._view)},n.prototype.contains=function(t){return t instanceof n?this.start()<=t.start()&&this.end()>=t.end():"number"==typeof t||t instanceof Number?this.start()<=t&&this.end()>=t:void 0},n.prototype.adjust=function(t,e){return void 0===e&&(e=!0),t.end()<this.start()&&(e?this.move(t.size()):this.move(-t.size())),this},n.prototype.intersects=function(t){t=n.normalize(t);var e=Math.max(this.start(),t.start()),r=Math.min(this.end(),t.end());return r>=e},n.prototype.relativeTo=function(t){return new n(this._a-t.start(),this._b-t.start(),this._root,this._view)},n.prototype.intersection=function(t){return this},n.prototype.equals=function(t){return this.start()==t.start()&&this.end()==t.end()},n.prototype.same=function(t){return t&&t.a()==this.a()&&t.b()==this.b()},n.prototype.size=function(){return this.end()-this.start()},n.prototype.move=function(t){return void 0===t&&(t=1),this._a+=t,this._b+=t,this},n.prototype.collapsed=function(){return 0==this.size()},n.prototype.reverse=function(){var t=this._a,e=this._b;return this._a=e,this._b=t,this},n.prototype.reversed=function(){return this._a>this._b},n.prototype.normalize=function(){var t=this.start(),e=this.end();return this._a=t,this._b=e,this},n.prototype.collapse=function(t){return void 0===t&&(t=!0),t?this._a=this._b=this.end():(this._b=this._a,this._a=this._b=this.start()),this},n.prototype.expand=function(t,e){return this.b()<this.a()?(this._b+=t,this._a+=e):(this._a+=t,this._b+=e),this},n.prototype.text=function(){return this.view().substr(this)},n.prototype.toString=function(){return"["+this._a+","+this._b+"]"},n.prototype.insert=function(t){return this},n.prototype.nodes=function(t){return void 0===t&&(t=!0),this.view().nodesInRegion(this,t)},n.prototype.prevNode=function(t){var e=this.nodes(!1),n=e.lft;if(t instanceof Imba.Selector||"string"==typeof t||t instanceof String){for(var r;n;){if(n.matches(t))return n;n=(r=n)&&r.isLast&&r.isLast()?n.parent():null}return null}return n},n.prototype.nextNode=function(t){var e=this.nodes(!1),n=e.rgt;if(t instanceof Imba.Selector||"string"==typeof t||t instanceof String){for(var r;n;){if(n.matches(t))return n;n=(r=n)&&r.isFirst&&r.isFirst()?n.parent():null}return null}return n},n.prototype.scope=function(t){var e,n=this.nodes(!1);return n.lft?e=n.lft.up(t):n.rgt?e||(e=n.rgt.up(t)):n[0]&&(e||(e=n[0].node.closest(t))),e},n.prototype.buffer=function(){return this._root.code()},n.prototype.startAtLine=function(){this.normalize();var t=this.buffer(),e=this.start();for("\n"==t[e]&&0==this.size()&&e--;e>=0&&"\n"!=t[e];)e--;return this._a=e,this},n.prototype.endAtLine=function(){this.normalize();for(var t=this.buffer(),e=this.end()-1;e>=0&&t[e]&&"\n"!=t[e];)e++;return this._b=e,this},n.prototype.cell=function(){return this.view()._buffer.locToCell(this.a())},n.prototype.row=function(){return this.cell()[0]},n.prototype.col=function(){return this.cell()[1]},n.prototype.peekbehind=function(t){return void 0===t&&(t=1),1==t?this.buffer()[this.start()-1]:this.buffer().substring(this.start()-t,this.start())},n.prototype.peekahead=function(t){return void 0===t&&(t=1),1==t?this.buffer()[this.end()]:this.buffer().substr(this.end(),t)},n.prototype.indent=function(){return this.clone().startAtLine().text().match(/^\n?(\t*)/)[1]},n.prototype.peek=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),this.clone(t,e).text()},n.prototype.lloc=function(){return{startLine:0,startCol:2}},n.prototype.toJSON=function(){return[this.a(),this.b()]},n}()},function(t,e,n){(function(t){!function(){function r(t){return t?t.toArray?t.toArray():t:[]}function i(){return this._stack=[],this}function o(t,e,n,r,i){return this._type=t,this._value=e,this._meta=null,this._line=n||0,this._col=-1,this._loc=r||0,this._len=i||0,this.generated=!1,this.newLine=!1,this.spaced=!1,this}function s(t,e,n,r){var i;return void 0===r&&(r={}),this._code=t,this._tokens=e,this._ast=n,r.render||(r.render={}),r.hl||(r.hl={}),(i=r.hl).newline||(i.newline='<b class="_n">\n</b>'),this._options=r,this._options.nextVarCounter||(this._options.nextVarCounter=0),this._varRefs={},"full"!=r.mode||n||(this._ast=Imbac.parse(this._tokens,{})),this}var a=n(26).Lexer,u=n(1),h="b",c=["null","this","delete","typeof","in","instanceof","throw","break","continue","debugger","if","else","switch","for","while","do","try","catch","finally","class","extends","super","return","undefined","then","unless","until","loop","of","by","when","def","tag","do","elif","begin","var","let","self","await","import","and","or","is","isnt","not","isa","case","nil"],p={"+":"_imop op add math","++":"_imop op incr math","--":"_imop op decr math","-":"_imop op sub math","=":"_imop op eq","/":"_imop op div math","*":"_imop op mult math","?":"_imop op ternary",",":"_imop op comma",":":"_imop op colon",".":"_imop op dot",".:":"_imop op cdot","!":"_imop op unary","?.":"_imop op qdot","[":"_imopen sb sbl","]":"_imclose sb sbr","(":"_imopen rb rbl",")":"_imclose rb rbr","{":"_imopen cb cbl","}":"_imclose cb cbr","#":"_imop op hash",call_start:"_imopen call rb rbl",call_end:"_imclose call rb rbr",tag_start:"_imopen tag_open",tag_end:"_imclose tag_close","true":"_imbool true",yes:"_imbool true","false":"_imbool false",no:"_imbool false","{{":"_imopen","}}":"_imclose",'"':"doublequote","'":"singlequote",regex:"_imregex regex",identifier:"_imtok _imidentifier identifier",compound_assign:"op assign compound",str:"_imstr string",num:"_imnum number",string:"_imstr string",number:"_imnum number",math:"_imop op math",unary:"_imop op unary",forin:"keyword in",forof:"keyword of",own:"keyword own",compare:"_imop op compare",herecomment:"_herecomment",relation:"keyword relation","export":"keyword export",global:"keyword global",extern:"keyword global",extend:"keyword extend",require:"keyword require",from:"keyword from",logic:"keyword logic",post_if:"keyword if post_if",post_for:"keyword for post_for",prop:"keyword prop",attr:"keyword attr",selector_start:"_imopen _imselopen selector_start",selector_end:"_imclose _imselclose selector_end",index_start:"_imopen index_start",index_end:"_imclose index_end",block_param_start:"_imopen",block_param_end:"_imclose",string_start:"_imstrstart string_start",string_end:"_imstrend string_end",neostring:"_imtok _imneostring"},l="_imistring",f={tag_start:"_imtagnode tagnode",call_start:"_imparens call",selector_start:"_imsel selector",string_start:"_imistring",index_start:"index",block_param_start:"_impair _imblockparams","(":"_imparens paren","{{":"_imiexpr","{":"_imcurly curly","[":"_imsquare square",'("':"_imistring"},d={tag_end:"tag",call_end:"_imparens call",string_end:"_imistring",selector_end:"sel",index_end:"index",block_param_end:"_impair _imblockparams","}}":"_imiexpr",")":"paren","]":"square","}":"curly",'")':"string"},g=("+ - * / = ++ -- == === != !== > < >= <= & && | || or . : ?".split(" "),{newline:"<b class='_imnewline'>\n</b>",space:function(t){return"<b class='_imspace'>"+t+"</b>"},tab:function(t){return new Array(t.length+1).join("<b class='_imtab'>	</b>")}});return i.prototype.push=function(t){return this._stack.push(t),this._current=t,this},i.prototype.pop=function(){var t=this._stack.pop();return this._current=this._stack[t-1],this},i.prototype.toString=function(){return this._current},e.Token=o,o.prototype.type=function(){return this._type},o.prototype.value=function(){return this._value},o.prototype.loc=function(){return this._loc},o.prototype.len=function(){return this._len},e.Highlighter=s,s.Mapping=p,s.logger=function(){return VIEW.logger()},s.tokenize=function(e,n){return void 0===n&&(n={}),t.Imbac?Imbac.tokenize(e,n):(this._lexer||(this._lexer=new a),this._lexer.reset(),this._lexer.tokenize(e,n))},s.reclassify=function(t,e,n,r,i){e=e.toLowerCase();var o=IM.Types[e]||Imba.TAGS["im"+e]||IM.Types.token,s=tag$wrap(t);return s instanceof o?s.reuse(n,r,i):(o&&(s=new o(t).setup(n,r,i)),s)},s.nestTokens=function(t,e){for(var n,r,i,s,a,u={TAG_START:"TAG_END",SELECTOR_START:"SELECTOR_END",CALL_START:"CALL_END",INDEX_START:"INDEX_END",STRING_START:"STRING_END",BLOCK_PARAM_START:"BLOCK_PARAM_END","{{":"}}","{":"}","[":"]","(":")"},h={TAG_START:"tagnode",SELECTOR_START:"selector",STRING_START:"istring",CALL_START:"parens",INDEX_START:"square",BLOCK_PARAM_START:"blockparams","{{":"iexpr","{":"curly","[":"square","(":"parens"},c=0,p={_loc:0,_offset:0,_children:[]},l=[p],f=[],e=0;a=t[c++];){n=a._loc,r=a._value,i=a._type,"IDENTIFIER"!=i||"prop"!=r&&"attr"!=r||(i=a._type="KEYWORD"),"INDEX_START"==i&&(i=a._type="["),"INDEX_END"==i&&(i=a._type="]"),"CALL_START"==i&&(i=a._type="("),"CALL_END"==i&&(i=a._type=")"),s=l[l.length-1],n-=s._offset;var d=u[i];if(d){var g=new o(h[i],"",-1,n);g._offset=s._offset+n,e+=n,g._children=[],f.push(d),l.push(g),s._children.push(g),s=g}a._loc-=s._offset,a._len>=1&&(s._children.push(a),s._len=a._loc+a._len),f[f.length-1]==i&&(f.pop(),s._len=a._loc+a._len,l.pop())}return p._children},s.normalizeTokens=function(t,e,n){void 0===n&&(n=0);for(var r,s,a,u,h=0,c=0,p=[],l=0,f=new i,d=function(){for(var e=null;l>c;){var n=t[c];if("	"==n)e=new o("tab",n,-1,c,1);else if("\n"==n)e=new o("newline",n,-1,c,1);else if(";"==n)e=new o("semicolon",n,-1,c,1);else if(" "==n){if(e&&"whitespace"==e._type){e._value+=" ",e._len+=1,c++;continue}e=new o("whitespace",n,-1,c,1)}else{if("#"==n){for(var r=c,i="";l>c&&"\n"!=t[c];)i+=t[c],c++;p.push(new o("comment",i,-1,r,i.length));continue}e=null}c++,e&&p.push(e)}},g=["TERMINATOR","INDENT","OUTDENT"," "," 	"];r=e[h++];)s=e[h],l=r._loc,u=r._value,a=r._type,"#"==a&&s&&"IDENTIFIER"==s._type&&(s._type="IDREF"),"("==a&&'("'==u&&f.push(u),g.indexOf(a)>=0||(l>c&&d(),c=r._loc+r._len,p.push(r));return l=t.length,d(),p=this.nestTokens(p)},s.whitespaceToTokens=function(t){for(var e,n=[],r=0,i=t.length;i>r;){var s=r,a=t[r++];if("	"==a)n.push(e=new o("tab",a,-1,s,1));else if("\n"==a)n.push(e=new o("newline",a,-1,s,1));else if(" "==a){if(e&&"whitespace"==e._type){e._value+=" ",e._len+=1;continue}n.push(e=new o("whitespace",a,-1,s,1))}}return n},s.reparse=function(t){var e;if(t instanceof Element){var n=tag$wrap(t);return void(n&&(e=n)&&e.mutated&&e.mutated())}var r=t.nodes,i=t.code,o=t.tokens;this.logger().groupCollapsed("reparse %s",JSON.stringify(i)),u.isWhitespace(i)&&!o&&(console.log("using whitespaceToTokens"),o=this.whitespaceToTokens(i)),o||(o=this.tokenize(i+" ",{inline:!0,silent:!0,rewrite:!1}),o=this.normalizeTokens(i,o),this.logger().log(o.slice())),this.logger().log(r.slice()),this.applyTokens(i,o,r,t.nested,t.parent),this.logger().groupEnd()},s.applyTokens=function(t,e,n,i,o){for(var s,a,u,c=this,p=function(t,e,n){c.logger().log("addNode",e);var r=document.createElement(h);return n?n.nextSibling?n.parentNode.insertBefore(r,n.nextSibling):n.parentNode&&n.parentNode.appendChild(r):o&&o.appendChild(r),t.splice(e,0,r),r},l=function(t,e){c.logger().log("removeNode",e);var n=t[e];return n&&n.parentNode&&n.parentNode.removeChild(n),t.splice(e,1)},f=0,d=0,g=r(n),m=g.length;m>d;d++)u=g[d],u._loc=f,f+=u._len=u.textContent.length;for(var y,d=0,g=r(e),m=g.length;m>d;d++){y=g[d],s=n[d];var _=y._loc;for(f=s&&s._loc;s&&0==s._len;)c.logger().log("remove node because it is empty",s),l(n,d),s=n[d];if(s?f>_?s=p(n,d,a):_>f&&(l(n,d),s=n[d]):s=p(n,d,a),s||(s=p(n,d,a)),"STRING"==y._type&&y._value.match(/\§{3}/)&&i)i.pop(),a=s;else{var v=t.substr(_,y._len),b=s.textContent,T=c.reclassify(s,y._type,y,v,b);if(y._children){var $=s.children;if($.length&&$.length==s.childNodes.length)c.logger().log("reuse the cnodes(!)",$),$=Array.prototype.slice.call($);else{c.logger().log("wrong length");for(var I=0,w=r(s.childNodes),A=w.length;A>I;I++)c.logger().log(w[I]);s.innerHTML="",$=[]}c.applyTokens(v,y._children,$,i,s)}else b!=v&&(s.textContent=v,T.reparsed(v,b));a=s}}for(;n.length>e.length;)s=n.pop(),s.parentNode&&s.parentNode.removeChild(s);return c},s.highlight=function(t,e){void 0===e&&(e={}),e.hl||(e.hl=g);var n=e.tokens||null;if(!n)try{n="full"==e.mode?this.tokenize(t,{}):this.tokenize(t,{inline:!0,silent:!0,rewrite:!1})}catch(r){r._options&&(n=r._options.tokens)}var i=new this(t,n,null,e);return i.process()},s.prototype.options=function(t){return this._options},s.prototype.setOptions=function(t){return this._options=t,this},s.prototype.varRef=function(t){var e,n=this._options.nested,r=n?"i":"";return this._varRefs[e=t._ref]||(this._varRefs[e]=r+this._options.nextVarCounter++)},s.prototype.parseWhitespace=function(t){var e=this,n=this._options.hl,r=[];return t=t.replace(/(\#)([^\n]*)/g,function(t,n,i){e._options.render.comment&&(t=e._options.render.comment("comment",t));var o=r.push("<"+h+" class='_im _imcomment'>"+t+"</"+h+">");return"$"+(o-1)+"$"}),t=t.replace(/(\n|[ ]+|[\t]+)/g,function(t,e){return"\n"==e?n.newline||"\n":" "==e[0]?n.space instanceof Function?n.space(e):e:"	"==e[0]?n.tab instanceof Function?n.tab(e):e:void 0}),r.length&&(t=t.replace(/\$(\d+)\$/g,function(t,e){return r[parseInt(e)]})),t},s.prototype.process=function(){var t,e=this.options(),n=this._code,r=this._tokens.length,i=[],o=0,s=null,a=function(t){return i.push(t),o=i.length,s=i[o-1]},u=function(t){return i.pop(),o=i.length,s=i[o-1]};if(this._ast&&this._ast.analyze)try{this._ast.analyze({})}catch(g){}var m="";r=0;for(var y,_,v=0;t=this._tokens[r++];){this._tokens[r];_&&(e.inner&&1==o||(m+="</"+h+">"),_=null,u());var b=t._type.toLowerCase(),T=t._loc,$=(t._value,t._len),I=t._meta,w="";if(T>v){var A=n.substring(v,T);s!=l&&(A=this.parseWhitespace(A)),m+=A,v=T}if(_=d[b],(y=f[b])&&(a(y),e.inner&&1==o||(m+="<"+h+" class='"+y+"'>")),0!=$&&"terminator"!=b&&"indent"!=b&&"outdent"!=b&&!(-1==t._col&&t._loc<=0)){var k=h,E=n.substr(T,$);"const"==b&&"require"==E&&(b="require");var x=p[b]||b;if(x instanceof Array&&(k=x[0],x=x[1]),x=x.split(" "),c.indexOf(b)>=0&&x.unshift("keyword"),v=T+$,"identifier"==b&&("#"==E[0]&&x.push("idref"),I&&"ACCESS"==I.type&&x.push("access"),"log"==E&&x.push("log")),t._variable){x.push("lvar");var S=this.varRef(t._variable);w+=" eref='v"+S+"'"}if("herecomment"==b){var R="<"+h+">###</"+h+">";E=R+E.slice(3,-3)+R}"string"==b&&E.match(/^['"]?\.?\.\//)&&x.push("pathname");var C=x.join(" ");C.match(/\b\_/)||(C="_imtok "+C),m+="<"+k+" class='"+C+"'"+w+">"+E+("</"+k+">")}}return _&&(m+="</"+h+">",_=null),v<n.length-1&&(A=n.slice(v),s!=l&&(A=this.parseWhitespace(A)),m+=A),0==this._tokens.length&&(m=this._code),m},s}()}).call(e,function(){return this}())},function(t,e){function n(t,e,n){if(e in t)return t[e];if(3===arguments.length)return n;throw new Error('"'+e+'" is a required argument.')}function r(t){var e=t.match(d);return e?{scheme:e[1],auth:e[2],host:e[3],port:e[4],path:e[5]}:null}function i(t){var e="";return t.scheme&&(e+=t.scheme+":"),e+="//",t.auth&&(e+=t.auth+"@"),t.host&&(e+=t.host),t.port&&(e+=":"+t.port),t.path&&(e+=t.path),e}function o(t){var n=t,o=r(t);if(o){if(!o.path)return t;n=o.path}for(var s,a=e.isAbsolute(n),u=n.split(/\/+/),h=0,c=u.length-1;c>=0;c--)s=u[c],"."===s?u.splice(c,1):".."===s?h++:h>0&&(""===s?(u.splice(c+1,h),h=0):(u.splice(c,2),h--));return n=u.join("/"),""===n&&(n=a?"/":"."),o?(o.path=n,i(o)):n}function s(t,e){""===t&&(t="."),""===e&&(e=".");var n=r(e),s=r(t);if(s&&(t=s.path||"/"),n&&!n.scheme)return s&&(n.scheme=s.scheme),i(n);if(n||e.match(g))return e;if(s&&!s.host&&!s.path)return s.host=e,i(s);var a="/"===e.charAt(0)?e:o(t.replace(/\/+$/,"")+"/"+e);return s?(s.path=a,i(s)):a}function a(t,e){""===t&&(t="."),t=t.replace(/\/$/,"");for(var n=0;0!==e.indexOf(t+"/");){var r=t.lastIndexOf("/");if(0>r)return e;if(t=t.slice(0,r),t.match(/^([^\/]+:\/)?\/*$/))return e;++n}return Array(n+1).join("../")+e.substr(t.length+1)}function u(t){return"$"+t}function h(t){return t.substr(1)}function c(t,e,n){var r=t.source-e.source;return 0!==r?r:(r=t.originalLine-e.originalLine,0!==r?r:(r=t.originalColumn-e.originalColumn,0!==r||n?r:(r=t.generatedColumn-e.generatedColumn,0!==r?r:(r=t.generatedLine-e.generatedLine,0!==r?r:t.name-e.name))))}function p(t,e,n){var r=t.generatedLine-e.generatedLine;return 0!==r?r:(r=t.generatedColumn-e.generatedColumn,0!==r||n?r:(r=t.source-e.source,0!==r?r:(r=t.originalLine-e.originalLine,0!==r?r:(r=t.originalColumn-e.originalColumn,0!==r?r:t.name-e.name))))}function l(t,e){return t===e?0:t>e?1:-1}function f(t,e){var n=t.generatedLine-e.generatedLine;return 0!==n?n:(n=t.generatedColumn-e.generatedColumn,0!==n?n:(n=l(t.source,e.source),0!==n?n:(n=t.originalLine-e.originalLine,0!==n?n:(n=t.originalColumn-e.originalColumn,0!==n?n:l(t.name,e.name)))))}e.getArg=n;var d=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/,g=/^data:.+\,.+$/;e.urlParse=r,e.urlGenerate=i,e.normalize=o,e.join=s,e.isAbsolute=function(t){return"/"===t.charAt(0)||!!t.match(d)},e.relative=a,e.toSetString=u,e.fromSetString=h,e.compareByOriginalPositions=c,e.compareByGeneratedPositionsDeflated=p,e.compareByGeneratedPositionsInflated=f},function(t,e){!function(){return tag$.defineTag("page",function(t){t.prototype.body=function(){return(this._body=this._body||tag$.$div().setRef("body",this)).setText("Content here").end()},t.prototype.nav=function(){return(this._nav=this._nav||tag$.$div().setRef("nav",this)).setText("Navigation here").end()},t.prototype.assemble=function(){return this.setChildren([this.nav(),this.body()],1).synced()},t.prototype.ready=function(){return!0},t.prototype.scoped=function(){return this},t.prototype.unscoped=function(){return this},t.prototype.render=function(){var t=this.router().scoped(this.route(),this);return t!=this._scoped&&(this._scoped=t,this._scoped?this.scoped():this.unscoped(),this.flag("scoped",t),this.flag("selected",this.router().match(this.route(),this))),t&&this.ready()?this.assemble():this},t.prototype.awaken=function(){return this.schedule({fps:1,events:!0})}})}()},function(t,e,n){!function(){function t(){this.setCache({}),this.setDeps({}),this.reset(),this.tick()}function r(t){this._path=t,this._ready=!1,this.fetch()}var i=n(7).Router;e.App=t,t.prototype.req=function(t){return this._req},t.prototype.setReq=function(t){return this._req=t,this},t.prototype.res=function(t){return this._res},t.prototype.setRes=function(t){return this._res=t,this},t.prototype.deps=function(t){return this._deps},t.prototype.setDeps=function(t){return this._deps=t,this},t.prototype.site=function(t){return this._site},t.prototype.setSite=function(t){return this._site=t,this},t.prototype.cache=function(t){return this._cache},t.prototype.setCache=function(t){return this._cache=t,this},t.prototype.issues=function(t){return this._issues},t.prototype.setIssues=function(t){return this._issues=t,this},t.prototype.reset=function(){return this.setCache({}),this},t.prototype.router=function(){return this._router||(this._router=new i(this))},t.prototype.path=function(){return this._path},t.prototype.hash=function(){return""},t.prototype.hash=function(){return document.location.hash.substr(1)},t.prototype.tick=function(){return this._path=document.location.pathname,this},t.prototype.schedule=function(){return Imba.schedule(this),this},t.prototype.unschedule=function(){return Imba.unschedule(this),this},t.prototype.fetchDocument=function(t,e){var n;if(DEPS[t])return e&&e(DEPS[t]),{then:function(t){return t(n)}};var r=new XMLHttpRequest;return r.addEventListener("load",function(n){return DEPS[t]=JSON.parse(r.responseText),e&&e(DEPS[t])}),r.open("GET",t),r.send(),this},t.prototype.issues=function(){return this._issues||(this._issues=r.get("/issues/all.json"))},e.Doc=r;return r.get=function(t){var e,n=APP.cache();return n[e="doc-"+t]||(n[e]=new this(t))},r.prototype.path=function(t){return this._path},r.prototype.setPath=function(t){return this._path=t,this},r.prototype.object=function(t){return this._object},r.prototype.setObject=function(t){return this._object=t,this},r.prototype.ready=function(){return this._ready},r.prototype.fetch=function(){var t=this;return t._promise||(t._promise=APP.fetchDocument(t._path,function(e){return t.load(e)}))},r.prototype.load=function(t){return this._object=t,this._meta=t.meta||{},this._ready=!0,Imba.emit(this,"ready"),Imba.Scheduler.markDirty(),this},r.prototype.title=function(){return this._object.title||"path"},r.prototype.toc=function(){return this._object&&this._object.toc[0]},r.prototype.body=function(){return this._object&&this._object.body},r}()},function(t,e){!function(){function t(t){var e=this;e._app=t,Imba.isClient()&&(window.onpopstate=function(t){return e.refresh(),Imba.setTimeout(0,function(){return!0})})}return e.Router=t,t.prototype.path=function(t){return this._path},t.prototype.setPath=function(t){return this._path=t,this},t.slug=function(t){t=t.replace(/^\s+|\s+$/g,"").toLowerCase();return t=t.replace(/[^a-z0-9 -]/g,""),t=t.replace(/\s+/g,"-"),t=t.replace(/-+/g,"-")},t.prototype.refresh=function(){return this},t.prototype.path=function(){return this._app.path()},t.prototype.hash=function(){return this._app.hash()},t.prototype.ext=function(){var t=this.path(),e=t.match(/\.([^\/]+)$/);return e&&e[1]||""},t.prototype.go=function(t,e,n){return void 0===e&&(e={}),void 0===n&&(n=!1),"/install"==t&&(t="/guides#toc-getting-started-installation"),n?history.replaceState(e,null,t):history.pushState(e,null,t),t.match(/\#/)||window.scrollTo(0,0),this},t.prototype.scoped=function(t,e){var n=this.path()+"#"+this.hash();if("string"==typeof t||t instanceof String){var r=n[t.length];return n.substr(0,t.length)==t&&(!r||"-"==r||"/"==r||"#"==r||"?"==r||"_"==r)}if(t instanceof RegExp){var i=n.match(t);return e&&i?i[e]:i}return!1},t.prototype.match=function(t,e){var n=this.path()+"#"+this.hash();if("string"==typeof t||t instanceof String)return n==t;if(t instanceof RegExp){var r=n.match(t);return e&&r?r[e]:r}return!1},t}()},function(t,e){!function(){function n(t,e,n,r){return this._type=t,this._value=e,this._loc=null!=n?n:-1,this._len=r||0,this._meta=null,this.generated=!1,this.newLine=!1,this.spaced=!1,this}function r(){var t,e=this.tokens[this.pos++];return e?(t=e._type,this.yytext=e):t="",t}function i(t,e){return new n(t,e,-1,0)}function o(t){return t._type}function s(t){return t._value}function a(t){return t._line}function u(t){return t._loc}function h(t,e){return t._type=e}function c(t,e){return t._value=e}function p(t,e){return t._line=e}function l(t,e){return t._loc=e}var f,d,g,m,y,_,v;t.exports.TOK=f={};var b=(f.TERMINATOR=1,f.IDENTIFIER=2);b=f.IVAR=2;f.CONST=3,f.VAR=4,f.IF=5,f.ELSE=6,f.DEF=7;return e.Token=n,n.prototype.type=function(){return this._type},n.prototype.value=function(){return this._value},n.prototype.traverse=function(){},n.prototype.c=function(){return""+this._value},n.prototype.toString=function(){return this._value},n.prototype.charAt=function(t){return this._value.charAt(t)},n.prototype.slice=function(t){return this._value.slice(t)},n.prototype.region=function(){return[this._loc,this._loc+(this._len||this._value.length)]},n.prototype.sourceMapMarker=function(){return-1==this._loc?":":"%$"+this._loc+"$%"},e.lex=r,e.token=i,e.typ=o,e.val=s,e.line=a,e.loc=u,e.setTyp=h,e.setVal=c,e.setLine=p,e.setLoc=l,t.exports.LBRACKET=d=new n("{","{",0,0,0),t.exports.RBRACKET=g=new n("}","}",0,0,0),t.exports.LPAREN=m=new n("(","(",0,0,0),t.exports.RPAREN=y=new n(")",")",0,0,0),d.generated=!0,g.generated=!0,m.generated=!0,y.generated=!0,t.exports.INDENT=_=new n("INDENT","2",0,0,0),t.exports.OUTDENT=v=new n("OUTDENT","2",0,0,0)}()},function(t,e){!function(){function t(t){return t?t.toArray?t.toArray():t:[]}function n(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=Object.create(e.prototype),t.__super__=t.prototype.__super__=e.prototype,t.prototype.initialize=t.prototype.constructor=t}function r(t){void 0===t&&(t={}),this._timestamp=new Date,this._data=t}function i(){return r.apply(this,arguments)}function o(){return r.apply(this,arguments)}function s(t){this._params=t}function a(){return s.apply(this,arguments)}function u(t){this._code=t[0]}function h(t){this._old=t[0],this._new=t[1]}function c(t){this._point=t[0],this._str=t[1]}function p(t){this._region=t[0],this._str=t[1]}function l(t){this._mode="normal",this._view=t,this._enabled=!0,this._active=!1,this.setCurrent(this._seed=new a)}r.prototype.data=function(t){return this._data},r.prototype.setData=function(t){return this._data=t,this},r.prototype.timestamp=function(t){return this._timestamp},r.prototype.setTimestamp=function(t){return this._timestamp=t,this},r.prototype.apply=function(t){return this},r.prototype.update=function(t){return this._data=t,this._timestamp=new Date,this},n(i,r),i.prototype.apply=function(t){return t.loadState(this._data),this},n(o,r);var f={};return s.prototype.prev=function(t){return this._prev},s.prototype.setPrev=function(t){return this._prev=t,this},s.prototype.next=function(t){return this._next},s.prototype.setNext=function(t){return this._next=t,this},s.prototype.frame=function(t){return this._frame},s.prototype.setFrame=function(t){return this._frame=t,this},s.sym=function(t){for(var e=arguments,n=e.length,r=new Array(n>1?n-1:0);n>1;)r[--n-1]=e[n];return this.prototype._symbol=t,this.prototype._signature=r,f[t]=this,this},s.load=function(t){var e=f[t[0]],n=t[1],r=e.build(t[2]);return r.setFrame(n),r},s.build=function(t){return new this(t)},s.prototype.data=function(){return this._data},s.prototype.params=function(){return this._params},s.prototype.undo=function(t){return this.prev()},s.prototype.redo=function(t){return this},s.prototype.enter=function(t){return this},s.prototype.remove=function(){var t;return this.prev()&&(this.prev().setNext(t=this.next()),t),this.next()&&(this.next().setPrev(t=this.prev()),t),this},s.prototype.toJSON=function(){return[this._symbol,this._frame||0,this.params()||[]]},n(a,s),a.sym("M","value"),n(u,a),u.sym("S","code"),u.prototype.params=function(){return[this._code]},u.prototype.redo=function(t){return console.log("load",this._code),t.load(this._code),this},n(h,s),h.sym("|","old","new"),h.load=function(t){return new this(t)},h.prototype.params=function(){return[this._old,this._new]},h.prototype.redo=function(t){return t.caret().set(JSON.parse(this._new)),this},h.prototype.enter=function(t){return this.redo(t),this},h.prototype.undo=function(t){var e=JSON.parse(this._old);return console.log("move selection back to old",e,this.data()),t.caret().set(e),this.prev()},n(c,s),c.sym("+","point","str"),c.prototype.params=function(){return[this._point,this._str]},c.prototype.redo=function(t){return console.log("redo Insert"),t.insert(this._point,this._str)},c.prototype.undo=function(t){return console.log("undo Insert"),t.erase([this._point,this._point+this._str.length]),this.prev()},n(p,s),p.sym("-","region","str"),p.prototype.params=function(){return[this._region,this._str]},p.prototype.redo=function(t){return console.log("redo Erase"),t.erase(this._region)},p.prototype.undo=function(t){return console.log("undo Erase"),t.insert(this._region.start(),this._str),this.prev()},e.History=l,l.prototype.mode=function(t){return this._mode},l.prototype.setMode=function(t){return this._mode=t,this},l.prototype.view=function(t){return this._view},l.prototype.setView=function(t){return this._view=t,this},l.prototype.enabled=function(t){return this._enabled},l.prototype.setEnabled=function(t){return this._enabled=t,this},l.prototype.current=function(t){return this._current},l.prototype.setCurrent=function(t){return this._current=t,this},l.prototype.seed=function(t){return this._seed},l.prototype.setSeed=function(t){return this._seed=t,this},l.prototype.tail=function(t){return this._tail},l.prototype.setTail=function(t){return this._tail=t,this},l.prototype.add=function(t,e,n){return void 0===e&&(e=!0),void 0===n&&(n=this.view().frames()),t.setFrame(n),this.current()&&(t.setPrev(this.current()),this.current().setNext(t)),e&&(this.setCurrent(t),t),this},l.prototype.next=function(){var t;return(t=this.current())&&t.next&&t.next()},l.prototype.prev=function(){var t;return(t=this.current())&&t.prev&&t.prev()},l.prototype.update=function(t){return this},l.prototype.move=function(t){return void 0===t&&(t=1),this},l.prototype.redo=function(){var t=this;return t.apply(function(){for(var e=[];t.next()&&(t.next().redo(t.view(),t),t.setCurrent(t.next()),!(t.current()instanceof a)););return e}),t},l.prototype.undo=function(){var t=this;return t.apply(function(){for(var e,n,r=[];t.current()&&(t.prev()&&(t.setCurrent(e=t.current().undo(t.view(),t)),e),(n=t.current())&&n.enter&&n.enter(t.view(),t),!(t.current()instanceof a)););return r}),t},l.prototype.apply=function(t){return this._active=!0,t&&t(),this._active=!1,this},l.prototype.batch=function(t){return this},l.prototype.enter=function(t){return t.apply(this.view()),this},l.prototype.onerase=function(t,e,n){
return this._active?this:this.add(new p([t,e]))},l.prototype.oninsert=function(t,e,n){return this._active?this:this.add(new c([t,e]))},l.prototype.oncaret=function(t,e){return this._active?this:this.add(new h([t,e]))},l.prototype.onload=function(t){if(this._active)return this;var e=new u([t]);return this.add(e)},l.prototype.mark=function(t){if(this._active)return this;var e=new a([t]);return this.add(e)},l.prototype.tick=function(){var t=this;if("play"==t._mode){var e=t.view().frames()-t._offset;t.apply(function(){for(var n,r=[];t.next()&&t.next().frame()<=e;)t.next().redo(t.view(),t),r.push((t.setCurrent(n=t.next()),n));return r}),t.next()||t.setMode("live")}return t},l.prototype.play=function(){for(var t=this,e=t.seed();e&&!(e instanceof u);)e=e.next();return t._offset=t.view().frames()-e.frame(),console.log("playing from seed",e,t._offset),t.apply(function(){var n;return t.setCurrent(n=e.redo(t.view(),t)),n}),t.setMode("play"),t},l.prototype.toJSON=function(){for(var t=[],e=this._seed;e;)t.push(e.toJSON()),e=e.next();return{commands:t}},l.prototype.load=function(e){for(var n=this.seed(),r=0,i=t(e.commands),o=i.length;o>r;r++){var a=s.load(i[r]);a.setPrev(n),n.setNext(a),n=a}return this},l}()},function(t,e,n){!function(){function t(t){this._enabled=!0,this._view=t}return e.Logger=t,t.prototype.enabled=function(t){return this._enabled},t.prototype.setEnabled=function(t){return this._enabled=t,this},t.prototype.view=function(t){return this._view},t.prototype.setView=function(t){return this._view=t,this},t.prototype.log=function(){return this._enabled&&console.log.apply(console,arguments),this},t.prototype.warn=function(){return this._enabled&&console.log.apply(console,arguments),this},t.prototype.group=function(t){return this._enabled&&console.group.apply(console,arguments),this},t.prototype.groupCollapsed=function(){return this._enabled&&console.groupCollapsed.apply(console,arguments),this},t.prototype.groupEnd=function(){return this._enabled&&console.groupEnd(),this},t}()},function(t,e,n){function r(){this._array=[],this._set={}}var i=n(4);r.fromArray=function(t,e){for(var n=new r,i=0,o=t.length;o>i;i++)n.add(t[i],e);return n},r.prototype.size=function(){return Object.getOwnPropertyNames(this._set).length},r.prototype.add=function(t,e){var n=i.toSetString(t),r=this._set.hasOwnProperty(n),o=this._array.length;(!r||e)&&this._array.push(t),r||(this._set[n]=o)},r.prototype.has=function(t){var e=i.toSetString(t);return this._set.hasOwnProperty(e)},r.prototype.indexOf=function(t){var e=i.toSetString(t);if(this._set.hasOwnProperty(e))return this._set[e];throw new Error('"'+t+'" is not in the set.')},r.prototype.at=function(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)},r.prototype.toArray=function(){return this._array.slice()},e.ArraySet=r},function(t,e,n){function r(t){return 0>t?(-t<<1)+1:(t<<1)+0}function i(t){var e=1===(1&t),n=t>>1;return e?-n:n}var o=n(65),s=5,a=1<<s,u=a-1,h=a;e.encode=function(t){var e,n="",i=r(t);do e=i&u,i>>>=s,i>0&&(e|=h),n+=o.encode(e);while(i>0);return n},e.decode=function(t,e,n){var r,a,c=t.length,p=0,l=0;do{if(e>=c)throw new Error("Expected more digits in base 64 VLQ value.");if(a=o.decode(t.charCodeAt(e++)),-1===a)throw new Error("Invalid base64 digit: "+t.charAt(e-1));r=!!(a&h),a&=u,p+=a<<l,l+=s}while(r);n.value=i(p),n.rest=e}},function(t,e,n){function r(t){t||(t={}),this._file=o.getArg(t,"file",null),this._sourceRoot=o.getArg(t,"sourceRoot",null),this._skipValidation=o.getArg(t,"skipValidation",!1),this._sources=new s,this._names=new s,this._mappings=new a,this._sourcesContents=null}var i=n(12),o=n(4),s=n(11).ArraySet,a=n(67).MappingList;r.prototype._version=3,r.fromSourceMap=function(t){var e=t.sourceRoot,n=new r({file:t.file,sourceRoot:e});return t.eachMapping(function(t){var r={generated:{line:t.generatedLine,column:t.generatedColumn}};null!=t.source&&(r.source=t.source,null!=e&&(r.source=o.relative(e,r.source)),r.original={line:t.originalLine,column:t.originalColumn},null!=t.name&&(r.name=t.name)),n.addMapping(r)}),t.sources.forEach(function(e){var r=t.sourceContentFor(e);null!=r&&n.setSourceContent(e,r)}),n},r.prototype.addMapping=function(t){var e=o.getArg(t,"generated"),n=o.getArg(t,"original",null),r=o.getArg(t,"source",null),i=o.getArg(t,"name",null);this._skipValidation||this._validateMapping(e,n,r,i),null==r||this._sources.has(r)||this._sources.add(r),null==i||this._names.has(i)||this._names.add(i),this._mappings.add({generatedLine:e.line,generatedColumn:e.column,originalLine:null!=n&&n.line,originalColumn:null!=n&&n.column,source:r,name:i})},r.prototype.setSourceContent=function(t,e){var n=t;null!=this._sourceRoot&&(n=o.relative(this._sourceRoot,n)),null!=e?(this._sourcesContents||(this._sourcesContents={}),this._sourcesContents[o.toSetString(n)]=e):this._sourcesContents&&(delete this._sourcesContents[o.toSetString(n)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},r.prototype.applySourceMap=function(t,e,n){var r=e;if(null==e){if(null==t.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');r=t.file}var i=this._sourceRoot;null!=i&&(r=o.relative(i,r));var a=new s,u=new s;this._mappings.unsortedForEach(function(e){if(e.source===r&&null!=e.originalLine){var s=t.originalPositionFor({line:e.originalLine,column:e.originalColumn});null!=s.source&&(e.source=s.source,null!=n&&(e.source=o.join(n,e.source)),null!=i&&(e.source=o.relative(i,e.source)),e.originalLine=s.line,e.originalColumn=s.column,null!=s.name&&(e.name=s.name))}var h=e.source;null==h||a.has(h)||a.add(h);var c=e.name;null==c||u.has(c)||u.add(c)},this),this._sources=a,this._names=u,t.sources.forEach(function(e){var r=t.sourceContentFor(e);null!=r&&(null!=n&&(e=o.join(n,e)),null!=i&&(e=o.relative(i,e)),this.setSourceContent(e,r))},this)},r.prototype._validateMapping=function(t,e,n,r){if((!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0)||e||n||r)&&!(t&&"line"in t&&"column"in t&&e&&"line"in e&&"column"in e&&t.line>0&&t.column>=0&&e.line>0&&e.column>=0&&n))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:n,original:e,name:r}))},r.prototype._serializeMappings=function(){for(var t,e,n,r=0,s=1,a=0,u=0,h=0,c=0,p="",l=this._mappings.toArray(),f=0,d=l.length;d>f;f++){if(t=l[f],t.generatedLine!==s)for(r=0;t.generatedLine!==s;)p+=";",s++;else if(f>0){if(!o.compareByGeneratedPositionsInflated(t,l[f-1]))continue;p+=","}p+=i.encode(t.generatedColumn-r),r=t.generatedColumn,null!=t.source&&(n=this._sources.indexOf(t.source),p+=i.encode(n-c),c=n,p+=i.encode(t.originalLine-1-u),u=t.originalLine-1,p+=i.encode(t.originalColumn-a),a=t.originalColumn,null!=t.name&&(e=this._names.indexOf(t.name),p+=i.encode(e-h),h=e))}return p},r.prototype._generateSourcesContent=function(t,e){return t.map(function(t){if(!this._sourcesContents)return null;null!=e&&(t=o.relative(e,t));var n=o.toSetString(t);return Object.prototype.hasOwnProperty.call(this._sourcesContents,n)?this._sourcesContents[n]:null},this)},r.prototype.toJSON=function(){var t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(t.file=this._file),null!=this._sourceRoot&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t},r.prototype.toString=function(){return JSON.stringify(this.toJSON())},e.SourceMapGenerator=r},function(t,e){!function(){return tag$.extendTag("element",function(t){t.prototype.route=function(t){return this.getAttribute("route")},t.prototype.setRoute=function(t){return this.setAttribute("route",t),this},t.prototype.setHtml=function(t){return t!=this._html&&(this.dom().innerHTML=this._html=t),this},t.prototype.go=function(t){return this},t.prototype.router=function(){return APP.router()},t.prototype.reroute=function(){return this.flag("scoped",this.router().scoped(this.route(),this)),this.flag("selected",this.router().match(this.route(),this))},t.prototype.setTransform=function(t){return this.css("transform",t),this},t.prototype.transform=function(){return this.css("transform")}}),tag$.extendTag("htmlelement",function(t){t.prototype.setHtml=function(t){return t!=this._html&&(this.dom().innerHTML=this._html=t),this}}),tag$.extendTag("script",function(t){t.prototype.setChildren=function(t){return this._children=t,this.dom().innerHTML=t,this}}),tag$.extendTag("canvas",function(t){t.prototype.dpr=function(){return this._dpr||(this._dpr=window.devicePixelRatio||1)},t.prototype.setWidth=function(t){return t!=this._width&&(this.dom().width=t*this.dpr(),this.css({width:t}),this._width=t),this},t.prototype.setHeight=function(t){return t!=this._height&&(this.dom().height=t*this.dpr(),this.css({height:t}),this._height=t),this}}),tag$.extendTag("a",function(t){t.prototype.route=function(){return this._route||this.href()},t.prototype.ontap=function(t){var e=this.href().replace(/^http\:\/\/imba\.io/,"");return t.event().metaKey||t.event().altKey?(t._responder=null,t.halt()):"#"!=e[0]&&"/"!=e[0]?(t._responder=null,t.halt()):(t.cancel().halt(),this.router().go(e,{}),Imba.Events.trigger("route",this),this)},t.prototype.render=function(){return this.reroute()}}),tag$.defineTag("star","a",function(t){t.prototype.repo=function(t){return this.getAttribute("repo")},t.prototype.setRepo=function(t){return this.setAttribute("repo",t),this},t.prototype.render=function(){return this.setHref("http://github.com/"+this.repo()).setText("★ Star").synced()}})}()},function(t,e,n){!function(){function t(t){return t?t.toArray?t.toArray():t:[]}n(5);var e=n(6).Doc;return tag$.defineTag("blog","page",function(n){n.prototype.doc=function(){var t;return(t=this.router().scoped(/blog\/(\d+)/,1))?e.get("/issues/"+t+".json"):e.get("/issues/"+this.posts()[0].number+".json")},n.prototype.posts=function(){return APP.issues().object()},n.prototype.nav=function(){var e,n,r=this;return(e=r._nav=r._nav||tag$.$navmenu().setRef("nav",this)).setContent((n=e.$$a=e.$$a||tag$.$div().flag("content")).setContent(function(e){for(var n=0,i=t(r.posts()),o=i.length,s=[];o>n;n++)s.push((e["$$a"+n]=e["$$a"+n]||tag$.$issue_entry().flag("entry")).flag("entry").setObject(i[n]).end());return s}(n),3).end(),2).end()},n.prototype.body=function(){var t;return(t=this._body=this._body||tag$.$div().setRef("body",this).flag("light")).setContent([this.doc()?(t.$$a=t.$$a||tag$.$issue()).setObject(this.doc()).end():void 0],1).end()}})}()},function(t,e,n){!function(){function t(t){return t?t.toArray?t.toArray():t:[]}function e(t){return"api-"+t.replace(/\./g,"_").replace(/\#/g,"__")}return tag$.defineTag("api-desc",function(t){t.prototype.setHtml=function(t){return t!=this._html&&(this.dom().innerHTML=this._html=t),this}}),tag$.defineTag("api-ref",function(t){t.prototype.render=function(){return this.synced()}}),tag$.defineTag("api-item"),tag$.defineTag("api-path","span",function(t){t.prototype.build=function(){var t;return("string"==typeof(t=this.object())||t instanceof String)&&this.setHtml(this.object().replace(/\b([\w]+|\.|\#)\b/g,function(t,e){return"."==e||"#"==e?"<i>"+e+"</i>":e[0]==e[0].toUpperCase()?"<b class='const'>"+e+"</b>":"<b class='id'>"+e+"</b>"})),this}}),tag$.defineTag("api-link",function(t){t.prototype.name=function(t){return this.getAttribute("name")},t.prototype.setName=function(t){return this.setAttribute("name",t),this},t.prototype.render=function(){var t;return this.setChildren([(this.$a=this.$a||tag$.$api_path().flag("value")).setObject(this.object().value).end(),(t=this.$b=this.$b||tag$.$span().flag("desc")).setContent(this.object().desc,3).end()],2).synced()}}),tag$.defineTag("api-return","api-link"),tag$.defineTag("api-class","api-item",function(n){n.prototype.__object={watch:"parse",name:"object"},n.prototype.object=function(t){return this._object},n.prototype.setObject=function(t){var e=this.object();return t!=e&&(this._object=t),t!=e&&this.parse&&this.parse(t,e,this.__object),this},n.prototype.parse=function(){for(var e,n=0,r=t(this.object()["."]),i=r.length,o=[];i>n;n++)e=r[n],e.desc&&o.push(e);this._statics=o;for(var s,n=0,r=t(this.object()["#"]),i=r.length,o=[];i>n;n++)s=r[n],s.desc&&o.push(s);return this._methods=o,this._properties=[],this},n.prototype.render=function(){var n,r,i,o,s,a,u,h,c=this;return this.setChildren([(this.$a=this.$a||tag$.$span().flag("toc-anchor")).setId(e(this.object().namepath)).end(),(n=this.$b=this.$b||tag$.$div().flag("header")).setContent((r=n.$$a=n.$$a||tag$.$div().flag("title")).setContent((r.$$a=r.$$a||tag$.$api_path()).setObject(this.object().namepath).end(),2).end(),2).end(),(this.$c=this.$c||tag$.$api_desc()).setHtml(this.object().html).end(),this.object().ctor?(i=this.$d=this.$d||tag$.$div().flag("content").flag("ctor")).setContent((i.$$a=i.$$a||tag$.$api_method()).setPath(this.object().namepath+".new").setObject(this.object().ctor).end(),2).end():void 0,(o=c.$e=c.$e||tag$.$div().flag("content")).setContent([this._statics.length>0?(s=o.$$a=o.$$a||tag$.$div().flag("section")).setContent([(s.$$a=s.$$a||tag$.$h2().flag("header")).setText("Static Methods").end(),(a=s.$$b=s.$$b||tag$.$div().flag("content").flag("list")).setContent(function(e){for(var n=0,r=t(c._statics),i=r.length,o=[];i>n;n++)o.push((e["$$a"+n]=e["$$a"+n]||tag$.$api_method().flag("doc")).setIname(c.object().namepath).setObject(r[n]).end());return o}(a),3).end()],2).end():void 0,c._methods.length>0?(u=o.$$b=o.$$b||tag$.$div().flag("section")).setContent([(u.$$a=u.$$a||tag$.$h2().flag("header")).setText("Instance Methods").end(),(h=u.$$b=u.$$b||tag$.$div().flag("content").flag("list")).setContent(function(e){for(var n=0,r=t(c._methods),i=r.length,o=[];i>n;n++)o.push((e["$$a"+n]=e["$$a"+n]||tag$.$api_method().flag("doc")).setIname(c.object().iname).setObject(r[n]).end());return o}(h),3).end()],2).end():void 0],1).end()],1).synced()}}),tag$.defineTag("api-value",function(t){t.prototype.render=function(){var t,e;return this.object().type?this.flag(this.object().type).setChildren(this.object().value,3).synced():"string"==typeof(t=this.object())||t instanceof String?this.flag("str").setText(this.object()).synced():("number"==typeof(e=this.object())||e instanceof Number)&&this.flag("num").setText(this.object()).synced(),this}}),tag$.defineTag("api-param",function(e){e.prototype.type=function(){return this.object().type},e.prototype.render=function(){var e,n,r=this;return this.flag(r.type()).setChildren(["NamedParams"==r.type()?function(e){for(var n=0,r=t(e.object().nodes),i=r.length,o=[];i>n;n++)o.push((e["$a"+n]=e["$a"+n]||tag$.$api_param()).setObject(r[n]).end());return o}(r):Imba["static"]([(e=r.$b=r.$b||tag$.$div().flag("name")).setContent(r.object().name,3).end(),r.object().defaults?Imba["static"]([(n=r.$c=r.$c||tag$.$i()).setContent(["NamedParam"==r.type()?": ":" = "],1).end(),(r.$d=r.$d||tag$.$api_value()).setObject(r.object().defaults).end()],2):void 0],3)],1).synced()}}),tag$.defineTag("api-method","api-item",function(n){n.prototype.iname=function(t){return this._iname},n.prototype.setIname=function(t){return this._iname=t,this},n.prototype.path=function(t){return this._path},n.prototype.setPath=function(t){return this._path=t,this},n.prototype.tags=function(){var t;return(t=this._tags=this._tags||tag$.$div().setRef("tags",this)).setContent([this.object().deprecated?(t.$$a=t.$$a||tag$.$div().flag("deprecated").flag("red")).setText("Method is deprecated").end():void 0,this.object()["return"]?(t.$$b=t.$$b||tag$.$api_return().setName("returns")).setObject(this.object()["return"]).end():void 0],1).end()},n.prototype.path=function(){return this._path||this.iname()+"."+this.object().name},n.prototype.slug=function(){return e(this.object().namepath)},n.prototype.render=function(){var e,n,r=this;return this.flag("deprecated",this.object().deprecated).setChildren([(this.$a=this.$a||tag$.$span().flag("toc-anchor")).setId(this.slug()).end(),(e=r.$b=r.$b||tag$.$div().flag("header")).setContent([(e.$$a=e.$$a||tag$.$api_path()).setObject(this.path()).end(),(n=e.$$b=e.$$b||tag$.$div().flag("params")).setContent(function(e){for(var n=0,i=t(r.object().params),o=i.length,s=[];o>n;n++)s.push((e["$$a"+n]=e["$$a"+n]||tag$.$api_param()).setObject(i[n]).end());return s}(n),3).end(),(e.$$c=e.$$c||tag$.$div().flag("grow")).end()],2).end(),(r.$c=r.$c||tag$.$api_desc().flag("md")).setHtml(r.object().html).end(),r.tags()],1).synced()}}),tag$.defineTag("doc-link","a",function(t){t.prototype.render=function(){return this.setHref("/docs#"+e(this.object().namepath)).setChildren((this.$a=this.$a||tag$.$api_path()).setObject(this.object().namepath).end(),2).synced(),t.__super__.render.apply(this,arguments)},t.prototype.ontap=function(){return t.__super__.ontap.apply(this,arguments),this.up(q$("._docs",this)).refocus()}}),tag$.defineTag("doc-group","toc",function(t){t.prototype.ontap=function(){return this.toggleFlag("collapsed")}}),tag$.defineTag("docs","page",function(e){e.prototype.__version={"default":"current",name:"version"},e.prototype.version=function(t){return this._version},e.prototype.setVersion=function(t){return this._version=t,this},e.prototype._version="current",e.prototype.roots=function(t){return this._roots},e.prototype.setRoots=function(t){return this._roots=t,this},e.prototype.src=function(){return"/api/"+this.version()+".json"},e.prototype.docs=function(){return this._docs},e.prototype.awaken=function(){return this.load(),this.schedule(),this},e.prototype.build=function(){return this.load(),e.__super__.build.apply(this,arguments)},e.prototype.load=function(){var t=this;return t._request||(t._request=APP.fetchDocument(t.src(),function(e){return DOCS=t._docs=e,DOCMAP=t._docs.entities,t.generate(),t.loaded()}))},e.prototype.loaded=function(){var t;return this.render(),document.location.hash&&(t=this.first(document.location.hash))&&t.dom().scrollIntoView(),this},e.prototype.refocus=function(){var t;return(t=this.first(document.location.hash))&&t.dom().scrollIntoView(),this},e.prototype.lookup=function(t){return this.docs().entities[t]},e.prototype.generate=function(){this._roots=[];for(var t,e=this._docs.entities,n=this.docs().entities,r=0,i=Object.keys(n),o=i.length;o>r;r++)t=n[i[r]],("class"==t.type||"Imba"==i[r])&&(t["."]=(t["."]||[]).sort().map(function(t){return e[t]}).filter(function(t){return"method"==t.type&&t.desc}),t["#"]=(t["#"]||[]).sort().map(function(t){return e[t]}).filter(function(t){return"method"==t.type&&t.desc}),t.desc&&this._roots.push(t));return this},e.prototype.render=function(){return this.docs()?e.__super__.render.apply(this,arguments):this},e.prototype.body=function(){var e,n=this;return(e=n._body=n._body||tag$.$div().setRef("body",this).flag("light")).setContent(function(e){for(var r=0,i=t(n.roots()),o=i.length,s=[];o>r;r++)s.push((e["$$a"+r]=e["$$a"+r]||tag$.$api_class().flag("doc").flag("l")).setObject(i[r]).end());return s}(e),3).end()},e.prototype.nav=function(){var e,n,r=this;return(e=r._nav=r._nav||tag$.$navmenu().setRef("nav",this)).setContent((n=e.$$a=e.$$a||tag$.$div().flag("content")).setContent(function(e){for(var n,i,o,s,a,u,h=0,c=t(r.roots()),p=c.length,l=[];p>h;h++)u=c[h],l.push((n=e["$$a"+h]=e["$$a"+h]||tag$.$doc_group().flag("class").flag("section").flag("compact")).setContent([(i=n.$$a=n.$$a||tag$.$div().flag("header")).setContent((i.$$a=i.$$a||tag$.$doc_link().flag("class")).setObject(u).end(),2).end(),(o=n.$$b=n.$$b||tag$.$div().flag("content")).setContent([(s=o.$$a=o.$$a||tag$.$div().flag("static")).setContent(function(e){for(var n,r,i=0,o=t(u["."]),s=o.length,a=[];s>i;i++)r=o[i],r.desc&&a.push((n=e["$$a"+i]=e["$$a"+i]||tag$.$div().flag("entry")).setContent((n.$$a=n.$$a||tag$.$doc_link()).setObject(r).end(),2).end());return a}(s),3).end(),(a=o.$$b=o.$$b||tag$.$div().flag("instance")).setContent(function(e){for(var n,r,i=0,o=t(u["#"]),s=o.length,a=[];s>i;i++)r=o[i],r.desc&&a.push((n=e["$$a"+i]=e["$$a"+i]||tag$.$div().flag("entry")).setContent((n.$$a=n.$$a||tag$.$doc_link()).setObject(r).end(),2).end());return a}(a),3).end()],2).end()],2).end());return l}(n),3).end(),2).end()}})}()},function(t,e,n){!function(){function t(t){return t?t.toArray?t.toArray():t:[]}function e(t){this._path=t,this._ready=!1,this.fetch()}n(5);return e.get=function(t){var e,n=APP.cache();return n[e="guide-"+t]||(n[e]=new this(t))},e.prototype.path=function(t){return this._path},e.prototype.setPath=function(t){return this._path=t,this},e.prototype.ready=function(){return this._ready},e.prototype.fetch=function(){var t=this;return t._promise||(t._promise=APP.fetchDocument(t._path+".md",function(e){return t.load(e)}))},e.prototype.load=function(t){return this._object=t,this._meta=t.meta||{},this._ready=!0,Imba.emit(this,"ready"),this},e.prototype.title=function(){return this._object.title||"path"},e.prototype.toc=function(){return this._object&&this._object.toc[0]},e.prototype.body=function(){return this._object&&this._object.body},tag$.defineTag("guide-toc","toc",function(e){e.prototype.toc=function(t){return this._toc},e.prototype.setToc=function(t){return this._toc=t,this},e.prototype.toc=function(){return this._toc||this.object().toc()},e.prototype.route=function(){return""+this.object().path()+"#"+this.toc().slug},e.prototype.toggle=function(){return this.toggleFlag("collapsed")},e.prototype.render=function(){var e,n,r,i,o=this;return this.object().ready()?(this.reroute(),this.flag("entry").setLevel(this.toc().level).setChildren([this.toc().children.length&&this.toc().level<2?Imba["static"]([(e=this.$a=this.$a||tag$.$div().flag("header").setHandler("tap","toggle",this)).setContent((n=e.$$a=e.$$a||tag$.$a()).setHref(this.route()).setContent(this.toc().title,3).end(),2).end(),(r=o.$b=o.$b||tag$.$div().flag("content")).setContent(function(e){for(var n=0,r=t(o.toc().children),i=r.length,s=[];i>n;n++)s.push((e["$$a"+n]=e["$$a"+n]||tag$.$guide_toc()).setToc(r[n]).setObject(o.object()).end());return s}(r),3).end()],2):(i=o.$c=o.$c||tag$.$a()).setHref(o.route()).setContent(o.toc().title,3).end()],1).synced()):this}}),tag$.defineTag("guide",function(e){e.prototype.render=function(){var t;return!(t=this.object())&&t.ready&&t.ready()?this:this.flag("md").setBody(this.object().body()).synced()},e.prototype.setBody=function(t){return t!=this._body&&(this._body=t,this.dom().innerHTML=t,Imba.isClient()&&this.reawaken()),this},e.prototype.reawaken=function(){for(var e=0,n=t(q$("._snippet",this)),r=n.length;r>e;e++)n[e];return this}}),tag$.defineTag("guides","page",function(n){n.prototype.nav=function(){var t,n;return(t=this._nav=this._nav||tag$.$navmenu().setRef("nav",this)).setContent((n=t.$$a=t.$$a||tag$.$div().flag("content")).setContent([(n.$$a=n.$$a||tag$.$guide_toc()).setObject(e.get("/guides")).end(),(n.$$b=n.$$b||tag$.$guide_toc()).setObject(e.get("/guides/language")).end()],2).end(),2).end()},n.prototype.body=function(){var t;return(t=this._body=this._body||tag$.$div().setRef("body",this).flag("light")).setContent([this.guide()?(t.$$a=t.$$a||tag$.$guide()).setObject(this.guide()).end():void 0],1).end()},n.prototype.onroute=function(t){var e=this;t.halt();var n=function(){var t;return(t=e.first("#"+e.router().hash()))?(t.dom().scrollIntoView(!0),e._scrollFreeze=window.scrollY,t):!1};return e.router().hash()&&(e.render(),n()||setTimeout(n,20,function(){})),e},n.prototype.guide=function(){return this.router().scoped("/guides")?e.get(this.router().path()):void 0},n.prototype.awaken=function(){var t=this;return Imba.isClient()&&(t.schedule({fps:1}),window.addEventListener("scroll",function(){return t.scrolled()})),t},n.prototype.scrolled=function(){if(this.hasFlag("scoped")){var e,n=q$("[id]",this),r=window.scrollY,i=window.innerHeight,o=document.body.scrollHeight;if(this._scrollFreeze>=0){var s=Math.abs(r-this._scrollFreeze);if(50>s)return this;this._scrollFreeze=-1}var a=o-(r+i);if(0==a)e=n.last();else for(var u,h=0,c=t(n),p=c.length;p>h;h++){u=c[h];var l=u.dom().offsetTop+30+60,f=r-l;if(0>f){e=u;break}}return e&&this._hash!=e.id()&&(this._hash=e.id(),this.router().go("#"+this._hash,{},!0),this.render()),this}},n.prototype.tick=function(){return this.render(),this}})}()},function(t,e,n){!function(){function t(t){return t?t.toArray?t.toArray():t:[]}function e(t){for(var e,n,r=t.length;r>0;)n=Math.floor(Math.random()*r),r--,e=t[r],t[r]=t[n],t[n]=e;return t}return tag$.defineTag("pattern",function(n){n.prototype.build=function(){for(var n={tags:[],keywords:[],methods:[]},r=[],i=[],o=Imba.Tag.prototype,s=0,a=Object.keys(o),u=a.length;u>s;s++)k=a[s],r.push("<em>"+k+"</em>"),n.methods.push("<em>"+k+"</em>");for(var h,s=0,c=t(HTML_TAGS),p=c.length;p>s;s++)h=c[s],r.push("<u>&lt;"+h+"&gt;</u>"),n.tags.push("<u>&lt;"+h+"&gt;</u>");for(var l,f="def if else elif while until for in of var let class extend export import tag global",s=0,c=t(f.split(" ")),p=c.length;p>s;s++)l=c[s],r.push("<i>"+l+"</i>"),n.keywords.push("<i>"+l+"</i>");for(var d=e(r),g=[].concat(d),m=r.length-1,y=12,_=0;y>=_;_++){var v=0;for(i[_]=[];300>v;){var b=d.pop()||g[Math.floor(m*Math.random())];b?(v+=b.length,i[_].push(b)):v=400}}return this.dom().innerHTML="<div>"+i.map(function(t){return'<div class="line">'+t.join(" ")+"</div>"}).join("")+"</div>",this},n.prototype.awaken=function(){return this.log("awakening pattern!!"),this}}),tag$.defineTag("home","page",function(e){e.prototype.awaken=function(){for(var n,r=document.querySelectorAll("code[data-src]"),i=0,o=t(r),s=o.length;s>i;i++){n=o[i];var a=n.getAttribute("data-src");DEPS[a]={html:n.innerHTML}}return e.__super__.awaken.apply(this,arguments)},e.prototype.nav=function(){return null},e.prototype.body=function(){var t,e,n,r,i;return(t=this._body=this._body||tag$.$div().setRef("body",this)).setContent([(e=t.$$a=t.$$a||tag$.$div().setId("hero").flag("dark")).setContent([(this._pattern=this._pattern||tag$.$pattern().setRef("pattern",this).flag("awaken")).end(),(e.$$b=e.$$b||tag$.$example().flag("hero").flag("dark").setSrc("/home/examples/hero.imba")).end()],2).end(),(n=this._content=this._content||tag$.$div().setRef("content",this)).setContent([(n.$$a=n.$$a||tag$.$marked().flag("section").flag("md").flag("welcome").flag("huge").flag("light")).setText("# Ruby, Python and React got together. Nine months later, Imba was born.\n\nImba is a new programming language for the web that compiles to highly \nperformant and readable JavaScript. It has language level support for defining, \nextending, subclassing, instantiating and rendering dom nodes. For a semi-complex \napplication like TodoMVC, it is more than \n[10 times faster than React](http://somebee.github.io/todomvc-render-benchmark/index.html) \nwith less code, and a much smaller library.\n\n---\n\n- ## Imba.inspiration\n  Imba brings the best from Ruby, Python, and React (+ JSX) together in a clean language and runtime.\n\n- ## Imba.interoperability\n  Imba compiles down to clean and readable JavaScript. Use any JS library in Imba and vica-versa.\n\n- ## Imba.performance\n  Build your application views using Imba's native tags for unprecedented performance.\n").end(),(n.$$b=n.$$b||tag$.$example().flag("dark").setHeading("Simple reminders").setSrc("/home/examples/reminders.imba")).end(),(n.$$c=n.$$c||tag$.$marked().flag("section").flag("md")).setText("## Reusable components\n\nA custom tag / component can maintain internal state and control how to render itself.\nWith the performance of DOM reconciliation in Imba, you can use one-way declarative binding,\neven for animations. Write all your views in a straight-forward linear fashion as if you could\nrerender your whole application on **every single** data/state change.").end(),(n.$$d=n.$$d||tag$.$example().flag("dark").setHeading("World clock").setSrc("/home/examples/clock.imba")).end(),(n.$$e=n.$$e||tag$.$marked().flag("section").flag("md")).setText("## Extend native tags\n\nIn addition to defining custom tags, you can also extend native tags, or inherit from them.\nBinding to dom events is as simple as defining methods on your tags; all events will be\nefficiently delegated and handled by Imba. Let's define a simple sketchpad...").end(),(n.$$f=n.$$f||tag$.$example().flag("dark").setHeading("Custom canvas").setSrc("/home/examples/canvas.imba")).end(),(r=n.$$g=n.$$g||tag$.$footer()).setContent((i=r.$$a=r.$$a||tag$.$nav()).setContent([(i.$$a=i.$$a||tag$.$a().flag("button").flag("huge").flag("main").setHref("/install")).setText("Install").end(),(i.$$b=i.$$b||tag$.$a().flag("button").flag("huge").setHref("/guides")).setText("Learn more").end()],2).end(),2).end()],2).end()],2).end()}})}()},function(t,e,n){!function(){return n(14),n(21),n(23),n(22),n(5),n(20),n(18),n(15),n(17),n(16),n(24)}()},function(t,e,n){!function(){function t(t){return t?t.toArray?t.toArray():t:[]}var e=n(7).Router;return tag$.defineTag("issue-entry",function(n){n.prototype.render=function(){var n,r,i,o,s=this;return this.setChildren([(n=this.$a=this.$a||tag$.$div().flag("header")).setContent((r=n.$$a=n.$$a||tag$.$a().flag("title")).setHref("/blog/"+this.object().number+"-"+e.slug(this.object().title)).setContent(this.object().title,3).end(),2).end(),(i=this.$b=this.$b||tag$.$div().flag("legend")).setContent(["by ",(i.$$a=i.$$a||tag$.$gh_user()).setObject(this.object().user).end()],2).end(),(o=s.$c=s.$c||tag$.$div().flag("labels")).setContent(function(e){for(var n=0,r=t(s.object().labels),i=r.length,o=[];i>n;n++)o.push((e["$$a"+n]=e["$$a"+n]||tag$.$gh_label()).setObject(r[n]).end());return o}(o),3).end()],2).synced()}}),tag$.defineTag("gh-label",function(t){t.prototype.render=function(){return this.setTitle(this.object().name).setChildren(this.object().name,3).synced(),Imba.CLIENT&&this.css({backgroundColor:"#"+this.object().color}),this}}),tag$.defineTag("gh-user","span",function(t){t.prototype.render=function(){var t;return this.setChildren((t=this.$a=this.$a||tag$.$a()).setHref("http://github.com/"+this.object().login).setContent(this.object().login,3).end(),2).synced()}}),tag$.defineTag("issue",function(t){t.prototype.doc=function(){return this.object().object()},t.prototype.build=function(){return this.commit()},t.prototype.commit=function(){return this.object()&&this.object().ready()?(console.log("commit issue"),this.unflag("loading"),this.render()):this.flag("loading")},t.prototype.render=function(){var t,e,n;return this.setChildren([(t=this.$a=this.$a||tag$.$div().flag("header")).setContent([(e=t.$$a=t.$$a||tag$.$h1().flag("title")).setContent(this.doc().title,3).end(),(n=t.$$b=t.$$b||tag$.$div().flag("legend")).setContent(["Written by ",(n.$$a=n.$$a||tag$.$gh_user()).setObject(this.doc().user).end()," at "+this.doc().created_at],1).end()],2).end(),(this.$b=this.$b||tag$.$div().flag("content").flag("md")).setHtml(this.doc().md).end()],2).synced()}})}()},function(t,e,n){!function(){function t(t){return t?t.toArray?t.toArray():t:[]}tag$.defineTag("md",function(e){e.prototype.__src={watch:"reload",name:"src"},e.prototype.src=function(t){return this.getAttribute("src")},e.prototype.setSrc=function(t){var e=this.src();return t!=e&&this.setAttribute("src",t),t!=e&&this.reload&&this.reload(t,e,this.__src),this},e.prototype.__html={watch:"htmlDidSet",name:"html"},e.prototype.html=function(t){return this._html},e.prototype.setHtml=function(t){var e=this.html();return t!=e&&(this._html=t),t!=e&&this.htmlDidSet&&this.htmlDidSet(t,e,this.__html),this},e.prototype.doc=function(t){return this._doc},e.prototype.setDoc=function(t){return this._doc=t,this},e.prototype.body=function(){return this},e.prototype.setup=function(){return this},e.prototype.ghsrc=function(){return"https://github.com/somebee/imba.io/blob/master/docs"+this.src()},e.prototype.htmlDidSet=function(t){return this.body().dom().innerHTML=t,this.setup(),this},e.prototype.render=function(){var e=this;if(e._snippets)for(var n=0,r=t(e._snippets),i=r.length;i>n;n++)r[n].end();return e},e.prototype.assemble=function(t){return this.flag("md").setHtml(t.body).synced()},e.prototype.build=function(){
return e.__super__.build.apply(this,arguments),Imba.isClient()&&this.src()?this.reload():void 0},e.prototype.awaken=function(){return this._snippets=q$("._snippet",this).toArray(),this},e.prototype.preload=function(t){return this._dom.innerHTML=t,this._snippets=q$("._snippet",this).toArray(),this},e.prototype.reload=function(){var t=this;return Imba.isClient()&&(t._snippets=[],APP.fetchDocument(t.src()+".md",function(e){return t.assemble((t.setDoc(e),e)),t._snippets=q$("._snippet",t).toArray(),t.parent().dom().scrollTop=0,t})),t}});var e=n(51),r=new e.Renderer;return r.heading=function(t,e){return"<h"+e+">"+t+"</h"+e+">"},tag$.defineTag("marked",function(t){t.prototype.renderer=function(){return this},t.prototype.setText=function(t){return this.setContent(t,0)},t.prototype.setContent=function(t,n){return t!=this._content&&(this._content=t,this.dom().innerHTML=e(t,{renderer:r})),this}})}()},function(t,e){!function(){return tag$.defineTag("navmenu",function(t){t.prototype.onroute=function(t){return document.body.classList.remove("menu"),this}}),tag$.defineTag("nav-list"),tag$.defineTag("nav-link",function(t){t.prototype.href=function(t){return this.getAttribute("href")},t.prototype.setHref=function(t){return this.setAttribute("href",t),this},t.prototype.render=function(){var t;return this.setChildren((t=this.$a=this.$a||tag$.$a()).setHref(this.href()).setContent(this._content,3).end(),2).synced()}}),tag$.defineTag("toc",function(t){t.prototype.level=function(t){return this.getAttribute("level")},t.prototype.setLevel=function(t){return this.setAttribute("level",t),this},t.prototype.toggle=function(){return this.toggleFlag("collapsed")}})}()},function(t,e){!function(){return tag$.defineTag("site","html",function(t){t.prototype.deps=function(t){return this._deps},t.prototype.setDeps=function(t){return this._deps=t,this},t.prototype.head=function(){return tag$.$head().setContent([tag$.$title().setText("imba").end(),tag$.$meta().setCharset("utf-8").end(),tag$.$meta().setName("viewport").setContent("width=device-width, initial-scale=1, maximum-scale=1,minimum-scale=1").end(),tag$.$meta().setName("Description").setContent("Imba is a rich programming language for the web.").end(),tag$.$meta().setName("keywords").setContent("imba javascript language js").end(),tag$.$link().setHref("http://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600").setRel("stylesheet").setType("text/css").end(),tag$.$link().setRel("stylesheet").setHref("/css/site.css").setMedia("screen").end(),tag$.$script().setText("DEPS = {};").end(),tag$.$script().setSrc("/vendor/ga.js").end()],2).end()},t.prototype.body=function(){return tag$.$body().setId("site").setContent([tag$.$site_nav().setId("header").flag("awaken").end(),tag$.$home().setRoute("/home").end(),tag$.$guides().setRoute("/guides").end(),tag$.$docs().setRoute("/docs").end(),tag$.$blog().setRoute("/blog").end(),tag$.$footer().setContent([tag$.$hr().end(),tag$.$div().flag("lft").setText("Imba © 2015-2016").end(),tag$.$div().flag("rgt").setContent([tag$.$a().setHref("http://twitter.com/imbajs").setText("Twitter").end(),tag$.$a().setHref("http://github.com/sombee/imba").setText("GitHub").end(),tag$.$a().setHref("http://github.com/sombee/imba/issues").setText("Issues").end(),tag$.$a().setHref("http://gitter.im/sombee/imba").setText("Chat").end()],2).end()],2).end()],2).end()},t.prototype.scripts=function(){var t,e=this;return tag$.$div().flag("scripts").setContent([function(t){for(var n=e.deps(),r=0,i=Object.keys(n),o=i.length,s=[];o>r;r++)s.push(tag$.$script().setType("text/javascript").setSrc(i[r]+".dep").end());return s}(t),tag$.$script().setSrc("/vendor/hl.js").end(),tag$.$script().setSrc("/client.js").end()],0).end()},t.prototype.render=function(){APP.setSite(this),this.setDeps({"/issues/all.json":!0}),APP.fetchDocument("/guides.md");var t=this.body();return t.append(this.scripts()),this.flag("light").setChildren([this.head(),t],1).synced(),APP.setSite(null),this}}),tag$.defineTag("site-nav",function(t){t.prototype.toggleMenu=function(){return q$$("body").toggleFlag("menu")},t.prototype.render=function(){var t,e,n,r,i,o,s,a;return this.setChildren((t=this.$a=this.$a||tag$.$nav().flag("content")).setContent([(e=t.$$a=t.$$a||tag$.$a().flag("menu").setHandler("tap","toggleMenu",this)).setContent((e.$$a=e.$$a||tag$.$b()).end(),2).end(),(n=t.$$b=t.$$b||tag$.$a().flag("tab").flag("logo").setHref("/home")).setContent((n.$$a=n.$$a||tag$.$i()).setText("imba").end(),2).end(),(t.$$c=t.$$c||tag$.$span().flag("greedy")).end(),(r=t.$$d=t.$$d||tag$.$a().flag("tab").flag("home").setHref("/home")).setContent((r.$$a=r.$$a||tag$.$i()).setText("home").end(),2).end(),(i=t.$$e=t.$$e||tag$.$a().flag("tab").flag("guides").setHref("/guides")).setContent((i.$$a=i.$$a||tag$.$i()).setText("guides").end(),2).end(),(o=t.$$f=t.$$f||tag$.$a().flag("tab").flag("docs").setHref("/docs")).setContent((o.$$a=o.$$a||tag$.$i()).setText("api").end(),2).end(),(s=t.$$g=t.$$g||tag$.$a().flag("tab").flag("blog").setHref("/blog")).setContent((s.$$a=s.$$a||tag$.$i()).setText("blog").end(),2).end(),(a=t.$$h=t.$$h||tag$.$a().flag("github").setHref("https://github.com/somebee/imba")).setContent((a.$$a=a.$$a||tag$.$i()).setText("github").end(),2).end()],2).end(),2).synced()},t.prototype.awaken=function(){return this.schedule({fps:0})}})}()},function(module,exports,__webpack_require__){!function(){function iter$(t){return t?t.toArray?t.toArray():t:[]}tag$.defineTag("tool","button",function(t){t.prototype.action=function(t){return this._action},t.prototype.setAction=function(t){return this._action=t,this},t.prototype.render=function(){return this.flag("sym").synced()},t.prototype.onclick=function(t){return this.log("button click",t),t.halt()},t.prototype.ontouchstart=function(t){return this.log("touchstart"),t.event().preventDefault()}}),tag$.defineTag("snippet-hint",function(t){t.prototype.view=function(t){return this._view},t.prototype.setView=function(t){return this._view=t,this},t.prototype.render=function(){return this.setText("I am a hint!!").synced()}}),tag$.defineTag("overlays",function(t){t.prototype.view=function(t){return this._view},t.prototype.setView=function(t){return this._view=t,this},t.prototype.render=function(){var t;if(t=this.view()._root){for(var e=0,n=0,r=t.dom();r&&!r.contains(this._dom);)e+=r.offsetLeft,n+=r.offsetTop-r.scrollTop,r=r.parentNode;this._dom.style.left=e+"px",this._dom.style.top=n+"px"}return this}}),tag$.defineTag("hint-label",function(t){t.prototype.setLabel=function(t){return t!=this._label&&(this._label=t,this.dom().innerHTML=t),this}}),tag$.defineTag("overlay-hint",function(t){t.prototype.type=function(t){return this.getAttribute("type")},t.prototype.setType=function(t){return this.setAttribute("type",t),this},t.prototype.view=function(t){return this._view},t.prototype.setView=function(t){return this._view=t,this},t.prototype.__row={watch:"rowDidSet",name:"row"},t.prototype.row=function(t){return this._row},t.prototype.setRow=function(t){var e=this.row();return t!=e&&(this._row=t),t!=e&&this.rowDidSet&&this.rowDidSet(t,e,this.__row),this},t.prototype.__col={watch:"colDidSet",name:"col"},t.prototype.col=function(t){return this._col},t.prototype.setCol=function(t){var e=this.col();return t!=e&&(this._col=t),t!=e&&this.colDidSet&&this.colDidSet(t,e,this.__col),this},t.prototype.__len={watch:"lenDidSet",name:"len"},t.prototype.len=function(t){return this._len},t.prototype.setLen=function(t){var e=this.len();return t!=e&&(this._len=t),t!=e&&this.lenDidSet&&this.lenDidSet(t,e,this.__len),this},t.prototype.rowDidSet=function(t,e){var n=""+this.object().row()*this.view().lineHeight()+"px";return this._dom.style.top=n},t.prototype.colDidSet=function(t,e){var n=""+this.object().col()*this.view().charWidth()+"px";return this._dom.style.left=n},t.prototype.lenDidSet=function(t,e){var n=""+t*this.view().charWidth()+"px";return this._dom.style.width=n},t.prototype.render=function(){var t=this.object().region();return t&&(this.setRow(this.object().row()),this.setCol(this.object().col()),this.setLen(t.size())),this.flag("warn").flag("global",!t).setType(this.object().type()).setChildren((this.$a=this.$a||tag$.$hint_label().flag("label")).setLabel(this.object().label()).end(),2).synced()}}),tag$.defineTag("jsview",function(t){t.prototype.render=function(){return this.setChildren((this._code=this._code||tag$.$code().setRef("code",this)).end(),2).synced()},t.prototype.load=function(t,e){var n=this;return t=t.replace(/\/\/\# sourceMapping(.*)$/,""),t=t.replace(/^\(function\(\)\{\n/,""),t=t.replace(/\n?\}\)\(\)\n?$/,""),this._code.textContent=t,this.flag("huge",t.length>1e3),setTimeout(function(){hljs.configure({classPrefix:""});var r=hljs.highlight("javascript",t);return n._code.setHtml(r.value),e&&e(n)},0),n}}),tag$.defineTag("console",function(t){t.prototype.editor=function(t){return this._editor},t.prototype.setEditor=function(t){return this._editor=t,this},t.prototype.reset=function(){return this.empty(),this},t.prototype.log=function(t){console.log.apply(console,arguments),this.editor()&&this.editor().flag("console"),t!=this&&(t&&t.dom?t=t.dom().outerHTML:t instanceof Object&&(t=JSON.stringify(t)),void 0!=t&&this.append(tag$.$div().flag("json").setContent(t,0).end()))}}),tag$.defineTag("snippet",function(t){var e=0;t.prototype.imba=function(t){return this._imba},t.prototype.setImba=function(t){return this._imba=t,this},t.prototype.config=function(t){return this._config},t.prototype.setConfig=function(t){return this._config=t,this},t.prototype.__src={watch:"reload",name:"src"},t.prototype.src=function(t){return this._src},t.prototype.setSrc=function(t){var e=this.src();return t!=e&&(this._src=t),t!=e&&this.reload&&this.reload(t,e,this.__src),this},t.prototype.heading=function(t){return this.getAttribute("heading")},t.prototype.setHeading=function(t){return this.setAttribute("heading",t),this},t.prototype.layout=function(t){return this.getAttribute("layout")},t.prototype.setLayout=function(t){return this.setAttribute("layout",t),this},t.prototype.tab=function(t){return this.getAttribute("tab")},t.prototype.setTab=function(t){return this.setAttribute("tab",t),this},t.prototype.__active={watch:"activeDidSet",name:"active"},t.prototype.active=function(t){return this._active},t.prototype.setActive=function(t){var e=this.active();return t!=e&&(this._active=t),t!=e&&this.activeDidSet&&this.activeDidSet(t,e,this.__active),this},t.prototype.id=function(){var t;return(t=this.dom()).id||(t.id="snippet"+e++)},t.prototype.activeDidSet=function(t){return t?this.schedule({fps:60}):this.unschedule()},t.prototype.input=function(){return(this._input=this._input||tag$.$imcaptor().setRef("input",this)).end()},t.prototype.view=function(){return this._view||(this._view=(this._view=this._view||tag$.$imview().setRef("view",this)).setInput(this.input()).end())},t.prototype.build=function(){var e=this;return t.__super__.build.apply(e,arguments),e.src()?e.reload():void 0},t.prototype.setConfig=function(t){var e;return t!=this._options&&(this._options=t,t.title&&(this.setHeading(e=t.title),e)),this},t.prototype.copts=function(){return this._copts||(this._copts={bare:!1,standalone:!1,sourceMapInline:!0,filename:""+this.id()+".imba",targetPath:""+this.id()+".js",sourcePath:""+this.id()+".imba"})},t.prototype.option=function(t){return this._options?this._options[t]:null},t.prototype.configure=function(t){return this._options=t,this.render()},t.prototype.awaken=function(){var t={};try{var e=q$$(".imbacode",this).dom().innerHTML}catch(n){}return e&&(t.html=e,this.view().load(null,{html:e}),this.configure(t)),this},t.prototype.load=function(t,e){return void 0===e&&(e={}),(t||e.html)&&this.view().load(t,e),this},t.prototype.code=function(){return this.view().code()},t.prototype.compile=function(t,e,n){return void 0==n&&"function"==typeof e&&(n=e,e=this.copts()),void 0==e&&(e=this.copts()),Scrimbla.worker().compile(t,e,n)},t.prototype.overlays=function(){for(var t,e=0,n=iter$(this.view().hints()),r=n.length,i=[];r>e;e++)t=n[e],t.active()&&i.push((this["_hint"+e]=this["_hint"+e]||tag$.$overlay_hint()).setView(this.view()).setObject(t).end());return i},t.prototype.toggleJS=function(){return"js"!=this.tab()?this.showjs():this.setTab("imba"),this},t.prototype.oninputfocus=function(t){return VIEW=this,this.flag("focus"),this.setActive(!0),!0},t.prototype.oninputblur=function(t){this.unflag("focus");var e=t.event().relatedTarget;return e&&this.dom().contains(e)||(this.unflag("focus"),this.setActive(!1)),this},t.prototype.render=function(){var t,e,n,r,i,o;return this.setChildren([this._input,(t=this._main=this._main||tag$.$section().setRef("main",this)).setContent([(e=this._header=this._header||tag$.$header().setRef("header",this)).setContent([(n=e.$$a=e.$$a||tag$.$div().flag("title").flag("path")).setContent(this.heading(),3).end(),(r=e.$$b=e.$$b||tag$.$div().flag("tools")).setContent([(r.$$a=r.$$a||tag$.$tool().flag("reset").setTitle("reset").setHandler("tap","reset",this)).setText("reset").end(),(r.$$b=r.$$b||tag$.$tool().flag("js").setTitle("show js").setHandler("tap","toggleJS",this)).setText("show js").end(),(r.$$c=r.$$c||tag$.$tool().flag("run").setTitle("run").setHandler("tap","run",this)).setText("run").end()],2).end()],2).end(),(i=this._overlays=this._overlays||tag$.$overlays().setRef("overlays",this)).setView(this.view()).setContent(this.overlays(),3).end(),(this._jsview=this._jsview||tag$.$jsview().setRef("jsview",this)).end(),this._view.end(),(this._console=this._console||tag$.$console().setRef("console",this).flag("dark")).setEditor(this).end()],1).end(),(o=this._inspector=this._inspector||tag$.$div().setRef("inspector",this)).setContent(this.playground(),3).end()],1).synced()},t.prototype.sandbox=function(){return(this._sandbox=this._sandbox||tag$.$sandbox().setRef("sandbox",this).flag("playground")).setEditor(this).end()},t.prototype.playground=function(){return this.sandbox()},t.prototype.reload=function(){var t=this;if(t._built){if(DEPS[t.src()]){var e=DEPS[t.src()];return t.view().load(null,{html:e.html,filename:t.src()}),t.autorun()&&setTimeout(function(){return t.run()},50),t}return APP.fetchDocument(t.src(),function(e){return t.view().load(e.body,{filename:t.src()}),t.autorun()?setTimeout(function(){return t.run()},50):void 0}),t}},t.prototype.onrun=function(){return this.run()},t.prototype.autorun=function(){return!1},t.prototype.oneditedasync=function(){return this.flag("dirty"),this},t.prototype.onsave=function(){return this.view().hints().clear(),this.run()},t.prototype.reset=function(t){return this._console.reset(),this._options.html&&this.view().load(null,{html:this._options.html}),t&&t.cancel(),this.unflag("dirty"),this.view().caret().normalize().dirty(),this},t.prototype.run=function(){var t=this;return t.flag("running"),t.compile(t.code(),t.copts(),function(e){if(t.view().hints().rem(function(t){return"runtime"==t.group()}),e.data&&e.data.code)try{return t._sandbox.run(e.data)}catch(n){return console.log("error")}}),t},t.prototype.showjs=function(){var t=this,e={bare:!0,standalone:!1,filename:"a.imba"};return t.compile(t.code(),e,function(e){return e.data&&e.data.code?t._jsview.load(e.data.code,function(){var e;return t.setTab(e="js"),e}):e.data&&e.data.error?console.log("has error"):void 0})},t.prototype.runError=function(t){return t.type="error",t.group="runtime",this.view().hints().add(t).activate(),this.render()},t.prototype.runLog=function(t){if(t.type="log",t.group="runtime",t.message||(t.message=JSON.stringify(t.params[0])),null!=t.nr&&!t.loc){var e=this.view().find('.identifier.log,.identifier[name="log"]').toArray(),n=e[t.nr];if(t.node=n,n){var r=n.region();console.log("found loc!!",n,r),t.loc=r.endAtLine().collapse()}}return this.view().hints().add(t).activate(),this.render()},t.prototype.runResult=function(t){return this.flag("repl",!!t),this._console.log(t),this}}),tag$.defineTag("example","snippet",function(t){t.prototype.autorun=function(){return!0}}),Imba.Event.PROCESSING;var prev=Imba.Event.prototype.process;return Imba.Event.prototype.process=function(){return Imba.Event.PROCESSING=this,prev.call(this)},tag$.defineTag("sandbox",function(tag){tag.prototype.editor=function(t){return this._editor},tag.prototype.setEditor=function(t){return this._editor=t,this},tag.prototype.render=function(){return this},tag.prototype.console=function(){return this.editor()._console},tag.prototype.onerror=function(t,e,n,r,i){var o;if(e.match(/snippet(\d+)\.(imba|js)/)){var s=e.split(".").shift(),a=tag$wrap(document.getElementById(s));if(a)return void a.playground().onerror(t,"",n,r,i)}else if("undefined"==e){var u=Imba.Event.PROCESSING;if(console.log("last event target",u&&u.target()),u&&u.target()&&(a=u.target().closest(q$("._snippet",this))))return a.playground().onerror(t,"",n,r,i)}console.log("caught the error here!!!",arguments,this);var h=[];if(i&&(o=i.stack)&&o.replace&&o.replace(/(\<anonymous\>|snippet\d+\.imba)\:(\d+):(\d+)/g,function(t,e,n,r){return h.push({line:parseInt(n),column:parseInt(r)}),""}),h.push({line:n,column:r}),h[0]){var c=this.object().sourcemap,p=Scrimbla.SourceMap.SourceMapConsumer(c),l=p.originalPositionFor(h[0]);console.log("original location is",l),this.editor().runError({message:t,loc:l})}return!0},tag.prototype.onlog=function(t,e){return this.editor().runLog({nr:t,params:e}),this},tag.prototype.empty=function(){for(var t=0,e=iter$(q$(".scheduled_",this)),n=e.length;n>t;t++)e[t].unschedule();return tag.__super__.empty.apply(this,arguments)},tag.prototype.present=function(t){var e;return t&&t.prototype instanceof Imba.Tag?e=new t(t.createNode()):t instanceof Imba.Tag&&(e=t),e&&(this.empty().append(e),e.end()),this.console().log(e||t)},tag.prototype.run=function(src){var self=this,code=src.code;if(!code)return self;self._object=src;try{window.onerror=function(t,e,n,r,i){return console.log("caught error",t,e,n,r,i,this),self.onerror(t,e,n,r,i)},code=code+"\n//# sourceURL="+self.editor().id()+".imba";var tag$=Imba.TAGS.__clone(),console=self.console(),res=eval(code);self.present(res)}catch(e){self.log("immediate error in eval-inline",e),self.onerror(e.message,"",e.lineNr||e.line||0,e.column,e)}return self}})}()},function(t,e){!function(){function t(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=Object.create(e.prototype),t.__super__=t.prototype.__super__=e.prototype,t.prototype.initialize=t.prototype.constructor=t}function n(t,e){this.error=t,this.message=t.message,this.filename=t.filename,this.line=t.line,this._options=e||{}}return t(n,Error),e.ImbaParseError=n,n.wrap=function(t){return new n(t)},n.prototype.set=function(t){this._options||(this._options={});for(var e=0,n=Object.keys(t),r=n.length;r>e;e++)this._options[n[e]]=t[n[e]];return this},n.prototype.start=function(){for(var t=this._options,e=t.pos-1,n=t.tokens&&t.tokens[e];n&&-1==n._loc;)n=t.tokens[--e];return n},n.prototype.desc=function(){var t=this._options,e=this.message;return t.token&&-1==t.token._loc?"Syntax Error":e},n.prototype.loc=function(){var t;return(t=this.start())&&t.region&&t.region()},n.prototype.toJSON=function(){this._options,this.start();return{warn:!0,message:this.desc(),loc:this.loc()}},n}()},function(t,e,n){!function(){function r(t,e){return e&&e.indexOf?e.indexOf(t):[].indexOf.call(t,e)}function i(t){return t?t.toArray?t.toArray():t:[]}function o(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=Object.create(e.prototype),t.__super__=t.prototype.__super__=e.prototype,t.prototype.initialize=t.prototype.constructor=t}function s(t,e,n){return this.message=t,this.file=e,this.line=n,this}function a(t,e){return void 0===e&&(e=0),t[t.length-e-1]}function u(t,e){return t.split(e).length-1}function h(t,e){for(var n="";e>0;)e%2==1&&(n+=t),t+=t,e>>=1;return n}function c(){this.reset()}var p,l=n(8),f=l.Token,d=n(27),g=d.Rewriter,m=d.INVERSES,y=n(25),_=["true","false","null","this","delete","typeof","in","instanceof","throw","break","continue","debugger","if","else","switch","for","while","do","try","catch","finally","class","extends","super","return"],v=["undefined","then","unless","until","loop","of","by","when","def","tag","do","elif","begin","var","let","self","await","import"],b=["extend","static","local","export","global","prop"],T={and:"&&",or:"||",is:"==",isnt:"!=",not:"!",yes:"true",no:"false",isa:"instanceof","case":"switch",nil:"null"},$=Object.keys(T);v=v.concat($),t.exports.ALL_KEYWORDS=p=["true","false","null","this","delete","typeof","in","instanceof","throw","break","continue","debugger","if","else","switch","for","while","do","try","catch","finally","class","extends","super","return","undefined","then","unless","until","loop","of","by","when","def","tag","do","elif","begin","var","let","self","await","import","and","or","is","isnt","not","yes","no","isa","case","nil"];var I=["case","default","function","void","with","const","enum","native"],w=(_.concat(I),/^((([\x23]?[\$A-Za-z_\x7f-\uffff][$\-\w\x7f-\uffff]*)([\=]?))|(<=>|\|(?![\|=])))/),A=/^((\$|@@|@|\#)[\wA-Za-z_\-\x7f-\uffff][$\w\x7f-\uffff]*(\-[$\w\x7f-\uffff]+)*|[$A-Za-z_][$\w\x7f-\uffff]*(\-[$\w\x7f-\uffff]+)*)([^\n\S]*:(?![\*\=:$\w\x7f-\uffff]))?/,k=/^((\$|@@|@|)[$A-Za-z_\x7f-\uffff\-][$\w\x7f-\uffff\-]*)([^\n\S\s]*:(?![\*\=:$\w\x7f-\uffff]))/,E=/^(\<|%)(?=[A-Za-z\#\.\{\@\>])/,x=/^(\w[\w\d]*:)?(\w[\w\d]*)(-[\w\d]+)*/,S=/^#((\w[\w\d]*)(-[\w\d]+)*)/,R=/^([\.\:]?[\w\_]+([\-\:][\w]+)*)(\s)*\=/,C=/^([%\$]{1,2})([\(\w\#\.\[])/,N=/^(\#|\.|:|::)?([\w]+(\-[\w]+)*)/,O=/^ (\+|\>|\~)*\s*(?=[\w\.\#\:\{\*\[])/,L=/^\[([\w\_\-]+)(\$=|\~=|\^=|\*=|\|=|=|\!=)/,M=/^\:((([\*\@$\w\x7f-\uffff]+)+([\-\\/\\\:][\w\x7f-\uffff]+)*)|==|\<=\>|\[\]|\[\]\=|\*|[\\/,\\])/,D=/^0x[\da-f]+|^0b[01]+|^\d*\.?\d+(?:e[+-]?\d+)?/i,P=/^("""|''')([\s\S]*?)(?:\n[^\n\S]*)?\1/,j=/^(?:[-=]=>|===|->|!==|[-+*\/%<>&|^!?=]=|=<|>>>=?|([-+:])\1|([&|<>])\2=?|\?\.|\?\:|\.{2,3}|\*(?=[a-zA-Z\_]))/,G=/^[^\n\S]+/,F=/^###([^#][\s\S]*?)(?:###[^\n\S]*|(?:###)?$)/,H=/^(\s*)(#[ \t\!](.*)|#[ \t]?(?=\n|$))+/,q=/^[-=]=>/,B=/^(?:\n[^\n\S]*)+/,U=/^'[^\\']*(?:\\.[^\\']*)*'/,z=/^`[^\\`]*(?:\\.[^\\`]*)*`/,V=/^(\/(?![\s=])[^[\/\n\\]*(?:(?:\\[\s\S]|\[[^\]\n\\]*(?:\\[\s\S][^\]\n\\]*)*])[^[\/\n\\]*)*\/)([imgy]{0,4})(?!\w)/,W=/^\/{3}([\s\S]+?)\/{3}([imgy]{0,4})(?!\w)/,Y=/\s+(?:#.*)?/g,K=/\n/g,X=/\n+([^\n\S]*)/g,J=/\*\//,Z=/^\s*(?:,|\??\.(?![.\d])|::)/,Q=/^[A-Z]/,tt=/^\$\d$/,et=["-=","+=","/=","*=","%=","||=","&&=","?=","<<=",">>=",">>>=","&=","^=","|=","=<"],nt=["!","~","NEW","TYPEOF","DELETE"],rt=["&&","||","&","|","^"],it=["<<",">>",">>>"],ot=["===","!==","==","!=","<",">","<=",">=","===","!=="],st=["<=>","<<",".."],at=["*","/","%","∪","∩","√"],ut=["IN","OF","INSTANCEOF","ISA"],ht=["NUMBER","REGEX","BOOL","TRUE","FALSE","++","--","]"],ct=["NUMBER","REGEX","BOOL","TRUE","FALSE","++","--","]",")","}","THIS","SELF","IDENTIFIER","STRING"],pt=["\\",".","?.","?:","UNARY","MATH","+","-","SHIFT","RELATION","COMPARE","LOGIC","COMPOUND_ASSIGN","THROW","EXTENDS"],lt=["IDENTIFIER","STRING","REGEX",")","]","THIS","SUPER","TAG_END","IVAR","GVAR","SELF","CONST","NEW","ARGVAR","SYMBOL","RETURN"],ft=["IDENTIFIER","STRING","REGEX",")","]","THIS","SUPER","TAG_END","IVAR","GVAR","SELF","CONST","NEW","ARGVAR","SYMBOL","RETURN","NUMBER","BOOL","TAG_SELECTOR","IDREF","ARGUMENTS","}","TAG_TYPE"],dt=["INDENT","OUTDENT","TERMINATOR"];o(s,SyntaxError),e.LexerError=s;var gt=l.typ,mt=l.val,yt=l.setTyp,_t=l.setVal;return e.Lexer=c,c.prototype.reset=function(){return this._code=null,this._chunk=null,this._opts=null,this._indent=0,this._indebt=0,this._outdebt=0,this._indents=[],this._ends=[],this._contexts=[],this._scopes=[],this._nextScope=null,this._tokens=[],this._seenFor=!1,this._loc=0,this._locOffset=0,this._end=null,this._char=null,this._bridge=null,this._last=null,this._lastTyp="",this._lastVal=null,this},c.prototype.jisonBridge=function(t){return this._bridge={lex:l.lex,setInput:function(t){return this.tokens=t,this.pos=0},upcomingInput:function(){return""}}},c.prototype.tokenize=function(t,e){if(void 0===e&&(e={}),0==t.length)return[];if(!e.inline){if(G.test(t)&&(t="\n"+t,t.match(/^\s*$/g)))return[];t=t.replace(/\r/g,"").replace(/[\t ]+$/g,"")}return this._last=null,this._lastTyp=null,this._lastVal=null,this._code=t,this._opts=e,this._locOffset=e.loc||0,e._tokens=this._tokens,e.profile&&console.time("tokenize:lexer"),this.parse(t),e.inline||this.closeIndentation(),!e.silent&&this._ends.length&&this.error("missing "+this._ends.pop()),e.profile&&console.timeEnd("tokenize:lexer"),0==e.rewrite||e.norewrite?this._tokens:(new g).rewrite(this._tokens,e)},c.prototype.parse=function(t){for(var e=0,n=0;this._chunk=t.slice(e);)this._loc=this._locOffset+e,n="TAG"==this._end&&this.tagDefContextToken()||this._inTag&&this.tagContextToken()||this.basicContext(),e+=n},c.prototype.basicContext=function(){return this.selectorToken()||this.symbolToken()||this.methodNameToken()||this.identifierToken()||this.whitespaceToken()||this.lineToken()||this.commentToken()||this.heredocToken()||this.tagToken()||this.stringToken()||this.numberToken()||this.regexToken()||this.jsToken()||this.literalToken()||0},c.prototype.moveCaret=function(t){return this._loc+=t},c.prototype.context=function(){return this._ends[this._ends.length-1]},c.prototype.inContext=function(t){var e=this._contexts[this._contexts.length-1];return e&&e[t]},c.prototype.pushEnd=function(t){return this._ends.push(t),this._contexts.push(null),this._end=t,this.refreshScope(),this},c.prototype.popEnd=function(t){return this._ends.pop(),this._contexts.pop(),this._end=this._ends[this._ends.length-1],this.refreshScope(),this},c.prototype.refreshScope=function(){var t=this._ends[this._ends.length-1],e=this._ends[this._ends.length-2];return this._inTag="TAG_END"==t||"TAG_END"==e&&"OUTDENT"==t},c.prototype.queueScope=function(t){return this._scopes[this._indents.length]=t,this},c.prototype.popScope=function(t){return this._scopes.pop(),this},c.prototype.getScope=function(){return this._scopes[this._indents.length-1]},c.prototype.scope=function(t,e){this._ends.push(this._end=t);return this._contexts.push(e||null),t},c.prototype.closeSelector=function(){return"%"==this._end?(this.token("SELECTOR_END","%",0),this.pair("%")):void 0},c.prototype.openDef=function(){return this.pushEnd("DEF")},c.prototype.closeDef=function(){if("DEF"==this.context()){var t=a(this._tokens);if("DEF_FRAGMENT"==gt(t));else if("TERMINATOR"==gt(t)){var e=this._tokens.pop();this.token("DEF_BODY","DEF_BODY",0),this._tokens.push(e)}else this.token("DEF_BODY","DEF_BODY",0);this.pair("DEF")}},c.prototype.tagContextToken=function(){var t;if("#"==this._chunk[0])return this.token("#","#",1),1;if(t=R.exec(this._chunk)){"TAG_NAME"!=this._lastTyp&&("TERMINATOR"==this._lastTyp||this.token(",",","));var e=t[0].length;return this.token("TAG_ATTR",t[1],e-1),this._loc+=e-1,this.token("=","=",1),e}return 0},c.prototype.tagDefContextToken=function(){var t;if(t=x.exec(this._chunk))return this.token("TAG_TYPE",t[0],t[0].length),t[0].length;if(t=S.exec(this._chunk)){var e=t[0];return this.token("TAG_ID",e,e.length),e.length}return 0},c.prototype.tagToken=function(){var t,e;if(!(t=E.exec(this._chunk)))return 0;var e=i(t),n=e[0],r=e[1],o=e[2];if("<"==r){if(this.token("TAG_START","<",1),this.pushEnd(m.TAG_START),(t=x.exec(this._chunk.substr(1,40)))&&"self"!=t[0])return this.token("TAG_TYPE",t[0],t[0].length,1),n.length+t[0].length;if(o){if("{"==o.substr(0,1))return r.length;this.token("TAG_NAME",n.substr(1),0)}}return n.length},c.prototype.selectorToken=function(){var t,e;if("%"==this._end){var n=this._chunk.charAt(0),o=this.inContext("open");if(o&&(" "==n||"\n"==n||","==n||"+"==n||"~"==n||")"==n||"]"==n))return this.token("SELECTOR_END","%",0),this.pair("%"),0;if(e=O.exec(this._chunk))return this.token("SELECTOR_COMBINATOR",e[1]||" ",e[0].length),e[0].length;if(e=N.exec(this._chunk)){var s=e[1],a=e[2];switch(s){case".":u="SELECTOR_CLASS";break;case"#":u="SELECTOR_ID";break;case":":u="SELECTOR_PSEUDO_CLASS";break;case"::":u="SELECTOR_PSEUDO_CLASS";break;default:var u="SELECTOR_TAG"}return this.token(u,e[2],e[0].length),e[0].length}if("["==n){if(this.token("[","[",1),this.pushEnd("]"),e=L.exec(this._chunk)){var h=e[0].indexOf(e[1]),c=e[0].indexOf(e[2]);return this.token("IDENTIFIER",e[1],e[1].length,h),this.token("SELECTOR_ATTR_OP",e[2],e[2].length,c),e[0].length}return 1}if("|"==n){var p=this._tokens[this._tokens.length-1];return yt(p,"SELECTOR_NS"),1}if(","==n)return this.token("SELECTOR_GROUP",",",1),1;if("*"==n)return this.token("UNIVERSAL_SELECTOR","*",1),1;if(")"==n)return this.pair("%"),this.token("SELECTOR_END",")",1),1;if(r(n,[")","}","]",""])>=0)return this.pair("%"),0}if(!(e=C.exec(this._chunk)))return 0;var t=i(e),a=(t[0],t[1]),l=t[2];return"("==l?(this.token("SELECTOR_START",a,a.length+1),this.pushEnd("%"),a.length+1):"%"==a?"%"==this.context()?1:(this.token("SELECTOR_START",a,a.length),this.scope("%",{open:!0}),a.length):0},c.prototype.methodNameToken=function(){if(" "==this._chunk.charAt(0))return 0;var t;if(")"==this._end){var e=this._ends[this._ends.length-2];if("%"==e&&(t=R.exec(this._chunk)))return this.token("TAG_ATTR_SET",t[1]),t[0].length}if(!(t=w.exec(this._chunk)))return 0;var n=t[0].length,r=t[0],i=this._lastTyp,o="IDENTIFIER",s=r.charAt(0),a=!1,u=t[4];return"."==i||"DEF"==i||"!"==u||"?"==u||t[5]?"self"==r||"this"==r||"super"==r?0:("new"==r&&(o="NEW"),"..."==r&&[",","(","CALL_START","BLOCK_PARAM_START","PARAM_START"].indexOf(i)>=0?0:"|"==r?"("==i||"CALL_START"==i?(this.token("DO","DO",0),this.pushEnd("|"),this.token("BLOCK_PARAM_START",r,1),n):"DO"==i||"{"==i?(this.pushEnd("|"),this.token("BLOCK_PARAM_START",r,1),n):"|"==this._ends[this._ends.length-1]?(this.token("BLOCK_PARAM_END","|",1),this.pair("|"),n):0:["&","^","<<","<<<",">>"].indexOf(r)>=0||"|"==r&&"|"!=this.context()?0:(st.indexOf(r)>=0&&(a=!0),"@"==s?o="IVAR":"$"==s||("#"==s?o="TAGID":(Q.test(s)||"require"==r||"global"==r||"exports"==r)&&(o="CONST")),t[5]&&["IDENTIFIER","CONST","GVAR","CVAR","IVAR","SELF","THIS","]","}",")","NUMBER","STRING","IDREF"].indexOf(i)>=0&&this.token(".",".",0),this.token(o,r,n),a&&(this._last.spaced=!0),n)):0},c.prototype.inTag=function(){var t=this._ends.length;if(t>0){var e=this._ends[t-1],n=t>1?this._ends[t-2]:e;return"TAG_END"==e||"TAG_END"==n&&"OUTDENT"==e}return!1},c.prototype.isKeyword=function(t){if("attr"==t||"prop"==t){var e=this.getScope(),n="CLASS"==e||"TAG"==e;if(n)return!0}return p.indexOf(t)>=0},c.prototype.identifierToken=function(){var t,e,n,o=this._ends[this._ends.length-1],s=this._ends[this._ends.length-2],u=!1,h="TAG_END"==o||"TAG_END"==s&&"OUTDENT"==o;if(h&&(e=R.exec(this._chunk))){"TAG_NAME"!=this._lastTyp&&("TERMINATOR"==this._lastTyp||this.token(",",","));var c=e[0].length;return this.token("TAG_ATTR",e[1],c-1),this._loc+=c-1,this.token("=","=",1),c}if(e=k.exec(this._chunk)){var p=e[1];return n="IDENTIFIER",this.token(n,p,p.length),this.moveCaret(p.length),this.token(":",":",e[3].length),this.moveCaret(-p.length),e[0].length}if(!(e=A.exec(this._chunk)))return 0;var t=i(e),l=t[0],p=t[1],n=t[2],f=(t[3],t[4],t[5]),d=p.length;if("own"==p&&"FOR"==this.lastTokenType())return this.token("OWN",p,p.length),p.length;var g,m=a(this._tokens),y=this._lastTyp;g=f||"."==y||"?."==y,f&&"?"==y&&(g=!1),"tag"==p&&0==this._chunk.indexOf("tag(")&&(g=!0);var _=!1;if("$"==n&&tt.test(p))"$0"==p?n="ARGUMENTS":(n="ARGVAR",p=p.substr(1));else if("@"==n)n="IVAR";else if("#"==n)n="IDENTIFIER",this.token("#","#"),p=p.substr(1);else if("@@"==n)n="CVAR";else if("$"!=n||f)if(Q.test(p)||"require"==p||"global"==p||"exports"==p)n="CONST";else{if("elif"==p)return this.token("ELSE","elif",p.length),this.token("IF","if"),p.length;n="IDENTIFIER"}else n="IDENTIFIER";if(!g&&(_=this.isKeyword(p))&&(n=p.toUpperCase(),u=!0,"YES"==n?n="TRUE":"NO"==n?n="FALSE":"NIL"==n?n="NULL":"VAR"==n?"export"==this._lastVal&&yt(m,"EXPORT"):"IF"==n||"ELSE"==n||"TRUE"==n||"FALSE"==n||"NULL"==n||("TAG"==n?this.pushEnd("TAG"):"DEF"==n?this.openDef():"DO"==n?"DEF"==this.context()&&this.closeDef():"WHEN"==n&&dt.indexOf(this.lastTokenType())>=0?n="LEADING_WHEN":"FOR"==n?this._seenFor=!0:"UNLESS"==n?n="IF":nt.indexOf(n)>=0?n="UNARY":ut.indexOf(n)>=0&&("INSTANCEOF"!=n&&"ISA"!=n&&this._seenFor?(n="FOR"+n,
this._seenFor=!1):(n="RELATION","!"==String(this.value())&&(this._tokens.pop(),p="!"+p))))),"super"==p&&(n="SUPER"),!g)switch(_&&$.indexOf(p)>=0&&(p=T[p]),p){case"!":n="UNARY";break;case"==":case"!=":case"===":case"!==":n="COMPARE";break;case"&&":case"||":n="LOGIC";break;case"break":case"continue":case"debugger":case"arguments":n=p.toUpperCase()}var v=l.length;if("CLASS"==n||"DEF"==n||"TAG"==n){this.queueScope(n);for(var I=this._tokens.length;I;){m=this._tokens[--I];var w=""+mt(m);if(!(r(w,b)>=0))break;yt(m,w.toUpperCase())}}else"IF"==n?this.queueScope(n):"IMPORT"==n?this.pushEnd("IMPORT"):"from"==p&&"IMPORT"==o?(n="FROM",this.pair("IMPORT")):"as"==p&&"IMPORT"==o&&(n="AS",this.pair("IMPORT"));return"IDENTIFIER"==n&&"CATCH"==y&&(n="CATCH_VAR"),f?(this.token(n,p,d),this.moveCaret(d),this.token(":",":",f.length),this.moveCaret(-d)):this.token(n,p,d),v},c.prototype.numberToken=function(){var t,e,n,r;if(!(e=D.exec(this._chunk)))return 0;n=e[0],r=n.length,(t=/0b([01]+)/.exec(n))&&(n=""+parseInt(t[1],2));var i=a(this._tokens);return"."==e[0][0]&&i&&!i.spaced&&["IDENTIFIER",")","}","]","NUMBER"].indexOf(gt(i))>=0&&(this.token(".","."),n=n.substr(1)),this.token("NUMBER",n,r),r},c.prototype.symbolToken=function(){var t,e,n;if(!(t=M.exec(this._chunk)))return 0;if(e=t[0].substr(1),n=a(this._tokens),n&&!n.spaced&&-1==r(gt(n),["(","{","[",".","CALL_START","INDEX_START",",","=","INDENT","TERMINATOR"])){this.token(".:",":",1);var i=e.split(/[\:\\\/]/)[0];return this.token("IDENTIFIER",i,i.length,1),i.length+1}return this.token("SYMBOL",e,t[0].length),t[0].length},c.prototype.escapeStr=function(t,e,n){if(t=t.replace(K,e?"\\n":""),n){var r=RegExp("\\\\["+n+"]","g");t=t.replace(r,n),t=t.replace(RegExp(""+n,"g"),"\\$&")}return t},c.prototype.stringToken=function(){var t,e;switch(this._chunk.charAt(0)){case"'":if(!(t=U.exec(this._chunk)))return 0;e=t[0],this.token("STRING",this.escapeStr(e),e.length);break;case'"':if(!(e=this.balancedString(this._chunk,'"')))return 0;if(e.indexOf("{")>=0){var n=e.length;this.token("STRING_START",e.charAt(0),1),this.interpolateString(e.slice(1,-1)),this.token("STRING_END",e.charAt(n-1),1,e.length-1)}else n=e.length,this.token("STRING",this.escapeStr(e),n);break;default:return 0}return this.moveHead(e),e.length},c.prototype.heredocToken=function(){var t,e,n,r;if(!(t=P.exec(this._chunk)))return 0;if(e=t[0],n=e.charAt(0),r=this.sanitizeHeredoc(t[2],{quote:n,indent:null}),'"'==n&&r.indexOf("{")>=0){var i=t[1];this.token("STRING_START",i,i.length),this.interpolateString(r,{heredoc:!0,offset:i.length,quote:n}),this.token("STRING_END",i,i.length,e.length-i.length)}else this.token("STRING",this.makeString(r,n,!0),0);return this.moveHead(e),e.length},c.prototype.commentToken=function(){var t,e,n,r,i,o="HERECOMMENT";if(t=H.exec(this._chunk)){e=t[0].length,r=t[1],n=t[2],i=a(this._tokens);var s=i&&gt(i),u="//"+n.substr(1);return this._last&&this._last.spaced&&(u=" "+u),s&&"INDENT"!=s&&"TERMINATOR"!=s||!s?this.token("TERMINATOR",u,e):"TERMINATOR"==s?_t(i,mt(i)+u):"INDENT"==s?this.addLinebreaks(1,u):this.token(o,n.substr(2),e),e}if(!(t=F.exec(this._chunk)))return 0;n=t[0];var h=t[1];return h?(this.token("HERECOMMENT",this.sanitizeHeredoc(h,{herecomment:!0,indent:Array(this._indent+1).join(" ")}),n.length),this.token("TERMINATOR","\n")):(this.token("HERECOMMENT",n,n.length),this.token("TERMINATOR","\n")),this.moveHead(n),n.length},c.prototype.jsToken=function(){var t,e;return"`"==this._chunk.charAt(0)&&(t=z.exec(this._chunk))?(this.token("JS",(e=t[0]).slice(1,-1)),e.length):0},c.prototype.regexToken=function(){var t,e,n,o;if("/"!=this._chunk.charAt(0))return 0;if(e=W.exec(this._chunk))return n=this.heregexToken(e),this.moveHead(e[0]),n;if(o=a(this._tokens),o&&r(gt(o),o.spaced?ht:ct)>=0)return 0;if(!(e=V.exec(this._chunk)))return 0;var t=i(e),s=t[0],u=t[1],h=t[2];return"//"==u&&(u="/(?:)/"),this.token("REGEX",""+u+h,s.length),s.length},c.prototype.heregexToken=function(t){var e,e=i(t),n=e[0],r=e[1],o=e[2];if(0>r.indexOf("#{")){var s=r.replace(Y,"").replace(/\//g,"\\/");return s.match(/^\*/)&&this.error("regular expressions cannot begin with `*`"),this.token("REGEX","/"+(s||"(?:)")+"/"+o,n.length),n.length}this.token("CONST","RegExp"),this._tokens.push(l.token("CALL_START","(",0));for(var a,u=[],h=0,c=i(this.interpolateString(r,{regex:!0})),p=c.length;p>h;h++){a=c[h];var f=gt(a),d=mt(a);if("TOKENS"==f)u.push.apply(u,d);else{if(d||console.log("what??"),!(d=d.replace(Y,"")))continue;d=d.replace(/\\/g,"\\\\"),u.push(l.token("STRING",this.makeString(d,'"',!0),0))}u.push(l.token("+","+",0))}return u.pop(),u[0]&&"STRING"==gt(u[0])||this._tokens.push(l.token("STRING",'""'),l.token("+","+")),this._tokens.push.apply(this._tokens,u),o&&(this._tokens.push(l.token(",",",",0)),this._tokens.push(l.token("STRING",'"'+o+'"',0))),this.token(")",")",0),n.length},c.prototype.lineToken=function(){var t;if(!(t=B.exec(this._chunk)))return 0;var e=t[0],n=this.moveHead(e);this._seenFor=!1;var r=(a(this._tokens,1),e.length-1-e.lastIndexOf("\n")),i=this.unfinished();if(/^\n#\s/.test(this._chunk))return this.addLinebreaks(1),0;if(r-this._indebt==this._indent)return i?this.suppressNewlines():this.newlineToken(n),e.length;if(r>this._indent){if(i)return this._indebt=r-this._indent,this.suppressNewlines(),e.length;if(this.inTag())return e.length;var o=r-this._indent+this._outdebt;this.closeDef();var s=a(this._tokens);s&&"TERMINATOR"==gt(s)?(yt(s,"INDENT"),s._meta||(s._meta={pre:mt(s),post:""})):this.token("INDENT",""+o,0),this._indents.push(o),this.pushEnd("OUTDENT"),this._outdebt=this._indebt=0,this.addLinebreaks(n)}else this._indebt=0,this.outdentToken(this._indent-r,i,n),this.addLinebreaks(n-1);return this._indent=r,e.length},c.prototype.outdentToken=function(t,e,n){for(var r=0;t>0;){var i=this._indents.length-1;void 0==this._indents[i]?t=0:this._indents[i]==this._outdebt?(t-=this._outdebt,this._outdebt=0):this._indents[i]<this._outdebt?(this._outdebt-=this._indents[i],t-=this._indents[i]):(r=this._indents.pop()-this._outdebt,t-=r,this._outdebt=0,e||this.addLinebreaks(1),this.pair("OUTDENT"),this.token("OUTDENT",""+r,0))}for(r&&(this._outdebt-=t);";"==this.lastTokenValue();)this._tokens.pop();"TERMINATOR"==this.lastTokenType()||e||this.token("TERMINATOR","\n",0),this._scopes.length=this._indents.length;var o=this.context();return("%"==o||"TAG"==o)&&this.pair(o),this.closeDef(),this},c.prototype.whitespaceToken=function(){var t,e,n;return(t=G.exec(this._chunk))||(e="\n"==this._chunk.charAt(0))?(n=a(this._tokens),n?t?(n.spaced=!0,t[0].length):(n.newLine=!0,0):void 0):0},c.prototype.addNewline=function(){return this.token("TERMINATOR","\n")},c.prototype.moveHead=function(t){var e=u(t,"\n");return e},c.prototype.addLinebreaks=function(t,e){var n;if(!e&&0==t)return this;var r=this._last;if(e||(n=1==t?"\n":2==t?"\n\n":3==t?"\n\n\n":h("\n",t)),r){var i=r._type,o=mt(r);if("INDENT"==i){var s=r._meta||(r._meta={pre:"",post:""});return s.post+=e||n,this}if("TERMINATOR"==i)return _t(r,o+(e||n)),this}this.token("TERMINATOR",n,0)},c.prototype.newlineToken=function(t){for(;";"==this.lastTokenValue();)console.log("pop token",this._tokens[this._tokens.length-1]),this._tokens.pop();this.addLinebreaks(t);var e=this.context();return("TAG"==e||"IMPORT"==e)&&this.pair(e),this.closeDef(),this},c.prototype.suppressNewlines=function(){return"\\"==this.value()&&this._tokens.pop(),this},c.prototype.literalToken=function(){var t,e;(t=j.exec(this._chunk))?(e=t[0],q.test(e)&&this.tagParameters()):e=this._chunk.charAt(0);var n=this._ends[this._ends.length-1],i=this._ends[this._ends.length-2],o="TAG_END"==n||"OUTDENT"==n&&"TAG_END"==i,s=e,u=a(this._tokens),h=u&&gt(u),c=u&&mt(u);e.length;if("="==e&&u&&("||"==c||"&&"==c))return yt(u,"COMPOUND_ASSIGN"),_t(u,c+"="),e.length;switch(";"==e?(this._seenFor=!1,s="TERMINATOR"):"("==e&&o&&"="!=h&&u.spaced?this.token(",",","):"->"==e&&o?(s="TAG_END",this.pair("TAG_END")):"/>"==e&&o?(s="TAG_END",this.pair("TAG_END")):">"==e&&o?(s="TAG_END",this.pair("TAG_END")):">"==e&&"DEF"==this.context()?s="DEF_FRAGMENT":"TERMINATOR"==e&&"DEF"==n?this.closeDef():"&"==e&&"DEF"==this.context()?s="BLOCK_ARG":"*"==e&&this._chunk.charAt(1).match(/[A-Za-z\_\@\[]/)&&(u.spaced||[",","(","[","{","|","\n","	"].indexOf(c)>=0)?s="SPLAT":"√"==e?s="SQRT":"ƒ"==e?s="FUNC":r(e,at)>=0?s="MATH":r(e,ot)>=0?s="COMPARE":r(e,et)>=0?s="COMPOUND_ASSIGN":r(e,nt)>=0?s="UNARY":r(e,it)>=0?s="SHIFT":r(e,rt)>=0?s="LOGIC":u&&!u.spaced&&("("==e&&"%"==n?s="TAG_ATTRS_START":"("==e&&r(h,lt)>=0?s="CALL_START":"["==e&&r(h,ft)>=0&&(s="INDEX_START","?"==h&&yt(u,"INDEX_SOAK"))),e){case"(":case"{":case"[":this.pushEnd(m[e]);break;case")":case"}":case"]":this.pair(e)}return this.token(s,e,e.length),e.length},c.prototype.sanitizeHeredoc=function(t,e){var n,r=e.indent,i=e.herecomment;if(i){if(J.test(t)&&this.error("block comment cannot contain '*/' starting"),t.indexOf("\n")<=0)return t}else for(var o;n=X.exec(t);){var s=n[1];(null==r||0<(o=s.length)&&o<r.length)&&(r=s)}return r&&(t=t.replace(RegExp("\\n"+r,"g"),"\n")),i||(t=t.replace(/^\n/,"")),t},c.prototype.tagParameters=function(){var t;if(")"!=this.lastTokenType())return this;var e=[],n=this._tokens,r=n.length;for(yt(n[--r],"PARAM_END");t=n[--r];){var i=gt(t);switch(i){case")":e.push(t);break;case"(":case"CALL_START":if(!e.length)return"("==i?(yt(t,"PARAM_START"),this):this;e.pop()}}return this},c.prototype.closeIndentation=function(){return this.closeDef(),this.closeSelector(),this.outdentToken(this._indent,!1,0)},c.prototype.balancedString=function(t,e){for(var n,r,i,o=[e],s=0;s<t.length-1;){switch(s++,r=t.charAt(s)){case"\\":s++;continue;case e:if(o.pop(),!o.length){var a=t.slice(0,s+1);return a}e=o[o.length-1];continue}"}"!=e||'"'!=r&&"'"!=r?"}"==e&&"/"==r&&(n=W.exec(t.slice(s))||V.exec(t.slice(s)))?s+=n[0].length-1:"}"==e&&"{"==r?o.push(e="}"):'"'==e&&"{"==r&&o.push(e="}"):o.push(e=r),i=r}return this._opts.silent?void 0:this.error("missing "+o.pop()+", starting")},c.prototype.interpolateString=function(t,e){void 0===e&&(e={});for(var n,r,i=e.heredoc,o=e.quote,s=e.regex,a=(e.prefix,this._loc,[]),u=0,h=-1,p=e.offset||1,l=(t.length,!1);n=t.charAt(h+=1);)if("\\"!=n){if("{"==t.charAt(h)&&(r=this.balancedString(t.slice(h),"}"))){if(l=!0,h>u){var d=new f("NEOSTRING",this.escapeStr(t.slice(u,h),i,o),this._loc+u+p,h-u);a.push(d)}a.push(new f("{{","{",this._loc+h+p,1));var g=r.slice(1,-1);if(g=g.replace(/^[^\n\S]+/,""),g.length){var m=this._loc+h+(r.length-g.length)-1,y=(new c).tokenize(g,{inline:!0,rewrite:!1,loc:m+p});y[0]&&"TERMINATOR"==gt(y[0])&&y.shift(),y.length&&a.push.apply(a,y)}h+=r.length-1,a.push(new f("}}","}",this._loc+h+p,1)),u=h+1}}else h+=1;if(h>=u&&u<t.length&&a.push(new f("NEOSTRING",this.escapeStr(t.slice(u),i,o),this._loc+u+p,t.length-u)),s)return a;if(!a.length)return this.token("NEOSTRING",'""');for(var _=0,v=a.length;v>_;_++)this._tokens.push(a[_]);return a},c.prototype.balancedSelector=function(t,e){for(var n,r,i=[e],o=t.length,s=1;o>s;s++){switch(r=t.charAt(s)){case"\\":s++;continue;case e:if(i.pop(),!i.length)return t.slice(0,s+1);e=i[i.length-1];continue}"}"==e&&r==[")"]?i.push(e=r):"}"==e&&"{"==r?i.push(e="}"):")"==e&&"{"==r&&i.push(e="}"),n=r}return this.error("missing "+i.pop()+", starting")},c.prototype.pair=function(t){var e=a(this._ends);if(t!=e){"OUTDENT"!=e&&this.error("unmatched "+t);var n=a(this._indents);return this._indent-=n,this.outdentToken(n,!0,0),this.pair(t)}return this.popEnd()},c.prototype.token=function(t,e,n,r){this._lastTyp=t,this._lastVal=e;var i=this._last=new f(t,e,this._loc+(r||0),n||0);this._tokens.push(i)},c.prototype.lastTokenType=function(){var t=this._tokens[this._tokens.length-1];return t?gt(t):"NONE"},c.prototype.lastTokenValue=function(){var t=this._tokens[this._tokens.length-1];return t?t._value:""},c.prototype.tokid=function(t,e){var n;return(n=a(this._tokens,t))?(e&&yt(n,e),gt(n)):null},c.prototype.value=function(t,e){var n;return(n=a(this._tokens,t))?(e&&_t(n,e),mt(n)):null},c.prototype.unfinished=function(){return Z.test(this._chunk)?!0:pt.indexOf(this._lastTyp)>=0},c.prototype.escapeLines=function(t,e){return t.replace(K,e?"\\n":"")},c.prototype.makeString=function(t,e,n){return t?(t=t.replace(/\\([\s\S])/g,function(t,n){return"\n"==n||n==e?n:t}),t=t.replace(RegExp(""+e,"g"),"\\$&"),e+this.escapeLines(t,n)+e):e+e},c.prototype.error=function(t,e){("number"==typeof this._line||this._line instanceof Number)&&(t=""+t+" on line "+this._line),e&&(t+=" ["+this._loc+":"+(this._loc+e)+"]");var n=new SyntaxError(t);throw n.line=this._line,n=new y.ImbaParseError(n,{tokens:this._tokens,pos:this._tokens.length}),n.region=[this._loc,this._loc+(e||0)],n},c}()},function(t,e,n){!function(){function r(t,e){return e&&e.indexOf?e.indexOf(t):[].indexOf.call(t,e)}function i(t){return t?t.toArray?t.toArray():t:[]}function o(){}var s,a,u=n(8);u.Token;e.Rewriter=o,o.prototype.tokens=function(){return this._tokens},o.prototype.rewrite=function(t,e){var n;void 0===e&&(e={}),this._tokens=t,this._options=e,e.profile&&console.time("tokenize:rewrite");for(var r=0;n=t[r];){var i=t[r+1];"DEF_BODY"==n._type&&i&&"TERMINATOR"==i._type&&(n._type="DEF_EMPTY"),r++}return this.step("ensureFirstLine"),this.step("removeLeadingNewlines"),this.step("removeMidExpressionNewlines"),this.step("tagDefArguments"),this.step("closeOpenCalls"),this.step("closeOpenIndexes"),this.step("closeOpenTags"),this.step("closeOpenTagAttrLists"),this.step("addImplicitIndentation"),this.step("tagPostfixConditionals"),this.step("addImplicitBraces"),this.step("addImplicitParentheses"),e.profile&&console.timeEnd("tokenize:rewrite"),this._tokens},o.prototype.step=function(t){this._options.profile&&(console.log("---- starting "+t+" ---- "),console.time(t)),this[t](),this._options.profile&&(console.timeEnd(t),console.log("\n\n"))},o.prototype.scanTokens=function(t){for(var e,n=this._tokens,r=0;e=n[r];)r+=t.call(this,e,r,n);return!0},o.prototype.detectEnd=function(t,e,n){for(var r,i,o=this._tokens,s=0,a=[];r=o[t];){if(0==s&&e.call(this,r,t,a))return n.call(this,r,t);if(!r||0>s)return n.call(this,r,t-1);i=u.typ(r),m.indexOf(i)>=0?(0==s&&a.push(t),s+=1):y.indexOf(i)>=0&&(s-=1),t+=1}return t-1},o.prototype.ensureFirstLine=function(){var t=this._tokens[0];"TERMINATOR"==u.typ(t)&&(this._tokens=[u.token("BODYSTART","BODYSTART")].concat(this._tokens))},o.prototype.removeLeadingNewlines=function(){for(var t=0,e=0,n=i(this._tokens),r=n.length;r>e;e++)if("TERMINATOR"!=u.typ(n[e])){t=e;break}t&&this._tokens.splice(0,t)},o.prototype.removeMidExpressionNewlines=function(){var t=this;return t.scanTokens(function(e,n,r){var i=t.tokenType(n+1);return"TERMINATOR"==u.typ(e)&&_.indexOf(i)>=0?"OUTDENT"==i?1:(r.splice(n,1),0):1})},o.prototype.tagDefArguments=function(){return!0},o.prototype.closeOpenCalls=function(){var t=this,e=function(e,n){var r=u.typ(e);return")"==r||"CALL_END"==r||"OUTDENT"==r&&")"==t.tokenType(n-1)},n=function(e,n){var r=u.typ(e),i=t._tokens["OUTDENT"==r?n-1:n];return u.setTyp(i,"CALL_END")};return t.scanTokens(function(r,i){return"CALL_START"==u.typ(r)&&t.detectEnd(i+1,e,n),1})},o.prototype.closeOpenIndexes=function(){var t=this,e=function(t,e){return r(u.typ(t),["]","INDEX_END"])>=0},n=function(t,e){return u.setTyp(t,"INDEX_END")};return t.scanTokens(function(r,i){return"INDEX_START"==u.typ(r)&&t.detectEnd(i+1,e,n),1})},o.prototype.closeOpenTagAttrLists=function(){var t=this,e=function(t,e){return r(u.typ(t),[")","TAG_ATTRS_END"])>=0},n=function(t,e){return u.setTyp(t,"TAG_ATTRS_END")};return t.scanTokens(function(r,i){return"TAG_ATTRS_START"==u.typ(r)&&t.detectEnd(i+1,e,n),1})},o.prototype.closeOpenTags=function(){var t=this,e=function(t,e){return r(u.typ(t),[">","TAG_END"])>=0},n=function(t,e){return u.setTyp(t,"TAG_END")};return t.scanTokens(function(r,i){return"TAG_START"==u.typ(r)&&t.detectEnd(i+1,e,n),1})},o.prototype.addImplicitCommas=function(){},o.prototype.addImplicitBlockCalls=function(){for(var t,e=1,n=this._tokens;t=n[e];){var r=t._type,i=t._value;"DO"!=r||"INDEX_END"!=i&&"IDENTIFIER"!=i&&"NEW"!=i||(n.splice(e+1,0,u.token("CALL_END",")")),n.splice(e+1,0,u.token("CALL_START","(")),e++),e++}},o.prototype.addImplicitBraces=function(){var t=this,e=[],n=null,r=["IF","TERNARY","FOR"],i=function(e,n){return t._tokens.splice(n,0,u.LBRACKET)},o=function(e,n){return t._tokens.splice(n,0,u.RBRACKET)},s=function(t,e){return[t,e]};return t.scanTokens(function(a,h,c){var p,l=u.typ(a),f=u.val(a),d=e[e.length-1]||[];if(r.indexOf(l)>=0)return e.push(s(l,h)),1;if("?"==f)return e.push(s("TERNARY",h)),1;if(m.indexOf(l)>=0)return"INDENT"==l&&r.indexOf(d[0])>=0&&e.pop(),"INDENT"==l&&"{"==t.tokenType(h-1)?e.push(s("{",h)):e.push(s(l,h)),1;if(y.indexOf(l)>=0)return"TERNARY"==d[0]&&e.pop(),n=e.pop(),n||console.log("NO STACK!!"),n[2]=h,"{"==n[0]&&n.generated?(o(a,h),1):1;if("TERNARY"==d[0]&&("TERMINATOR"==l||"OUTDENT"==l))return e.pop(),1;if(r.indexOf(d[0])>=0&&"INDENT"==l)return console.log("popping noBraceContext"),e.pop(),1;if(","==l)return"{"==d[0]&&d.generated?(c.splice(h,0,u.RBRACKET),e.pop(),2):1;if(":"==l&&"{"!=d[0]&&"TERNARY"!=d[0]&&-1==r.indexOf(d[0])){for(p=n&&n[2]==h-1?n[1]-1:h-2;"HERECOMMENT"==t.tokenType(p-1);)p-=2;var g=c[p-1];if(g&&"}"==u.typ(g)&&g.generated){c.splice(p-1,1);var _=s("{");return _.generated=!0,e.push(_),0}return g&&","==u.typ(g)&&"}"==t.tokenType(p-2)?(c.splice(p-2,1),_=s("{"),_.generated=!0,e.push(_),0):(_=s("{"),_.generated=!0,e.push(_),i(a,p+1),2)}if("DO"==l){var v=u.typ(c[h-1]);if(["NUMBER","STRING","REGEX","SYMBOL","]","}",")","STRING_END"].indexOf(v)>=0){var b=u.token(",",",");if(b.generated=!0,c.splice(h,0,b),d.generated)return o(a,h),e.pop(),2}}return"TERMINATOR"!=l&&"OUTDENT"!=l&&"DEF_BODY"!=l||!d.generated?1:(o(a,h),e.pop(),2)})},o.prototype.addImplicitParentheses=function(){for(var t,e=this,n=["CLASS","IF","UNLESS","TAG","WHILE","FOR","UNTIL","CATCH","FINALLY","MODULE","LEADING_WHEN"],r=function(t,n){return e._tokens.splice(n,0,u.token("CALL_END",")"))},i=e._tokens,o=!1,s=!1,a=!1,h=0;t=i[h];){var c=t._type,p=i[h-1],l=(i[h],i[h+1]),f=p&&p._type,d=l&&l._type;")"!=f&&"]"!=f||"INDENT"!=c||(o=!0),n.indexOf(f)>=0&&(a=!0,o=!0,"FOR"==f&&(s=!0));var g=!1,m=!1;if(!o&&"INDENT"==c&&l){var y=f&&v.indexOf(f)>=0,_=d&&b.indexOf(d)>=0;g=(l.generated&&"{"==d||_)&&y,m=_&&y}var w=!1,A=!1;if(("TERMINATOR"==c||"OUTDENT"==c||"INDENT"==c)&&(a=!1,o=!1),"?"==c&&p&&!p.spaced&&(t.call=!0),t.fromThen)h+=1;else if(g||m||p&&p.spaced&&(p.call||v.indexOf(f)>=0)&&(b.indexOf(c)>=0||!t.spaced&&!t.newLine&&T.indexOf(c)>=0)){i.splice(h,0,u.token("CALL_START","("));var k=function(t,n){var r=u.typ(t);if(!w&&t.fromThen)return!0;var o="IF"==r||"UNLESS"==r||"ELSE"==r;(o||"CATCH"==r)&&(w=!0),(o||"SWITCH"==r||"TRY"==r)&&(A=!0);var h=e.tokenType(n-1);if(("."==r||"?."==r||"::"==r)&&"OUTDENT"==h)return!0;if(a&&("INDENT"==r||"TERMINATOR"==r))return!0;if(("WHEN"==r||"BY"==r)&&!s)return!1;var c=i[n+1],p=c&&u.typ(c);return!t.generated&&","!=h&&(I.indexOf(r)>=0||"INDENT"==r&&!A||"DOS"==r&&"="!=h)&&("INDENT"!=r||"CLASS"!=e.tokenType(n-2)&&-1==$.indexOf(h)&&!(c&&(c.generated&&"{"==p||b.indexOf(p)>=0)))};e.detectEnd(h+1,k,r),"?"==u.typ(p)&&u.setTyp(p,"FUNC_EXIST"),h+=2,a=!1,o=!1,s=!1}else h+=1}},o.prototype.addImplicitIndentation=function(){for(var t,e=this,n=0,i=e._tokens;t=i[n];){var o=u.typ(t),s=e.tokenType(n+1);if("TERMINATOR"!=o||"THEN"!=s)if("CATCH"==o&&r(e.tokenType(n+2),["OUTDENT","TERMINATOR","FINALLY"])>=0)i.splice.apply(i,[].concat([n+2,0],[].slice.call(e.indentation(t)))),n+=4;else{if(w.indexOf(o)>=0&&"INDENT"!=s&&"BLOCK_PARAM_START"!=s&&("ELSE"!=o||"IF"!=s)&&"ELIF"!=o){var a=o,h=u.token("INDENT","2"),c=u.OUTDENT;"THEN"==a&&(h.fromThen=!0),h.generated=!0,i.splice(n+1,0,h);var p=function(t,e){var n=u.typ(t);return";"!=u.val(t)&&A.indexOf(n)>=0&&!("ELSE"==n&&"IF"!=a&&"THEN"!=a)},l=function(t,n){var r=","==e.tokenType(n-1)?n-1:n;return i.splice(r,0,c)};e.detectEnd(n+2,p,l),"THEN"==o&&i.splice(n,1)}n++}else i.splice(n,1)}},o.prototype.tagPostfixConditionals=function(){var t=this,e=function(t,e){return r(u.typ(t),["TERMINATOR","INDENT"])>=0};return t.scanTokens(function(n,r){var i=u.typ(n);if("IF"!=i&&"FOR"!=i)return 1;var o=n;return t.detectEnd(r+1,e,function(t,e){return"INDENT"!=u.typ(t)?u.setTyp(o,"POST_"+u.typ(o)):void 0}),1})},o.prototype.indentation=function(t){return[u.token("INDENT","2"),u.token("OUTDENT","2")]},o.prototype.type=function(t){var e=this._tokens[t];return e&&u.typ(e)},o.prototype.tokenType=function(t){var e=this._tokens[t];return e&&u.typ(e)};var h=[["(",")"],["[","]"],["{","}"],["{{","}}"],["INDENT","OUTDENT"],["CALL_START","CALL_END"],["PARAM_START","PARAM_END"],["INDEX_START","INDEX_END"],["TAG_START","TAG_END"],["TAG_PARAM_START","TAG_PARAM_END"],["TAG_ATTRS_START","TAG_ATTRS_END"],["BLOCK_PARAM_START","BLOCK_PARAM_END"]];t.exports.INVERSES=s={};for(var c,p=0,l=i(h),f=l.length;f>p;p++){c=l[p];var d=c[0],g=c[1];s[g]=d,s[d]=g}var m=["(","[","{","INDENT","CALL_START","PARAM_START","INDEX_START","TAG_PARAM_START","BLOCK_PARAM_START","STRING_START","{{","TAG_START"],y=[")","]","}","OUTDENT","CALL_END","PARAM_END","INDEX_END","TAG_PARAM_END","BLOCK_PARAM_END","STRING_END","}}","TAG_END"],_=["CATCH","WHEN","ELSE","FINALLY"].concat(y),v=["IDENTIFIER","SUPER","@","THIS","SELF","EVENT","TRIGGER","TAG_END","IVAR","GVAR","CONST","ARGVAR","NEW","BREAK","CONTINUE","RETURN"],b=["SELECTOR","IDENTIFIER","NUMBER","STRING","SYMBOL","JS","REGEX","NEW","PARAM_START","CLASS","IF","UNLESS","TRY","SWITCH","THIS","BOOL","TRUE","FALSE","NULL","UNDEFINED","UNARY","SUPER","IVAR","GVAR","CONST","ARGVAR","SELF","@","[","(","{","--","++","SELECTOR","TAG_START","TAGID","#","SELECTOR_START","IDREF","SPLAT","DO","BLOCK_ARG","FOR","STRING_START","CONTINUE","BREAK"],T=["+","-"],$=["{","[",",","BLOCK_PARAM_END","DO"],I=["POST_IF","POST_UNLESS","POST_FOR","WHILE","UNTIL","WHEN","BY","LOOP","TERMINATOR","DEF_BODY","DEF_FRAGMENT"],w=["ELSE","TRY","FINALLY","THEN","BLOCK_PARAM_END","DO","BEGIN","CATCH_VAR"],A=["TERMINATOR","CATCH","FINALLY","ELSE","OUTDENT","LEADING_WHEN"];return a=["TERMINATOR","INDENT","OUTDENT"]}()},function(t,e,n){!function(){function t(t){return t?t.toArray?t.toArray():t:[]}function r(t){this._view=t,this._buffer="",this._cache={}}var i=n(2).Region;return e.Buffer=r,r.prototype.view=function(t){return this._view},r.prototype.setView=function(t){return this._view=t,this},r.prototype.set=function(t){return t==this._buffer?this:(this._buffer=t,this._cache={},this._lines=null,this)},r.prototype.refresh=function(){return this.set(this.view().root().code())},r.prototype.lines=function(){return this._lines||(this._lines=this._buffer.split("\n"))},r.prototype.split=function(){return this._buffer.split.apply(this._buffer,arguments)},r.prototype.linecount=function(){return this.lines().length},r.prototype.line=function(t){return"number"==typeof t||t instanceof Number?this.lines()[t]||"":""},r.prototype.len=function(){return this._buffer.length},r.prototype.locToRc=function(){return this},r.prototype.location=function(){return this},r.prototype.locToRow=function(e){for(var n=0,r=0,i=t(this.lines()),o=i.length;o>r;r++)if(n+=i[r].length+1,n>e)return r;return this.lines().length},r.prototype.locToCell=function(t){if(this._cache[t])return this._cache[t];for(var e,n=t,r=0,i=0,o=this._buffer,s=this._view.tabSize();(e=o[n-1])&&"\n"!=e;)n--;for(;t>n&&(e=o[n]);){if("	"==e){var a=s-r%s;r+=a}else r+=1;n++}for(;e=o[n-1];)"\n"==e&&i++,n--;return this._cache[t]=[i,r]},r.prototype.substr=function(t,e){if(t instanceof i)return this._buffer.substr(t.start(),t.size());if("number"==typeof t||t instanceof Number)return this._buffer.substr(t,e||1);throw"must be region or number"},r.prototype.toString=function(){return this._buffer||""},r}()},function(t,e,n){!function(){function t(t){return t?t.toArray?t.toArray():t:[]}function e(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=null),this._row=t,this._col=e,this._caret=n}var r=n(1),i=n(2).Region;return e.prototype.row=function(t){return this._row},e.prototype.setRow=function(t){return this._row=t,this},e.prototype.col=function(t){return this._col},e.prototype.setCol=function(t){return this._col=t,this},e.prototype.caret=function(t){return this._caret},e.prototype.setCaret=function(t){return this._caret=t,this},e.prototype.view=function(){return this.caret().view()},e.prototype.normalize=function(){return this._col=this.realCol(),this},e.prototype.set=function(n,o){var s;if(n instanceof e&&(o=n.col(),n=n.row()),n instanceof i){var s=t(r.rowcol(this.view()._buffer,n.start()));n=s[0],o=s[1]}var a=this.view()._buffer.linecount();return n>=a&&(n=a-1,o=1e3),this._row=n,this._col=o,this},e.prototype.move=function(t){this.normalize();var e=this.realCol()+t,n=this.linelen(),i=this.lineloc();if(0>e)return this._row>0?(this.moveUp(),this._col=this.linelen()):(this._row=0,this._col=0),this;if(e>n){if(this._row>=this.view()._buffer.linecount()-1)return this;this.moveDown();var o=Math.max(0,e-n-1),s=r.colsForLine(this.linestr().substr(0,o));return this._col=s,this}return this._col=r.colsForLine(this.linestr().substr(0,i+t)),this},e.prototype.moveUp=function(t){return this._row=Math.max(0,this._row-1),this},e.prototype.moveDown=function(t){console.log("moveDown");var e=this.view()._buffer.linecount();return this._row=this._row+1,this._row>=e&&(console.log("out of bounds"),this.setLoc(this.view()._buffer.len())),this},e.prototype.clone=function(){return new e(this.row(),this.col(),this.caret())},e.prototype.linelen=function(){return r.colsForLine(this.linestr())},e.prototype.lineloc=function(){return r.colToLoc(this.linestr(),this.realCol())},e.prototype.realCol=function(){var t=r.colToViewCol(this.linestr(),this._col);return t},e.prototype.linestr=function(){return this.view().linestr(this.row())},e.prototype.peekbehind=function(){var t=this.linestr();return t.substr(0,r.colToLoc(t,this.realCol()))},e.prototype.peekahead=function(){var t=this.linestr();return t.slice(r.colToLoc(t,this.realCol()))},e.prototype.setLoc=function(e){var n,n=t(r.rowcol(this.view()._buffer,e)),i=n[0],o=n[1];return this.set(i,o),this},e.prototype.loc=function(){for(var e,n=this.view()._buffer.lines(),i=0,o=0,s=t(n),a=s.length;a>o;o++){e=s[o];var u=e.length;if(o<this._row)i+=u+1;else if(o==this._row){var h=r.colToViewCol(e,this._col),c=r.colToLoc(e,h);i+=Math.min(u,c)}}return i},e.prototype.tab=function(){var t=this.col()%4;return this.setCol(this.col()+(4-t)),console.log("marker tab",t,this.col(),this.realCol()),this},e.prototype.untab=function(){console.log("untab",this.col());4-this.col()%4;return this.setCol(4*Math.ceil(this.col()/4)-4),this},e.prototype.alter=function(t,e){var n,r,i,o,s,a,u=this.caret().view().nodesInRegion(this.loc(),!1),h=u[0],c=h&&h.node,p=u.prev&&u.prev.node,l=u.next&&u.next.node;if(t==IM.WORD_START){var f=c||p;if((n=p)&&n.matches&&n.matches(q$("._imclose",this)))this.setLoc(p.parent().region().start());else if((r=p)&&r.matches&&r.matches(q$("._imstr",this)))this.setLoc(p.region().start());else{var d=this.loc(),g=this.peekbehind().split("").reverse().join("");d-=g.match(/^([\s\t\.]*.+?|)(\b|$)/)[1].length,this.setLoc(d)}}else if(t==IM.WORD_END)if(f=c||l,(i=l)&&i.matches&&i.matches(q$("._imopen",this)))this.setLoc(l.parent().region().end());else if((o=l)&&o.matches&&o.matches(q$("._imstr",this)))this.setLoc(l.region().end());else{var m=this.loc();m+=this.peekahead().match(/^([\s\.]*.+?|)(\b|$)/)[1].length,this.setLoc(m)}else if(t==IM.LINE_END)this.set(this.row(),1e3);else if(t==IM.LINE_START){var y=this.linestr().match(/^\t*/)[0].length,_=y*this.view().tabSize();this.setCol(this.col()>_?_:0)}else 0>e&&(s=p)&&s.matches&&s.matches("._imtab")?this.setLoc(p.region().start()):e>0&&(a=l)&&a.matches&&a.matches("._imtab")?this.tab():this.move(e);return this},tag$.defineTag("imcarethead"),tag$.defineTag("imcaret",function(n){n.prototype.region=function(t){return this._region},n.prototype.setRegion=function(t){return this._region=t,this},n.prototype.view=function(t){return this._view},n.prototype.setView=function(t){return this._view=t,this},n.prototype.lines=function(t){return this._lines},n.prototype.setLines=function(t){return this._lines=t,this},n.prototype.ranges=function(t){return this._ranges},n.prototype.setRanges=function(t){return this._ranges=t,this},n.prototype.__mode={watch:"modeDidSet",name:"mode"},n.prototype.mode=function(t){return this._mode},n.prototype.setMode=function(t){var e=this.mode();return t!=e&&(this._mode=t),t!=e&&this.modeDidSet&&this.modeDidSet(t,e,this.__mode),this},n.prototype.__col={"default":0,watch:"dirty",name:"col"},n.prototype.col=function(t){return this._col},n.prototype.setCol=function(t){var e=this.col();return t!=e&&(this._col=t),t!=e&&this.dirty&&this.dirty(t,e,this.__col),this},n.prototype._col=0,n.prototype.__row={"default":0,watch:"dirty",name:"row"},n.prototype.row=function(t){return this._row},n.prototype.setRow=function(t){var e=this.row();return t!=e&&(this._row=t),t!=e&&this.dirty&&this.dirty(t,e,this.__row),this},n.prototype._row=0,n.prototype.input=function(t){return this._input},n.prototype.setInput=function(t){return this._input=t,this},n.prototype.tail=function(t){return this._tail},n.prototype.setTail=function(t){return this._tail=t,this},n.prototype.head=function(t){return this._head},n.prototype.setHead=function(t){return this._head=t,this},n.prototype.hash=function(t){return this._hash},n.prototype.setHash=function(t){return this._hash=t,this},n.prototype.expand=function(e,n){var r;void 0===e&&(e=0),void 0===n&&(n=0),this.log("imcaret expand",e,n),this.decollapse();var r=t(this.ends()),i=r[0],o=r[1];return i.move(e),o.move(n),this},n.prototype.toArray=function(){return this.isCollapsed()?[this.head().row(),this.head().col()]:[this.head().row(),this.head().col(),this.tail().row(),this.tail().col()]},n.prototype.toHash=function(){return"["+this.toArray().join(",")+"]"},n.prototype.set=function(t){return t instanceof IM.Types.Tok?this.set(t.region()):t instanceof i?(this.setRegion(t),t):(t instanceof Array&&(this.head().setRow(t[0]),this.head().setCol(t[1]),4==t.length?(this.decollapse(),this.tail().setRow(t[2]),this.tail().setCol(t[3])):this.setTail(this.head())),this.dirty(),this)},n.prototype.expandToLines=function(){var e;this.selectable();var e=t(this.ends()),n=e[0],r=e[1];return n.setCol(0),r.setCol(1e3),this.dirty()},n.prototype.selectAll=function(){return this.decollapse(),this.tail().setLoc(0),this.head().setLoc(this.view()._buffer.len()),this.dirty(),this},n.prototype.selectable=function(){return this.decollapse(),this},n.prototype.decollapse=function(){var t;return this.tail()==this.head()&&(this.setTail(t=this.head().clone()),t),this},n.prototype.collapse=function(){return this.setTail(this.head()),this.dirty(),this},n.prototype.collapseToStart=function(){return this.isReversed()?this.setTail(this.head()):this.setHead(this.tail()),this.dirty(),this},n.prototype.orientation=function(){return this.isReversed()?"reversed":"normal"},n.prototype.isCollapsed=function(){return this.tail()==this.head()},n.prototype.isReversed=function(){return this.head().row()<this.tail().row()||this.tail().row()==this.head().row()&&this.head().col()<this.tail().col()},n.prototype.indent=function(){var t=this.head().linestr(),e=t.match(/^(\t*)/)[0];return e},n.prototype.peekbehind=function(t){var e=this.ends()[0].peekbehind();return t instanceof RegExp?e.match(t):e},n.prototype.move=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=0),this.head().alter(e,t),this.dirty()},n.prototype.moveDown=function(t){return void 0===t&&(t=1),this.head().moveDown(),this.dirty()},n.prototype.moveUp=function(t){return void 0===t&&(t=1),this.head().moveUp(),this.dirty()},n.prototype.ends=function(){return this.isReversed()?[this.head(),this.tail()]:[this.tail(),this.head()]},n.prototype.text=function(){return this.region().text()},n.prototype.region=function(){for(var e,n,o=this.view().code(),s=o.split("\n"),e=t(this.ends()),a=e[0],u=e[1],h=0,c=0,p=0,l=a.row(),f=a.col(),d=u.row(),g=u.col(),m=0,y=t(s),_=y.length;_>m;m++){if(n=y[m],p=n.length,l>m)h+=p+1;else if(m==l){var v=r.colToLoc(n,f);h+=Math.min(p,v);
}if(d>m)c+=p+1;else{if(m!=d)break;v=r.colToLoc(n,g),c+=Math.min(p,v)}}return new i(h,c,this.view().root(),this.view())},n.prototype.setRegion=function(t){var n=this.view().code(),i=r.rowcol(n,t.a()),o=r.rowcol(n,t.b());return this.setHead(new e(o[0],o[1],this)),0==t.size()?this.setTail(this.head()):this.setTail(new e(i[0],i[1],this)),this.dirty()},n.prototype.nodes=function(t){return void 0===t&&(t=this.region()),this.view().nodesInRegion(t,this.isCollapsed())},n.prototype.target=function(t){void 0===t&&(t=this.region());var e=this.nodes(t);return e.length>2?r.commonAncestor(e.map(function(t){return t.node})):e[0].node},n.prototype.insert=function(t,e){var n="";if(this.view().history().mark("action"),!this.isCollapsed()){var r=this.region();n=r.text(),this.view().erase(r),this.collapseToStart()}var i;t.indexOf("$0")>=0&&(i=this.region().clone(0,n.length).move(t.indexOf("$0")),t=t.replace("$0",n)),e||(e={size:t.length}),this.head().normalize();this.view().insert(this.region().start(),t,e);return this.view().log("inserted -- now move",e.size),i?this.setRegion(i):this.head().setLoc(this.head().loc()+e.size),this.dirty(),this},n.prototype.erase=function(t){return this.view().history().mark("action"),this.isCollapsed()&&(this.log("isCollapsed",t),this.decollapse(),this.head().alter(t,-1)),console.log("erasing region",this.region()),this.view().erase(this.region()),this.collapseToStart(),this},n.prototype.dirty=function(){var t,e;this._timestamp=new Date,this._hash!=this.toHash()&&(this.view().history().oncaret(this._hash,this.toHash(),this),this._hash=this.toHash());var n=this.isReversed(),r=this.tail(),i=this.head();n&&(t=i,e=r,r=t,i=e);var o,s,a=i.row()-r.row(),u=r.row(),h=r.realCol(),c=i.realCol();return this.isReversed()?(o=h,s=c):(o=c,s=h),this.css({transform:"translate(0px,"+100*r.row()+"%)"}),this._caret.css({transform:"translate("+o+"ch,"+100*(this.head().row()-u)+"%)"}),this._start.css({marginLeft:""+h+"ch",width:"auto"}),this._end.css({width:""+c+"ch"}),this.isCollapsed()?this.setMode("collapsed"):0==a?(this.setMode("single"),this._start.css({width:c-h+"ch"})):(this._mid.setText(a>1?"\n".repeat(a-1):""),this.setMode("multi")),this},n.prototype.render=function(){var t=new Date-this._timestamp,e=Math.round(t/500)%2;return e!=this._flip&&(this._caret.flag("blink",e),this._flip=e),this},n.prototype.build=function(){var t,n;return this.setTail((this.setHead(t=new e(0,0,this)),t)),this.setChildren([(this.$a=this.$a||tag$.$span().flag("dim")).setText("x").end(),(this._caret=this._caret||tag$.$imcarethead().setRef("caret",this)).end(),(n=this._lines=this._lines||tag$.$div().setRef("lines",this)).setContent([(this._start=this._start||tag$.$div().setRef("start",this)).setText(" ").end(),(this._mid=this._mid||tag$.$div().setRef("mid",this)).end(),(this._end=this._end||tag$.$div().setRef("end",this)).setText(" ").end()],2).end()],2).synced()},n.prototype.normalize=function(){return this.head().normalize(),this},n.prototype.modeDidSet=function(t,e){return this.unflag(e),this.flag(t)}})}()},function(t,e){!function(){function t(t,e,n,r){return void 0==r&&"function"==typeof n&&(r=n,n="utf-8"),void 0==n&&(n="utf-8"),console.log("save",t,e,n),xr.post(t,{body:e}).then(function(){return console.log("responded"),r&&r(arguments)})}function n(t,e,n){return void 0==n&&"function"==typeof e&&(n=e,e="utf-8"),void 0==e&&(e="utf-8"),console.log("save",t,e),xr.get(t).then(function(t){return console.log("responded",t),n&&n(arguments),t})}return e.save=t,e.readFileAsync=n,n}()},function(t,e,n){!function(){function t(t){return t?t.toArray?t.toArray():t:[]}function r(t,e){this._view=e,this._data=t,this._active=!1,this._region=t.loc?o.normalize(t.loc,e):null,this._node=t.node||this.node()}function i(t){this._prune=[],this._array=[],this._map={},this._view=t}var o=n(2).Region,s={"Unexpected 'TAG_END'":"Tag closed unexpectedly","Unexpected 'TERMINATOR'":"Unexpected ⏎","Unexpected 'POST_IF'":"Missing body in <b>IF</b>"};e.Hint=r,r.build=function(t,e){return new this(t,e)},r.prototype.view=function(t){return this._view},r.prototype.setView=function(t){return this._view=t,this},r.prototype.region=function(t){return this._region},r.prototype.setRegion=function(t){return this._region=t,this},r.prototype.active=function(t){return this._active},r.prototype.setActive=function(t){return this._active=t,this},r.prototype.getAttribute=function(t){return this._data[t]},r.prototype.setAttribute=function(t,e){return this._data[t]=e,this},r.prototype.type=function(){return this._data.type||"error"},r.prototype.group=function(){return this._data.group},r.prototype.ref=function(){return this._data.ref},r.prototype.node=function(){return this._node||(this._node=this._region&&this.view().nodeAtRegion(this._region))},r.prototype.row=function(){return this.region().row()},r.prototype.col=function(){return this.region().col()},r.prototype.label=function(){var t;return this._label||(this._label=(t=this._data.label||this._data.message||"Hint",t=t.split(/error at (\[[\d\:]*\])\:\s*/).pop(),t=s[t]||t))},r.prototype.activate=function(){var t;return this._active||(this._active=!0,(t=this.node())&&t.setHint&&t.setHint(this)),this},r.prototype.deactivate=function(){return console.log("deactivate hint!!"),this.setActive(!1),this},r.prototype.prune=function(){return this.view().hints().prune(this)},r.prototype.cleanup=function(){return this._node&&this._node.hint()==this&&this._node.setHint(null),this},r.prototype.remove=function(){return this.view().hints().rem(this),this},r.prototype.changed=function(){return this.prune(),this},r.prototype.adjust=function(t,e){return void 0===e&&(e=!0),this.region().intersects(t)&&this.prune(),this.region().adjust(t,e),this},e.Hints=i;var a=0;return i.prototype.toArray=function(){return this._array},i.prototype.get=function(t){return this._map[t]},i.prototype.activate=function(){for(var e=0,n=t(this._array),r=n.length;r>e;e++)n[e].activate();return this},i.prototype.rem=function(e){if(e instanceof Function&&(e=this._array.filter(e)),e instanceof Array){for(var n=0,r=t(e),i=r.length;i>n;n++)this.rem(r[n]);return e}return"string"==typeof e||e instanceof String?this.rem(this.get(e)):(this._array.indexOf(e)>=0&&(e.cleanup(),this._array.splice(this._array.indexOf(e),1)),e)},i.prototype.prune=function(t){return this._prune.indexOf(t)<0&&this._prune.push(t),this},i.prototype.clear=function(){var e=this._array;this._array=[];for(var n=0,r=t(e),i=r.length;i>n;n++)r[n].deactivate();return this},i.prototype.cleanup=function(){var t=this;return t._array.map(function(e){return t._prune.indexOf(e)>=0?(e.deactivate(),t.rem(e)):void 0}),t._prune=[],t},i.prototype.filter=function(t){return this._array.filter(t)},i.prototype.add=function(t){var e=t.ref="hint"+a++;return t instanceof r||(t=r.build(t,this._view)),this._map[e]=t,this._array.push(t),t},i}()},function(t,e,n){!function(){function t(t){return t?t.toArray?t.toArray():t:[]}function r(t,e){var n=this;n._active=!1,n._view=t,n._config=e||{attributes:!1,childList:!0,characterData:!0,subtree:!0},n._observer=new MutationObserver(function(t){return n.onmutations(t)})}var i=n(1);return e.Observer=r,r.prototype.view=function(t){return this._view},r.prototype.setView=function(t){return this._view=t,this},r.prototype.config=function(t){return this._config},r.prototype.setConfig=function(t){return this._config=t,this},r.prototype.active=function(t){return this._active},r.prototype.setActive=function(t){return this._active=t,this},r.prototype.resume=function(){return this._active||(this._observer.observe(this.view().root().dom(),this.config()),this._active=!0),this},r.prototype.pause=function(t){var e=this._active;return this._active=!1,e&&this._observer.disconnect(),t instanceof Function&&(t(),e&&this.resume()),this},r.prototype.paused=function(){return!this._active},r.prototype.onmutations=function(e){var n;this.view().logger().group("mutations");for(var r,o=!1,s=[],a=0,u=t(e),h=u.length;h>a;a++){r=u[a],this.view().log("mutation",r);var c=r.type,p=r.previousSibling||r.target;if("characterData"==c)this.view().log("updated code to "+p.textContent),p=p.parentNode;else if("childList"==c){o=!0;var l=r.addedNodes;1==l.length&&l[0]instanceof Element&&(p=l[0])}this.view().log(p,tag$wrap(p)),(n=tag$wrap(p))&&(this.view().log("add target?!"),s.indexOf(n)<0&&s.push(n))}var f=i.commonAncestor(s);this.view().log("common container for mutations is",f,s);var d;if(1==s.length)this.view().log("a single node was mutated",s[0]),s[0].mutated({deep:o,mutations:e});else{for(var g,a=0,h=s.length;h>a;a++)g=s[a],d&&d.contains(g.dom())?this.view().log("this node is already part of the extent",g.dom()):d=g.dirtyExtent();d&&this.pause(function(){return!0})}return this.view().logger().groupEnd(),this.view().onmutations({nodes:s,mutations:e,extent:d}),this},r}()},function(t,e,n){(function(t){!function(){function e(t){return t?t.toArray?t.toArray():t:[]}function r(t,e){return e&&e.indexOf?e.indexOf(t):[].indexOf.call(t,e)}function i(t,e){return e instanceof Function&&(e={command:e}),e.trigger=t,e}function o(t,e){return e instanceof Function&&(e={command:e}),e.keys=t,e}function s(t,e){this._view=t,this._bindings=e||IM.KeyBindings}var a=this,u=n(1),h={8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"};return IM.KeyBindings=[o(["super+z"],function(t){return t.view().history().undo()}),o(["super+shift+z"],function(t){return t.view().history().redo()}),o(["alt+super+p"],function(t){return t.view().history().play()}),o(["super+s"],{command:"save"}),o(["super+b"],{command:"run"}),o(["alt+super+s"],{command:"saveSession"}),o(["alt+shift+l"],{command:"reparse"}),o(["alt+shift+k"],{command:"reparseExtent"}),o(["super+a"],function(t){return t.selectAll()}),o(["tab"],{context:function(t){return t.text().indexOf("\n")>=0},command:function(t){t.expandToLines();var e=t.region(),n=t.view().nodesInRegion(e);return n.map(function(t){return t.node.matches("._imnewline")&&(console.log("found tab in selection",t),"start"!=t.mode)?t.node.indent():void 0}),t.dirty()}}),o(["shift+tab"],{context:function(t){return t.text().indexOf("\n")>=0},command:function(t){t.expandToLines();var e=t.region(),n=t.view().nodesInRegion(e);return n.map(function(t){return t.node.matches("._imnewline")&&"start"!=t.mode?t.node.undent():void 0}),t.dirty()}}),o(["shift+tab"],{context:function(t){return!0},command:function(t){return console.log("try undent"),!0}}),o(["alt+shift+return"],function(t){return console.log("prettify")}),o(["backspace"],{context:function(t){return console.log("deleteLeftRight backspace?!?",t.region(),t.region().peek(-1,1)),r(t.region().peek(-1,1),["[]","{}","<>","()",'""',"''"])>=0},command:function(t){return console.log("moving!!"),t.expand(-1,1),t.erase()}}),o(["backspace"],{context:function(t,e){var n=t.region();return 0==n.size()&&(e.node=n.prevNode("._impair,._imstr"))?!0:void 0},command:function(t,e){var n;return t.setRegion(n=e.node.region().clone().reverse()),n}}),o(["backspace"],{context:function(t,e){return t.text()&&!u.stringIsBalanced(t.text())?!0:void 0},command:function(t,e){return!0}}),o(["backspace"],function(t){return t.erase()}),o(["shift+backspace"],function(t){return t.erase()}),o(["alt+backspace"],function(t){return t.erase(IM.WORD_START)}),o(["super+backspace"],function(t){return t.erase(IM.LINE_START)}),o(["return","shift+return","super+return"],function(t){var e=t.indent();return u.increaseIndent(t.head().peekbehind())&&(e+="	"),r(t.region().peek(-1,1),["[]","{}","()"])>=0?(t.insert("\n	"+e),t.view().insert(t.head().loc(),"\n"+e)):t.insert("\n"+e),!0}),o(["space","shift+space"],function(t){return"<>"==t.region().peek(-1,1)&&t.move(1).erase(),t.insert(" ")}),o(["tab"],function(t){return t.insert("	")}),o(["super+up"],function(t){return t.collapse().head().set(0,0).normalize(),t.dirty()}),o(["super+down"],function(t){return t.collapse().head().set(1e5,0).normalize(),t.dirty()}),o(["super+u"],function(t,e){return console.log(t.target(),"found ut!!!"),console.log(t.target().bubble("unwrap",{}))}),o(["alt+super+r"],function(){return window.location.reload()})],IM.Triggers=[i("|",{context:function(t){return"||"==t.region().peek(-1,1)},command:function(t){return t.move(1)}}),i("[",function(t){return t.insert("[$0]")}),i("|",function(t){return t.insert("|$0|")}),i("(",function(t){return t.insert("($0)")}),i("{",function(t){return t.insert("{$0}")}),i("<",{context:function(t){return!t.peekbehind(/(\b(tag|if|class) |\d\s*$)/)},command:function(t){return t.insert("<$0>")}}),i('"',{context:function(t,e){return"\\"==t.region().peek(-1,0)&&(e.node=t.region().scope(q$("._imstr",a)))?!0:void 0},command:function(t){return t.insert('"')}}),i("'",{context:function(t,e){return"''"==t.region().peek(-1,1)},command:function(t){return t.move(1)}}),i("'",{context:function(t,e){return e.node=t.region().scope(q$("._imstr",a))},command:function(t){return t.insert("\\'")}}),i('"',function(t){return t.insert('"$0"')}),i("'",function(t){return t.insert("'$0'")}),i("]",{context:function(t){return"]"==t.region().peek(0,1)},command:function(t){return t.move(1)}}),i("}",{context:function(t){return"}"==t.region().peek(0,1)},command:function(t){return t.move(1)}}),i(")",{context:function(t){return")"==t.region().peek(0,1)},command:function(t){return t.move(1)}})],t.ShortcutManager=s,s.prototype.view=function(){return this._view},s.prototype.keysForEvent=function(t){var e=[],n=h[t.which],r=n||String.fromCharCode(t.which);return r=r.toLowerCase(),t.ctrlKey&&"ctrl"!=n&&e.push("ctrl"),t.altKey&&"alt"!=n&&e.push("alt"),t.metaKey&&!t.ctrlKey&&"meta"!==n&&e.push("super"),t.shiftKey&&"shift"!=n&&e.push("shift"),e.indexOf(r)<0&&e.push(r),e.join("+")},s.prototype.commandsForKeys=function(t){return this._bindings.filter(function(e){return e.keys==t})},s.prototype.getShortcut=function(t){var n=this.keysForEvent(t.event());console.log(n);for(var r,i=0,o=e(this._bindings),s=o.length;s>i;i++)if(r=o[i],r.keys.indexOf(n)>=0){var a={};if(!r.context||r.context.call(this.view(),this.view().caret(),a,t,this.view()))return r.data=a,r}return null},s.prototype.getTrigger=function(t,n){for(var r,i=0,o=e(IM.Triggers),s=o.length;s>i;i++)if(r=o[i],r.trigger==n){var a=r.context?r.context.call(t,t.caret(),t,n):!0;if(a)return r}return null},s}()}).call(e,function(){return this}())},function(t,e){!function(){function t(t){void 0===t&&(t="/vendor/imba/imbac.worker.min.js"),this._path=t,this._callbacks=[]}return e.ImbacWorker=t,t.prototype.worker=function(){var t,e=this;return e._worker||(e._worker=(t=new Worker(e._path),t.onmessage=function(t){return e.onmessage(t)},t))},t.prototype.onmessage=function(t){var e;return(e=this._callbacks.shift())?e(t.data,t):void 0},t.prototype.compile=function(t,e,n){return this._callbacks.push(n),this.worker().postMessage(["compile",t,e]),this},t.prototype.analyze=function(t,e,n){return this._callbacks.push(n),this.worker().postMessage(["analyze",t,e]),this},t}()},function(t,e){!function(){return tag$.defineTag("imeditor",function(t){t.prototype.build=function(){return this.render(),this},t.prototype.render=function(){return this.setChildren((this._view=this._view||tag$.$imview().setRef("view",this)).end(),2).synced()},t.prototype.view=function(){return this._view},t.prototype.activate=function(){return this.view().activate(),this},t.prototype.deactivate=function(){return this.view().deactivate(),this},t.prototype.load=function(t,e){return this.view().load(t,e),this},t.prototype.fs=function(){return IM.FS},t.prototype.oncommand=function(t,e){return this[e.command]instanceof Function&&(this[e.command].call(this,e.args||[]),t.halt()),this},t.prototype.onsavesession=function(){console.log("imeditor.saveSession",this);var t=this.view().filename().replace(/\.imba$/,".imbasession"),e=JSON.stringify(this.view().history());return IM.FS.save(t,e,function(){return console.log("returned from saving!",t)})}})}()},function(t,e,n){!function(){function t(t){return t?t.toArray?t.toArray():t:[]}function r(t){return s.test(t)}var i="var if elif else for while def in isa while until switch when then return class tag let do and or prop attr in prop".split(" "),o="+ - * / = ++ -- == === != !== > < >= <= & && | || or . : ?".split(" "),s=/^[ \t\n]+$/;IM.HL={newline:"<b class='_imnewline'>\n</b>",space:function(t){return"<b class='_imspace'>"+t+"</b>"},tab:function(t){return new Array(t.length+1).join("<b class='_imtab'>	</b>")}};var a=n(2).Region,u=n(3).Highlighter,h={keyword:function(t){return i.indexOf(t)>=0},self:/^(this|self)$/,"const":function(t){return/^[A-Z][\w\_]*$/.test(t)},ivar:function(t){return/^@[\w\_]+$/.test(t)},bool:function(t){return/^(true|yes|false|no|null|undefined)$/.test(t)},identifier:/^[\$a-z_][\w\_\$]*(\-[\$\w\_]+)*$/,"float":/^\d+\.\d+$/,"int":/^\d+$/,comment:/^\#([ \t][^\n]*)?$/},c={all:Object.keys(h)};return String.prototype.repeat=function(t){return new Array(t+1).join(this)},String.prototype.ins=function(t,e){var n=this.toString();return"append"==e?n+t:"prepend"==e?""+t+n:e instanceof a?n.substr(0,e.start())+t+n.slice(e.end()):void 0},e.isWhitespace=r,IM.num=function(t){return tag$.$imnum().flag("number").setText(t).end()},IM.tab=function(){return tag$.$imtab().setText("	").end()},IM.newline=function(){return tag$.$imnewline().setText("\n").end()},IM.op=function(t){return tag$.$imop().flag("op").setText(t).end()},IM.tok=function(t){return t&&t._dom?t:t.match(s)?IM.parseWhitespace(t):o.indexOf(t)>=0?IM.op(t):tag$.$imtok().setText(t).end()},IM.raw=function(t,e){return tag$.$imraw().setRaw(t).end()},IM.isWhitespace=function(t){return s.test(t)},IM.isOp=function(t){return o.indexOf(t)>=0},IM.parseWhitespace=function(t,e){void 0===e&&(e=!0);var n=IM.HL;return t=t.replace(/(\n|[ ]+|[\t]+)/g,function(t,e){return"\n"==e?n.newline||"\n":" "==e[0]?n.space instanceof Function?n.space(e):e:"	"==e[0]?n.tab instanceof Function?n.tab(e):e:void 0}),e&&t.indexOf("<")>=0?tag$.$imfragment().setContent(t,0).end():t},IM.identify=function(e,n){void 0===n&&(n="all");for(var r,i,o=c[n],s=0,a=t(o),u=a.length;u>s;s++){i=a[s];var p=h[i];if(p instanceof Function?r=p(e,n):p instanceof RegExp&&(r=p.test(e)),r)return r===!0?i:r}return null},IM.parse=function(t,e){if("string"!=typeof t)return t;if(s.test(t))return IM.parseWhitespace(t,!1);var n,r=t.match(/^([ \t]*)([^]*?)([ \t]*)$/)||["","",t,""];(r[1]||r[3])&&(t=r[2]);var i=IM.identify(t);if(i){var o="span",a=u.Mapping[i]||i;a instanceof Array&&(o=a[0],a=a[1]),a.match(/\b_[\w]/)||(a="_imtok "+a),n="<"+o+' class="'+a+'">'+t+"</"+o+">"}return n||(n=u.highlight(t)),r&&(n=IM.parseWhitespace(r[1],!1)+n+IM.parseWhitespace(r[3],!1)),n?n:t},IM.textNodes=function(t,e){void 0===e&&(e=!1),t=t._dom||t;for(var n,r=[],i=0,o=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1);n=o.nextNode();){if(e){var s=n.length;n._loc=i,i+=s}r.push(n)}return r}}()},function(t,e,n){!function(){function r(){return IM.worker()}var i;IMDEBUG=!0,IM={},IM.NEWLINE="\n",IM.CHAR=0,IM.WORD_START=1,IM.WORD_END=2,IM.PUNCTUATION_START=3,IM.PUNCTUATION_END=4,IM.SUB_WORD_START=5,IM.SUB_WORD_END=6,IM.LINE_START=7,IM.LINE_END=8,IM.EMPTY_LINE=9,IM.FS=n(30);var o=n(71),s=n(2).Region;n(36),n(9),n(10),n(33),n(49),n(48),n(35);var a=n(3).Highlighter,u=n(34).ImbacWorker;return IM.worker=function(){return this._worker||(this._worker=new u)},t.exports.util=i=n(1),n(41),e.worker=r,t.exports.SourceMap=o,t.exports.Region=s,t.exports.Highlighter=a}()},function(t,e){!function(){return tag$.defineTag("imwarn","im",function(t){t.prototype.message=function(t){return this.getAttribute("message")},t.prototype.setMessage=function(t){return this.setAttribute("message",t),this},t.prototype.build=function(){return this.log("built error with error",this.object()),this}}),tag$.defineTag("imerr","imwarn")}()},function(t,e,n){!function(){function t(t){return t?t.toArray?t.toArray():t:[]}var e=n(3).Highlighter,r=n(1);return tag$.extendTag("htmlelement",function(e){e.prototype.bubble=function(t,e){var n=Imba.Events.trigger(t,this,{data:e,bubble:!0});return n},e.prototype.delay=function(t,e,n){return this._timeouts||(this._timeouts={}),clearTimeout(this._timeouts[t]),-1!=e&&(this._timeouts[t]=setTimeout(n,e)),this},e.prototype.setNext=function(e){if(e instanceof IMFragment&&(e=Array.prototype.slice.call(e.dom().childNodes)),e instanceof Array){for(var n=0,r=t(e.reverse()),i=r.length;i>n;n++)this.setNext(r[n]);return this}var o=this.dom().nextSibling;return("string"==typeof e||e instanceof String)&&(e=document.createTextNode(e)),o?this.parent().insertBefore(e,o):this.parent().appendChild(e),e},e.prototype.setPrev=function(e){if(e instanceof IMFragment&&(e=Array.prototype.slice.call(e.dom().childNodes)),e instanceof Array){for(var n=0,r=t(e),i=r.length;i>n;n++)this.setPrev(r[n]);return this}this.dom().prevSibling;return("string"==typeof e||e instanceof String)&&(e=document.createTextNode(e)),this.parent().insertBefore(e,this),e},e.prototype.nextNode=function(){return this.dom().nextSibling},e.prototype.prevNode=function(){return this.dom().prevSibling}}),IM.Types={},tag$.defineTag("im","b",function(n){n.key=function(t,e){return this.prototype["handle"+t]=e,this},n["native"]=function(t){return this._nativeType=t,this},n.type=function(t){return IM.Types[t]=this,this._type=t,this.prototype._type=t,this},n.type("Tok"),n.alias=function(t){return IM.Types[t]=this,this},n.trigger=function(t,e){return e instanceof Function&&(e={command:e}),e.trigger=t,this.prototype["trigger-"+t]=e},n.prototype.setHint=function(t){return t&&t!=this._hint?(this.setAttribute("hint",t.ref()),this.setAttribute("hint-type",t.type())):(this.removeAttribute("hint"),this.removeAttribute("hint-type")),this._hint=t},n.prototype.hint=function(){return this._hint||this.view().hints().get(this.getAttribute("hint"))},n.prototype.walkTextNodes=function(t){void 0===t&&(t=!1),this.setRoot(this.dom());for(var e,n=[],r=0,i=document.createTreeWalker(this.root(),NodeFilter.SHOW_TEXT,null,!1);e=i.nextNode();){if(t){var o=e.length;e._loc=r,r+=o}n.push(e)}return n},n.prototype.util=function(){return r},n.prototype.select=function(){return this.view().caret().set(this.region())},n.prototype.canPrepend=function(t){return!1},n.prototype.canAppend=function(t){return!1},n.prototype.log=function(){var t;return(t=this.view().logger()).log.apply(t,arguments),this},n.prototype.toString=function(){return this.dom().outerHTML},n.prototype.spaced=function(){return this.dom().nextSibling instanceof Text?/[\t ]/.test(this.dom().nextSibling.textContent[0]):!1},n.prototype.unspaced=function(){return!this.spaced()},n.prototype.nextImmediate=function(){return this.dom().nextSibling instanceof Text?null:this.next()},n.prototype.prevImmediate=function(){return this.dom().previousSibling instanceof Text?null:this.prev()},n.prototype.repair=function(){return this},n.prototype.text=function(){return this.dom().textContent},n.prototype.setText=function(t){return this.dom().textContent=t,this},n.prototype.code=function(){return this.dom().textContent},n.prototype.setCode=function(t,e){var n;void 0===e&&(e=!1);var r=this.code();return this._dom.firstChild==this._dom.lastChild&&this._dom.firstChild instanceof Text?this._dom.firstChild.textContent=t:this._dom.textContent=t,t!=r&&((n=this.hint())&&n.changed&&n.changed(),e||this.onchanged(t,r)),this},n.prototype.onchanged=function(t,e){return this.flag("dirty")},n.prototype.size=function(){return this.code().length},n.prototype.view=function(){var t;return this._view||(t=this.parent())&&t.view&&t.view()||VIEW},n.prototype.sel=function(){return this.view().caret()},n.prototype.region=function(){return this.view().regionForNode(this)},n.prototype.loc=function(){return this.region().loc()},n.prototype.load=function(){return this},n.prototype.decreaseIndent=function(t,e){return!1},n.prototype.increaseIndent=function(t,e){var n=/^(\s*(.*\=\s*)?(class|def|tag|unless|if|else|elif|switch|try|catch|finally|for|while|until|do))/;return n.test(t)},n.prototype.erase=function(t,e){return"all"==e?this.orphanize():this.setCode(r.patchString(this.code(),"",t)),this},n.prototype.insert=function(t,e,n,i){i&&i.constructor===Object||(i={});void 0!==i.mode?i.mode:null;return this.setCode(r.patchString(this.code(),e,t)),this},n.prototype.oninserted=function(t){return this},n.prototype.oncommand=function(t,e){var n=e.command,r=this[n];return this.log("run oncommand",n,e),r instanceof Function&&r.call(this,t,e),this},n.prototype.indentBlock=function(t){return this.log("im.indentBlock",arguments,this),this},n.prototype.clone=function(t){return IM.tok(t).classify()},n.prototype.validate=function(t){return!1},n.prototype.isFirst=function(){var t=this.parent();return t instanceof IM.Types.Tok&&t.dom().firstChild==this.dom()},n.prototype.isLast=function(){var t=this.parent();return t instanceof IM.Types.Tok&&t.dom().lastChild==this.dom()},n.prototype.isValid=function(t){return void 0===t&&(t=this.text()),this.validate(t)},n.prototype.markInvalid=function(){return this.flag("invalid"),this},n.prototype.markValid=function(){return this.unflag("invalid"),this},n.prototype.isInvalid=function(){return this.hasFlag("invalid")},n.prototype.classify=function(){return this},n.prototype.unwrap=function(){for(var t=this.dom(),e=t.parentNode;t.firstChild;)e.insertBefore(t.firstChild,t);return this},n.prototype.replaceWith=function(t){return this.setPrev(t),this.orphanize()},n.prototype.scope=function(){return this.closest(q$("._indent",this))},n.prototype.mutated=function(t){var e=this;return""==e.code()?(e.log("remove whole node"),e.orphanize()):(e.log("mutated -- reparse"),e.view().observer().pause(function(){return e.view().highlighter().reparse(e.dirtyExtent())}))},n.prototype.reclassify=function(t){var e=IM.Types[t]||Imba.TAGS["im"+t];if(e){if(e==this.constructor)return this;var n=new e(this.dom()).setup();return n}return this},n.prototype.reparsed=function(){return this},n.prototype.baseClasses=function(){var t=this.constructor.dom().className;return this._type&&(t+=" "+this._type),t},n.prototype.setup=function(){return this._dom.className=this.baseClasses(),this},n.prototype.reuse=function(){return this.setup.apply(this,arguments)},n.prototype.isAtomic=function(){return!1},n.prototype.dirtyExtent=function(){var e,n,r,i,o=this;if(e=o.up(q$(".selector",o)))return e.dirtyExtent();if(n=o.up(q$("._imtagnode",o)))return n.dirtyExtent();if(r=o.up(q$("._imistring",o)))return r.dirtyExtent();if(o.isAtomic())return{nodes:[o.dom()],code:o.code(),contains:function(t){return o.dom().contains(t._dom||t)}};for(var s,a,u,h,c=o.dom(),p=o.dom(),l=[o.dom()];(s=c.previousSibling)&&!(s instanceof Text)&&!s.matches("._imnewline,._imtab");)s.matches("._imopen")&&(u=s),c=s,l.unshift(c);for(;(a=p.nextSibling)&&!(a instanceof Text)&&!a.matches("._imnewline");)a.matches("._imclose")&&(h=a),p=a,l.push(p);var f={nodes:l,code:"",target:o.dom(),nested:[],contains:function(t){return this.nodes.indexOf(t)>=0}};if(u||h){var d=tag$wrap((u||h).parentNode);if((i=d)&&i.isAtomic&&i.isAtomic())return d.dirtyExtent();for(var g=0,m=t((u||h).parentNode.children),y=m.length,_=[];y>g;g++)_.push(m[g]);l=_}for(var v,b=0,g=0,m=t(l),y=m.length;y>g;g++){v=m[g];var T=(tag$wrap(v),v.textContent),$=T.length;f.code+=T,b+=$}return f.nodes=l,f},n.prototype.reparseExtent=function(t){var n=this;return n.view().observer().pause(function(){var r=n.dirtyExtent();return t&&t.handled(),e.reparse(r)})}}),tag$.defineTag("imraw","im",function(t){t.type("raw"),t.alias("@"),t.prototype.setRaw=function(t){return this._raw=t,this._dom.textContent=t,this},t.prototype.onedit=function(t){return this.setCode(t.patch(this)),t.handled()}}),tag$.defineTag("imfragment","imraw",function(t){t.type("fragment"),t.prototype.setContent=function(e){return"string"==typeof e?this.dom().innerHTML=e:t.__super__.setContent.apply(this,arguments),this},t.prototype.repair=function(){return this.unwrap(),this.orphanize(),this}}),IMFragment=Imba.TAGS.imfragment,tag$.defineTag("imopen","im",function(t){t.type("open"),t.alias("["),t.alias("("),t.alias("{"),t.alias("{{"),t.alias("index_start"),t.alias("block_param_start")}),tag$.defineTag("imclose","im",function(t){t.type("close"),t.alias("]"),t.alias(")"),t.alias("}"),t.alias("}}"),t.alias("index_end"),t.alias("block_param_end")}),tag$.defineTag("imrparen","imclose",function(t){t.type("rparen"),t.alias(")")}),tag$.defineTag("imtagopen","imopen",function(t){t.type("tag_start")}),tag$.defineTag("imtagclose","imclose",function(t){t.type("tag_end")}),tag$.defineTag("imselopen","imopen",function(t){t.type("selector_start")}),tag$.defineTag("imselclose","imclose",function(t){t.type("selector_end")}),tag$.defineTag("imquote","im"),tag$.defineTag("imsinglequote","imquote",function(t){t.type("'")}),tag$.defineTag("imdoublequote","imquote",function(t){t.type('"')}),tag$.defineTag("imstrstart","imopen",function(t){t.type("string_start")}),tag$.defineTag("imstrend","imclose",function(t){t.type("string_end")})}()},function(t,e,n){!function(){function t(t,e){return e&&e.indexOf?e.indexOf(t):[].indexOf.call(t,e)}function e(t){return t?t.toArray?t.toArray():t:[]}var r=n(3).Highlighter;n(1);return tag$.defineTag("imblock","im",function(t){t.prototype.deleteLeftRight=function(t){return this.log("imblock deleteLeftRight",t.region().peek(-1,1)),t.region().peek(-1,1)==this.code()?(this.orphanize(),t.handled()):this},t.prototype.indentBlock=function(t){var e=this;t.handled(),e.view().caret().expandToLines();var n=e.view().caret().region(),r=e.view().nodesInRegion(n);return r.map(function(t){return t.node.matches("._imnewline")&&(e.log("found tab in selection",t),"start"!=t.mode)?t.node.indent():void 0}),e.view().caret().dirty(),e},t.prototype.undent=function(t){this.log("imblock.undent",arguments);var e=t.view().nodesInRegion(t.region().clone().startAtLine());return e.map(function(t){return t.node.matches("._imnewline")&&"start"!=t.mode?t.node.undent():void 0}),this.view().caret().expandToLines(),t.handled()},t.prototype.pairable=function(t,e){return!0},t.prototype.wrap=function(t){return this.setChildren([t]),this},t.prototype.repair=function(){return q$("._imraw",this).map(function(t){return t.repair()}),this},t.prototype.rehighlight=function(){var t=this,e=t.codeState();IM.parse(e.code);throw"dont rehighlight"},t.prototype.codeState=function(){var t=this,e=t.code(),n=e,r=q$(".invalid",t),i=t.region(),o=t.view().sel().region(),s=r.map(function(e){var r=e.region(),o=r.relativeTo(i);return t.log("invalid region",i,"self",r,o),n=n.ins(e.placeholder(),o),{region:r,placeholder:e.placeholder(),raw:e.code(),node:e,root:t,relRegion:o}});return{region:i,marker:o.intersects(i)?o:null,raw:e,code:n,invalids:s}}}),tag$.defineTag("iminterpolated","imblock"),tag$.defineTag("indent","imblock",function(t){t.prototype.variables=function(){var t={},e=[];return q$("._lvar",this).map(function(n){var r=n.text();return t[r]?void 0:(t[r]=!0,e.push(r))}),e}}),tag$.defineTag("impair","imblock",function(t){t.type("pair"),t.pair=function(t,e){return this.prototype._open=t,this.prototype._close=e,this},t.prototype.open=function(){return this._open||""},t.prototype.close=function(){return this._close||""},t.prototype.build=function(){return this.gen(),this},t.prototype.setContent=function(t){throw"should not get here"},t.prototype.isEmpty=function(){return this.code().replace(/[\s\t \n]/,"")==this.open()+this.close()},t.prototype.isPaired=function(){var t=this.code();return t[0]==this.open()&&t[t.length-1]==this.close()},t.prototype.isOpened=function(){return this.code()[0]==this.open()},t.prototype.isClosed=function(){
return this.code()[this.code().length-1]==this.close()},t.prototype.unwrap=function(){if(this.isEmpty())this.log("remove the whole thing"),this.orphanize();else for(var t,e=this.parent();t=this._dom.firstChild;)e.dom().insertBefore(t,this._dom);return this},t.prototype.onunwrap=function(t){return this.log("impair onunwrap!!!",t),t.halt()},t.prototype.gen=function(){return this.setChildren([tag$.$imopen().setContent(this.open(),0).end(),tag$.$imclose().setContent(this.close(),0).end()]),this},t.prototype.oninserted=function(t){return t.setCaret(this.region().collapse(!1).move(1)),this},t.prototype.select=function(){return this},t.prototype.onlinebreak=function(t){var e=t.linestr("pre"),n=t.indent(),r=this.text().ins("",t.relRegion());if(r==this.open()+this.close()){var i="\n"+n+"	",o="\n"+n;return this.onwhitespace(t,i+o),t.caret().collapse(!1).move(-o.length),t.handled()}return this.increaseIndent(e)&&(n+="	"),this.decreaseIndent(e)&&(n=n.slice(1)),this.onwhitespace(t,"\n"+n),t.handled()},t.prototype.repair=function(){return this.log("repair imtag"),this.isPaired()||this.revalidate(!0),this},t.prototype.mutated=function(){return this.log("impair mutated"),this.revalidate()},t.prototype.defaultValidationMode=function(){return"tokenize"},t.prototype.rehighlight=function(){return this},t.prototype.revalidate=function(t,e){var n,i=this;void 0===t&&(t=i.defaultValidationMode()),void 0===e&&(e=!1);var o=i.hasFlag("invalid"),s=(i.hasFlag("invalid"),i.codeState()),a=s.code;if(!i.isPaired())return i.markInvalid();console.log("will revalidate with code",a),console.time("revalidate");try{"compile"==t?(i._output=Imbac.compile(a,{bare:!0}),i._tokens=i._output.options._tokens):i._tokens=Imbac.tokenize(a,{bare:!0}),i.markValid()}catch(u){i._tokens=null,i.markInvalid()}return console.timeEnd("revalidate"),o&&i._tokens&&(n=r.highlight(a,{tokens:i._tokens,inner:!0}))&&i.view().observer().pause(function(){return i.dom().innerHTML=n,s.invalids.map(function(t){var e;return(e=i.view().nodeAtRegion(t.region,!0))?e.replaceWith(t.node):void 0}),s.marker?i.view().sel().set(s.marker):void 0}),i},t.prototype.placeholder=function(){return this.open()+" ".repeat(this.size()-2)+this.close()},t.prototype.isAtomic=function(){return!0},t.prototype.mutated=function(){return this.log("muated imcurly"),this.view().highlighter().reparse(this.dirtyExtent()),this}}),tag$.defineTag("imcurly","impair",function(t){t.type("curly"),t.pair("{","}")}),tag$.defineTag("imsquare","impair",function(t){t.type("square"),t.pair("[","]"),t.prototype.prettify=function(t){var n=this;n.log("prettify!"),t.handled();var r=t.region().indent();return n.log("with indentation",r,r.length),n.view().observer().pause(function(){for(var t,i=0,o=e(n.children()),s=o.length,a=[];s>i;i++)t=o[i],a.push(t.matches(".comma,._imopen")?t.setNext("\n"+r+"	"):t.matches("._imclose")&&t.setPrev("\n"+r));return a}),!0}}),tag$.defineTag("imparens","impair",function(t){t.type("parens"),t.pair("(",")"),t.prototype.onunwrap=function(t){return this.log("impair onunwrap!!!",t),t.halt(),this.setCode(" "+this.code().slice(1,-1)),this.view().repair()}}),tag$.defineTag("imistring","impair",function(t){t.type("istring"),t.pair('"','"')}),tag$.defineTag("imiexpr","impair",function(t){t.type("iexpr"),t.pair("{","}")}),tag$.defineTag("imblockparams","impair",function(t){t.type("blockparams"),t.pair("|","|")}),tag$.defineTag("imtagnode","impair",function(e){e.type("tagnode"),e.pair("<",">"),e.prototype.pairable=function(e,n){return t(e,["{","[","(",'"',"'"])>=0},e.prototype.placeholder=function(){return this.open()+"x".repeat(this.size()-2)+this.close()},e.prototype.defaultValidationMode=function(){return"compile"}})}()},function(t,e,n){!function(){return n(39),n(46),n(40),n(44),n(42),n(43),n(45),n(47),n(38)}()},function(module,exports,__webpack_require__){!function(){var util=__webpack_require__(1),SINGLE_STR=/^'[^']*'$/,DOUBLE_STR=/^"[^"\{]*"$/,COMMENT=/^\#[ \t][^\n]*$/;return DOUBLE_STR=/^"([^\\"\{]|\\\\|\\")*"$/,tag$.defineTag("imlit","im",function(t){t.prototype.validate=function(t){return!1}}),tag$.defineTag("imregex","imlit",function(tag){tag.type("regex"),tag.prototype.validate=function(t){return!0},tag.prototype.pairing=function(t){return this},tag.prototype.revalidate=function(){var reg=this.code();try{var obj=eval(reg)}catch(e){}return this.log("regex is",reg,obj),this.flag("invalid",!obj),this},tag.prototype.mutated=function(){return this.log("regex mutated"),this.revalidate()},tag.prototype.placeholder=function(){return"/"+"R".repeat(this.size()-2)+"/"},tag.prototype.isAtomic=function(){return!0}})}()},function(t,e){!function(){var t={".":"dot","=":"eq","?":"q","!":"unary",":":"colon",",":"comma","#":"hash","*":"mult",">>":"bitshift"};return tag$.defineTag("imop","im",function(e){e.type("op"),e.alias("relation"),e.alias("compare"),e.alias("compound_assign"),e.alias("assign"),e.alias("block_arg"),e.alias("splat"),e.alias("logic"),e.alias("math"),e.alias("shift"),e.alias("unary"),e.prototype.validate=function(t){return IM.isOp(t)},e.prototype.baseClasses=function(){return e.__super__.baseClasses.apply(this,arguments)+" "+(t[this.code()]||"")},e.prototype.setup=function(e){var n=e&&e._value||this.code();return this.dom().className="_im _imop op "+(t[n]||""),this},e.prototype.insert=function(){return e.__super__.insert.apply(this,arguments),"//"==this.code()?(this.log("is a regex!!"),this.reclassify("regex")):void 0}}),"+ - * / = ++ -- == === != !== > < >= <= & && | || or . : ? &= ||= &&= ?. ?: , ! .. ... .: >> << #".split(" ").map(function(t){return IM.Types[t]=IM.Types.op})}()},function(t,e){!function(){return tag$.defineTag("imroot","imblock",function(t){t.prototype.view=function(t){return this._view},t.prototype.setView=function(t){return this._view=t,this},t._nodeType="code",t.prototype.tryUndent=function(t){var e=this;e.log("tryUndent");var n=t.view().nodesInRegion(t.region().clone().startAtLine());return n.map(function(t){return t.node.matches("._imnewline")&&"start"!=t.mode?(t.node.undent(),e.view().caret().move(-1)):void 0}),t.handled(),e},t.prototype.build=function(){return t.__super__.build.apply(this,arguments),this.dom().addEventListener(""),this},t.prototype.commit=function(){return this},t.prototype.setNext=function(t){return this.appendChild(t),t},t.prototype.setPrev=function(t){var e=this.dom().firstChild;return e?this.insertBefore(t,e):this.appendChild(t),t},t.prototype.onlinebreak=function(t){var e=t.linestr("pre"),n=t.indent();this.text().ins("",t.relRegion());return this.increaseIndent(e)&&(n+="	"),this.decreaseIndent(e)&&(n=n.slice(1)),this.onwhitespace(t,"\n"+n),t.handled()},t.prototype.mutated=function(){return this.log("imroot mutated"),this},t.prototype.dirtyExtent=function(){var t=this;t.log("imroot dirtyExtent");var e=t.children().map(function(t){return t.dom()});return{code:t.code(),nodes:e,parent:t.dom(),contains:function(e){return t.dom().contains(e._dom||e)}}}})}()},function(t,e){!function(){return tag$.defineTag("imsel","imtok",function(t){t.type("selector"),t.prototype.isAtomic=function(){return!0},t.prototype.reparsed=function(t,e){return this.log("imsel reparsed",t,e),this}}),tag$.defineTag("imseltag","imtok",function(t){t.type("selector_tag")}),tag$.defineTag("imselclass","imtok",function(t){t.type("selector_class")}),tag$.defineTag("imselcomb","imtok",function(t){t.type("selector_combinator")}),tag$.defineTag("imselattrop","imtok",function(t){t.type("selector_attr_op")}),tag$.defineTag("imselattrop","imtok",function(t){t.type("selector_attr_op")})}()},function(t,e,n){!function(){var t=n(2).Region,e=n(3).Highlighter,r=["true","false","null","this","delete","typeof","in","instanceof","throw","break","continue","debugger","if","else","switch","for","while","do","try","catch","finally","class","extends","super","return","undefined","then","unless","until","loop","of","by","when","def","tag","do","elif","begin","var","let","self","await","import","and","or","is","isnt","not","yes","no","isa","case","nil","extend","export","own"];return tag$.defineTag("imtok","im",function(n){n.alias("token"),n.prototype.__eref={watch:"erefDidSet",name:"eref"},n.prototype.eref=function(t){return this.getAttribute("eref")},n.prototype.setEref=function(t){var e=this.eref();return t!=e&&this.setAttribute("eref",t),t!=e&&this.erefDidSet&&this.erefDidSet(t,e,this.__eref),this},n.prototype.erefDidSet=function(t,e){return t&&e||this.flag("lvar",!!t),this},n.prototype.isVarRef=function(){return this.hasFlag("lvar")},n.prototype.clearVarRef=function(){return this.setEref(null),this},n.prototype.clone=function(t){return IM.tok(t)},n.prototype.setText=function(t){n.__super__.setText.call(this,t),this.classify();var e=IM.identify(t);return e?(this.log("reclassifying imtok immediately"),this.setCode(t),this.reclassify(e)):this._typ?this:tag$.$imraw().setRaw(t).end()},n.prototype.canPrepend=function(t){return!0},n.prototype.canAppend=function(t){return!0},n.prototype.classify=function(t){return t||(t=IM.identify(this.code())),t?(t.match(/\b_[\w]/)||(t="_imtok "+t),this.dom().className=t,this._typ=t):this._typ=null,this},n.prototype.validate=function(t){return!1},n.prototype.repair=function(){return this.log("repair"),this.classify(),this},n.prototype.split=function(e){e=t.normalize(e);var n=this.code().substring(0,e.start()),r=this.code().slice(e.end());return this.setCode(n),this.setNext(IM.tok(r)),this},n.prototype.mutated=function(t){void 0===t&&(t={});var n=this.dirtyExtent();return this.view().observer().pause(function(){return e.reparse(n)}),this},n.prototype.reuse=function(t,e,r){return e==r?this:n.__super__.reuse.apply(this,arguments)},n.prototype.mutated=function(t){return void 0===t&&(t={}),!t.deep&&this.validate(this.code())?this:n.__super__.mutated.apply(this,arguments)},n.prototype.ondblclick=function(t){return t.halt(),this.select()},n.prototype.onmouseover=function(t){return t.halt(),this.eref()?this.view().nodesForEntity(this.eref()).map(function(t){return t.flag("hl")}):void 0},n.prototype.onmouseout=function(t){return t.halt(),this.eref()?this.view().nodesForEntity(this.eref()).map(function(t){return t.unflag("hl")}):void 0}}),tag$.defineTag("imidentifier","imtok",function(t){t.type("identifier"),t.prototype.name=function(t){return this.getAttribute("name")},t.prototype.setName=function(t){return this.setAttribute("name",t),this},t.prototype.validate=function(t){return/^[a-z](-?[\wA-Za-z_\-\x7f-\uffff\$]+)*$/.test(t)&&-1==r.indexOf(t)},t.prototype.setup=function(t,e,n){var r;return t&&t._value&&(this.setName(r=t._value),r),this._dom.className=this.baseClasses(),this},t.prototype.mutated=function(){return this.setName(this.code()),this.isVarRef()&&this.clearVarRef(),t.__super__.mutated.apply(this,arguments)}}),tag$.defineTag("imtagtype","imtok",function(t){t.type("tag_type")}),tag$.defineTag("imtagid","imtok",function(t){t.type("tag_id"),t.alias("idref")}),tag$.defineTag("imconst","imtok",function(t){t.type("const"),t.prototype.validate=function(t){return/^[A-Z](-?[\wA-Za-z_\-\x7f-\uffff\$]+)*$/.test(t)}}),tag$.defineTag("imivar","imtok",function(t){t.type("ivar")}),tag$.defineTag("imcvar","imtok",function(t){t.type("cvar")}),tag$.defineTag("imkeyword","imtok",function(t){t.type("keyword"),t.alias("new"),t.prototype.setup=function(t,e,n){var r=this.baseClasses();return t&&t._value&&(r+=" "+t._value),this._dom.className=r,this}}),r.map(function(t){return IM.Types[t]=IM.Types.keyword}),IM.Types.forin=IM.Types.keyword,IM.Types.forof=IM.Types.keyword,IM.Types.post_if=IM.Types.keyword,IM.Types.post_unless=IM.Types.keyword,IM.Types.post_for=IM.Types.keyword,IM.Types.post_while=IM.Types.keyword,tag$.defineTag("imnum","imtok",function(t){t.type("number"),t.prototype.validate=function(t){return/^\d+(\.\d+)?$/.test(t)},t.prototype.reuse=function(){return this}}),tag$.defineTag("imint","imnum",function(t){t.type("int")}),tag$.defineTag("imfloat","imnum",function(t){t.type("float")}),tag$.defineTag("imbool","imtok",function(t){t.type("bool"),t.alias("true"),t.alias("false")}),tag$.defineTag("imstr","imtok",function(t){t.type("string"),t.prototype.quote=function(){return this.code()[0]},t.prototype.setQuote=function(t){return this.setCode(t+this.code().slice(1,-1)+t),this},t.prototype.setup=function(t,e,n){return this._dom.className=this.baseClasses(),this.setCode(e),this},t.prototype.onunwrap=function(t){var e;return this.log("imstring onunwrap!!!",t),t.halt(),this.setCode(e=this.code().slice(1,-1)),e},t.prototype.ondblclick=function(t){return t.halt(),this.select()},t.prototype.validate=function(t){return'"'==t[0]?/^\"([^"\{]*)\"$/.test(t):"'"==t[0]?/^\'([^'\{]*)\'$/.test(t):void 0},t.trigger('"',function(t,e){return'"'==t.quote()?(this.insert('\\"'),!0):"'"==t.quote()&&"all"==e.mode?(t.setQuote('"'),this):void 0}),t.trigger("'",function(t,e){var n;return'"'==t.quote()?(t.setQuote(n="'"),n):"'"==t.quote()&&"all"==e.mode?this.insert("\\'"):void 0})}),tag$.defineTag("imneostring","imtok",function(t){t.type("neostring"),t.prototype.mutated=function(e){return void 0===e&&(e={}),e.deep||this.code().match(/[\{\"\']/)?t.__super__.mutated.apply(this,arguments):this}}),tag$.defineTag("imsym","imtok",function(t){t.type("symbol")}),tag$.defineTag("imtagattr","imtok",function(t){t.type("tag_attr")})}()},function(t,e){!function(){return tag$.defineTag("iminsert","im",function(t){t.prototype.canAppend=function(){return!0},t.prototype.canPrepend=function(){return!0},t.prototype.insert=function(t,e){return console.log("insert code into iminsert!!",e,t),e instanceof IM.Types.fragment?e=e.code():e instanceof IM.Types.raw?e=e._raw:("string"==typeof e||e instanceof String)&&(e=(this.code()||"").ins(e,t)),this.setCode(e),this},t.prototype.isWhitespace=function(){return this.code().match(/^[\n\t\ ]+$/)},t.prototype.mutated=function(){this.log("iminsert mutated");var t=this.dirtyExtent();return this.view().highlighter().reparse(t),this}}),tag$.defineTag("imwhitespace","im",function(t){t.prototype.canPrepend=function(t){return this.validate(t+this.code())},t.prototype.canAppend=function(t){return this.validate(this.code()+t)},t.prototype.validate=function(){return!1}}),tag$.defineTag("imnewline","imwhitespace",function(t){t.type("newline"),t.alias("\n"),t.prototype.canPrepend=function(t){return t.match(/^[\n\t\ ]+$/)?!0:!1},t.prototype.validate=function(t){return void 0===t&&(t=this.code()),"\n"==t},t.prototype.indent=function(){return this.view().insert(this.region().end(),"	"),this},t.prototype.undent=function(){this.log("undent newline");var t=this.region().clone().collapse(!0).clone(0,1);return"	"==t.text()&&(this.log("can undent!!"),this.view().erase(t)),this},t.prototype.mutated=function(){return""==this.code()?(this.log("remove whole node"),this.orphanize()):(this.log("reparse newline"),this.view().highlighter().reparse({nodes:[this.dom()],code:this.code()}))}}),tag$.defineTag("imspace","imwhitespace",function(t){t.type("whitespace"),t.prototype.validate=function(t){return void 0===t&&(t=this.code()),/^[ ]+$/.test(t)},t.prototype.mutated=function(e){return void 0===e&&(e={}),!e.deep&&this.validate(this.code())?this:t.__super__.mutated.apply(this,arguments)}}),tag$.defineTag("imsemicolon","imwhitespace",function(t){t.type("semicolon"),t.alias(";")}),tag$.defineTag("imtab","imwhitespace",function(t){t.type("tab"),t.alias("	"),t.prototype.onedit=function(t){return t.isSurrounded()?(this.log("delete tab?!?"),t.text()?t.redirect(this.prev()||this.next()||this.parent()):t.handled(),t.region().collapse(!1),void this.orphanize()):void 0},t.prototype.validate=function(t){return void 0===t&&(t=this.code()),"	"==t}}),tag$.defineTag("imcomment","im",function(t){t.type("comment"),t.prototype.validate=function(t){return COMMENT.test(t)},t.prototype.mutated=function(){return this.log("imcomment mutated"),t.__super__.mutated.apply(this,arguments)},t.prototype.repair=function(){this.log("repair comment");var t=this.region().endAtLine(),e=t.text(),n=t.nodes(!1);if(this.log("whole region should be",t,e,n),this.log("all nodes",n),n.length>1)for(this.setCode(e);n.length>1;){var r=n.pop();r.node.orphanize()}return this},t.prototype.oninserted=function(t){return this.repair()},t.prototype.canPrepend=function(t){return!1},t.prototype.canAppend=function(t){return t.match(/[\n]/)?void 0:!0}}),tag$.defineTag("eof")}()},function(t,e,n){!function(){function t(t){return t?t.toArray?t.toArray():t:[]}Imba.Events&&Imba.Events.register(["copy","paste","cut","beforecut","beforepaste","beforecopy","keypress"]);var e=n(10).Logger,r=n(9).History,i=n(28).Buffer,o=n(32).Observer,s=n(2).Region,a=n(31),u=a.Hints,h=(a.Hint,n(3).Highlighter),c=n(1);return n(29),n(50),tag$.defineTag("imdims",function(t){t.prototype.ch=function(){return this._ow!=this.dom().offsetWidth&&(this._ow=this.dom().offsetWidth,this._ch=null),this._ch||(this._ch=this.dom().getBoundingClientRect().width)}}),tag$.defineTag("imviewbody"),tag$.defineTag("imview",function(n){n.prototype.filename=function(t){return this._filename},n.prototype.setFilename=function(t){return this._filename=t,this},n.prototype.observer=function(t){return this._observer},n.prototype.setObserver=function(t){return this._observer=t,this},n.prototype.history=function(t){return this._history},n.prototype.setHistory=function(t){return this._history=t,this},n.prototype.hints=function(t){return this._hints},n.prototype.setHints=function(t){return this._hints=t,this},n.prototype.logger=function(t){return this._logger},n.prototype.setLogger=function(t){return this._logger=t,this},n.prototype.shortcuts=function(t){return this._shortcuts},n.prototype.setShortcuts=function(t){return this._shortcuts=t,this},n.prototype.__focusNode={watch:"focusNodeDidSet",name:"focusNode"},n.prototype.focusNode=function(t){return this._focusNode},n.prototype.setFocusNode=function(t){var e=this.focusNode();return t!=e&&(this._focusNode=t),t!=e&&this.focusNodeDidSet&&this.focusNodeDidSet(t,e,this.__focusNode),this},n.prototype.caret=function(t){return this._caret},n.prototype.setCaret=function(t){return this._caret=t,this},n.prototype.frames=function(t){return this._frames},n.prototype.setFrames=function(t){return this._frames=t,this},n.prototype.readonly=function(t){return this._readonly},n.prototype.setReadonly=function(t){return this._readonly=t,this},n.prototype.highlighter=function(){return h},n.prototype.lineHeight=function(){return this._dims.dom().offsetHeight},n.prototype.charWidth=function(){return this._dims.ch()},n.prototype.isReadOnly=function(){return"play"==this.history().mode()},n.prototype.tabSize=function(){return 4},n.prototype.build=function(){return VIEW=this,this.setTabindex(0),this._readonly=!1,this._logger=new e(this),this._frames=0,this._changes=0,this._hints=new u(this),this._buffer=new i(this),this._history=new r(this),this._shortcuts=new ShortcutManager(this),this.render(),this._observer=new o(this),this.caret().setRegion(new s(0,0,this.root(),this)),this.dom().addEventListener("mouseover",function(t){return Imba.Events.delegate(t)}),this.dom().addEventListener("mouseout",function(t){return Imba.Events.delegate(t)}),this},n.prototype.onmouseover=function(t){return t.halt()},n.prototype.onmouseout=function(t){return t.halt()},n.prototype.setInput=function(t){return t!=this._input&&(this._input=t,this._input.dom()._responder=this.dom()),this},n.prototype.input=function(){return this._input||this._caret.input()},n.prototype.tick=function(){return this._frames++,this.history().tick(),this.render(),this._dirty&&this.repair(),this},n.prototype.commit=function(){return this.tick()},n.prototype.log=function(){var t;return(t=this.logger()).log.apply(t,arguments),this},n.prototype.edited=function(){var t=this;return t._changes++,t._dirty=!0,t._buffer.refresh(),t.view().hints().rem(function(t){return"runtime"==t.group()}),t.hints().cleanup(),t.delay("didchange",50,function(){return Imba.Events.trigger("edited:async",t,{data:t})}),t.delay("annotate",500,function(){return t.annotate()}),t.delay("recompile",-1),t},n.prototype.dirty=function(){return this},n.prototype.activate=function(){return this.flag("active"),this},n.prototype.deactivate=function(){return this.unflag("active"),this},n.prototype.body=function(){var t;return(t=this._body=this._body||tag$.$imviewbody().setRef("body",this)).setContent([(this._dims=this._dims||tag$.$imdims().setRef("dims",this)).setText("x").end(),(this._caret=this._caret||tag$.$imcaret().setRef("caret",this)).setView(this).end(),(this._root=this._root||tag$.$imroot().setRef("root",this).flag("imba")).setView(this).end()],2).end()},n.prototype.header=function(){return null},n.prototype.footer=function(){return null},n.prototype.overlays=function(){return(this._overlays=this._overlays||tag$.$scrimbla_overlays().setRef("overlays",this)).setView(this).end()},n.prototype.render=function(){return this.flag("readonly",this.isReadOnly()).setChildren([this.header(),this.body(),this.footer()],1).synced()},n.prototype.view=function(){return this},n.prototype.sel=function(){return this.caret()},n.prototype.root=function(){return this._root},n.prototype.buffer=function(){return this._buffer},n.prototype.size=function(){return this.root().size()},n.prototype.load=function(t,e){var n;return void 0===e&&(e={}),this.setFilename(e.filename),e.html?(this.root().dom().innerHTML=e.html,this._buffer.refresh(),this.history().onload(this.code())):((n=this.parse(t))&&(n.highlighted?this.root().dom().innerHTML=n.highlighted:this.root().dom().textContent=t),this._buffer.refresh(),this.history().onload(t),this.annotate()),this},n.prototype.parse=function(t){return{highlighted:IM.parse(t)}},n.prototype.refocus=function(){return document.activeElement!=this.input().dom()&&this.input().focus(),this},n.prototype.oninputfocus=function(t){return console.log("oninputfocus!!"),VIEW=this,this.flag("focus")},n.prototype.oninputblur=function(t){return this.unflag("focus")},n.prototype.onfocusin=function(t){return VIEW=this,this.flag("focus"),console.log("focus",t),this},n.prototype.onfocusout=function(t){return this.unflag("focus"),console.log("unfocus",t),this},n.prototype.oninput=function(t){return this},n.prototype.ontextinput=function(t){return this},n.prototype.execAction=function(t,e){var n;if(t.command instanceof Function)return t.command.call(this,this.caret(),t.data||{event:e},this);if("string"==typeof(n=t.command)||n instanceof String){this.log("command is string",t.command);var r=Imba.Events.trigger(t.command,this,{data:t});return this.log(r),this}},n.prototype.tryCommand=function(t,e,n){if(void 0===n&&(n=[]),t.context){var r=t.context.apply(e||this,n);if(!r)return!1}return t.command instanceof Function?t.command.apply(e||this,n):void 0},n.prototype.onkeydown=function(t){var e;VIEW=this,t.halt();var n=this.shortcuts().keysForEvent(t.event()),r=this.shortcuts().getShortcut(t),i=null,o=/\bshift\b/.test(n),s=/\balt\b/.test(n),a=/\bsuper\b/.test(n);if(r)return void(this.execAction(r,t)&&t.cancel());if(e=n.match(/\b(left|right|up|down)/)){this.hints().activate();var u=this.caret().isCollapsed(),h=this.caret().ends();if(o?this.caret().decollapse():this.caret().collapse(),"down"==e[0])return this.caret().moveDown(),t.cancel();if("up"==e[0])return this.caret().moveUp(),t.cancel();var c=IM.CHARACTERS,p=0;if("left"==e[0]&&(p=-1),"right"==e[0]&&(p=1),s)c=p>0?IM.WORD_END:IM.WORD_START;else if(a)c=p>0?IM.LINE_END:IM.LINE_START;else if(!o&&!u)return this.caret().head().set(p>0?h[1]:h[0]),this.caret().dirty(),t.cancel();return this.caret().move(p,c),t.cancel()}return 229==t.event().which?t.halt():n.match(/^super\+(c|v|x)$/)?(t.halt(),this._awaitCombo=!0,void this.refocus()):null!=i?(t.halt().cancel(),this.caret().insert(i),this):this},n.prototype.onkeypress=function(t){if(this._awaitCombo)return this._awaitCombo=!1,t.halt();t.halt();var e=String.fromCharCode(t.event().charCode);return t._text=e,t.cancel(),this.ontype(t),this},n.prototype.ontextinput=function(t){return t.halt().cancel(),t._text=t.event().data,this.ontype(t),this},n.prototype.onkeyup=function(t){return t.halt(),this},n.prototype.oninput=function(t){return t.halt(),this},n.prototype.ontype=function(t){try{var e,n=t._text,r=this.view().nodesInRegion(this.caret().region(),!1,!0),i=r[0];if(1==r.length&&(e=i.node["trigger-"+n])&&this.tryCommand(e,this.caret(),[i.node,i]))return this;if(e=this.shortcuts().getTrigger(this,n),e&&e.command instanceof Function)return e.command(this.caret(),this,n,t);if(n)return this.caret().insert(n)}catch(t){return this.log("error from ontype")}},n.prototype.onbackspace=function(t){t.cancel().halt(),this.caret().erase()},n.prototype.onbeforecopy=function(t){this.input().select();var e=t.event().clipboardData;return e.setData("text/plain",this.caret().text()),t.halt()},n.prototype.oncopy=function(t){var e=t.event().clipboardData;e.setData("text/plain",this.caret().text()),t.halt().cancel(),this.refocus()},n.prototype.oncut=function(t){var e=t.event().clipboardData;return e.setData("text/plain",this.caret().text()),t.halt().cancel(),this.caret().erase()},n.prototype.onbeforepaste=function(t){return console.log("onbeforepaste",t)},n.prototype.onpaste=function(t){console.log("onpaste",t);var e=t.event().clipboardData,n=e.getData("text/plain");return t.halt().cancel(),this.caret().insert(n),this.refocus(),this.repair()},n.prototype.refresh=function(){return this.caret().render(),this},n.prototype.exec=function(t){var e=(t.command,t.args||[],new Imba.Event({type:"command",target:this.dom(),data:t}));e.setData(t),e.process()},n.prototype.ontouchstart=function(e){var n;if(this._rect=this._body.dom().getBoundingClientRect(),0==e.button()){if(e._touch)return e.redirect({});var r=e.event();r.preventDefault();var i=r.shiftKey,n=t(this.rcForTouch(e)),o=n[0],s=n[1];return i?this.caret().selectable():this.caret().collapse(),this.caret().head().set(o,s).normalize(),this.caret().dirty(),this.refocus(),this}},n.prototype.xyToRowCol=function(t,e){var n=Math.max(Math.round(t/this.charWidth()),0),r=Math.max(Math.ceil(e/this.lineHeight()),1);return[r-1,n]},n.prototype.rcForTouch=function(t){var e=Math.max(t.x()-this._rect.left,0),n=Math.max(t.y()-this._rect.top,0);return this.xyToRowCol(e,n)},n.prototype.ontouchupdate=function(e){var n;if(0==e.button()){var n=t(this.rcForTouch(e)),r=n[0],i=n[1];return this.caret().selectable(),this.caret().head().set(r,i).normalize(),this.caret().dirty(),this}},n.prototype.ontouchend=function(e){var n;if(0==e.button()){var n=t(this.rcForTouch(e)),r=n[0],i=n[1];return this.caret().head().set(r,i).normalize(),this.caret().dirty(),this}},n.prototype.erase=function(e,n){e=s.normalize(e,this);var r=e.text();this.history().onerase(e,r,n);var i=this.nodesInRegion(e,!1,!0);return this.observer().pause(function(){if(i.length>1)i[1].node.setPrev(tag$.$iminsert().flag("dirty").end());else if(i[0]&&"all"==i[0].mode){console.log("removing single node?!");i[0].node.prev();i[0].node.setPrev(tag$.$iminsert().flag("dirty").end())}for(var e,r=0,o=t(i),s=o.length,a=[];s>r;r++)e=o[r],a.push(e.node.erase(e.region,e.mode,n));return a}),this.erased(e)},n.prototype.inserted=function(e,n){console.log("inserted",e,n);for(var r=new s(e,e+n.length,null,this),i=0,o=t(this.hints()),a=o.length;a>i;i++)o[i].adjust(r,!0);return this.edited(),c.isWhitespace(n)&&this.repair(),this},n.prototype.erased=function(e){for(var n=0,r=t(this.hints()),i=r.length;i>n;n++)r[n].adjust(e,!1);return this.edited(),this.repair()},n.prototype.insert=function(t,e,n){t instanceof s&&(t.size()>0&&this.logger().warn("uncollapsed region in insert is not allowed"),t=t.start()),this.log("insert",t,e),this.history().oninsert(t,e,n);var r,i=this.nodesInRegion(s.normalize(t,this),!1),o=i[0],a=(o||i.prev||i.next,i.lft),u=i.rgt;if(this.log("before and after",a,u,e),o)this.log("insert mid",o.node),o.node.insert(o.region,e,n,o);else{for(;u;){if(u.canPrepend(e))return this.log("prepend",u,e),u.insert("prepend",e,n),this.inserted(t,e);{if(!u.isFirst())break;u=u.parent()}}for(;a;){if(a.canAppend(e))return this.log("append",a,e),a.insert("append",e,n),this.inserted(t,e);{if(!a.isLast())break;a=a.parent()}}r=tag$.$iminsert().end(),a?a.setNext(r):u?u.setPrev(r):this.root().dom().appendChild(r.dom()),r.insert("append",e,n)}return this.inserted(t,e)},n.prototype.onmutations=function(){return this},n.prototype.repair=function(){this._dirty=!1;var e=this.dom().getElementsByClassName("dirty");if(e.length){for(var n=[],r=0,i=t(e),o=i.length;o>r;r++)n.push(tag$wrap(i[r]));for(var s,r=0,i=t(n),o=i.length;o>r;r++)s=i[r],s.unflag("dirty"),s.mutated(n)}return this},n.prototype.code=function(){return this._root.dom().textContent},n.prototype.focusNodeDidSet=function(t,e){if(this.root().contains(t)){for(var n=[];t&&t!=this.root();)n.push(t),t=t.parent();q$(".focus_",this).map(function(t){return n.indexOf(t)<0?t.unflag("focus_"):void 0});for(var r=0,i=n.length;i>r;r++)n[r].flag("focus_");return this}},n.prototype.recompile=function(){console.log("recompile");var t;try{t=Imbac.compile(this.code(),{bare:!0})}catch(e){}return t&&this.compiled(t),this},n.prototype.reparse=function(){return this.log("reparse"),this.root().rehighlight({inner:!0}),this},n.prototype.compiled=function(t){return this},n.prototype.onrunerror=function(t){return console.log("onrunerror",t),this},n.prototype.addError=function(t,e){var n,r=s.normalize(e,this);return console.log("found warnings",r,t,e),(n=this.nodeAtRegion(r))&&(this.log("node at region is?!",n),t=t.split(/error at (\[[\d\:]*\])\:\s*/).pop(),n.flag("err"),n.setAttribute("error",t)),this.delay("annotate",-1),this},n.prototype.annotate=function(){var e=this,n=e.root().codeState(),r=n.code,i=function(n){for(var r=[],i=0,o=t(n.scopes),s=o.length;s>i;i++)for(var a=0,u=t(o[i].vars),h=u.length;h>a;a++)r.push(u[a]);var c=n.warnings||[],p=e.hints().filter(function(t){return"analysis"==t.group()});p&&e.hints().rem(p);for(var l,i=0,o=t(c),s=o.length;s>i;i++)l=o[i],l.type||(l.type="error"),l.group="analysis",e.hints().add(l).activate();if(c.length)return e;for(var f,d=IM.textNodes(e.root().dom(),!0),g={},i=0,o=t(d),s=o.length;s>i;i++)f=o[i],g[f._loc]=f;for(var m=0,s=r.length;s>m;m++)for(var y,_=0,o=t(r[m].refs),h=o.length;h>_;_++){y=o[_];var v=y.loc[0],b=(y.loc[1],"v"+m);if(g[v]){var T=g[v].parentNode;T.getAttribute("eref");tag$wrap(T).setEref(b)}}};try{console.time("analyze"),IM.worker().analyze(r,{bare:!0},function(t){return console.log("result from worker analyze"),console.timeEnd("analyze"),t.data?(console.time("annotate"),i(t.data),console.timeEnd("annotate")):void 0})}catch(o){e.log("error from annotate",o)}return e},n.prototype.oncommand=function(t,e){return this[e.command]instanceof Function&&(this[e.command].call(this,e.args||[]),t.halt()),this},n.prototype.dumpState=function(t){return void 0===t&&(t={}),{html:this.root().dom().innerHTML,code:this.root().code(),selection:this.caret().region(),timestamp:new Date}},n.prototype.loadState=function(t){var e=this;return void 0===t&&(t={}),e.observer().pause(function(){var n;return t.html?e.root().dom().innerHTML=t.html:t.code&&e.load(t.code),t.selection?(e.caret().setRegion(n=t.selection),n):void 0}),e},n.prototype.loadSession=function(t){return this.history().load(t),this.history().play(),this},n.prototype.textNodes=function(t){return void 0===t&&(t=this.root()),IM.textNodes(t)},n.prototype.regionForNode=function(t,e){void 0===e&&(e=this.root());var n=t._dom||t,r=n.textContent.length,i=document.createRange();i.setStart(e._dom||e,0),i.setEnd(t._dom||t,0);var o=i.toString();return new s(o.length,o.length+r,e,this)},n.prototype.nodeAtRegion=function(e,n){void 0===n&&(n=!1),console.time("nodeAtRegion");for(var r,i,o,s,a,u=this.root(),h=e.a(),c=e.b(),p=this.textNodes(u),l=0,f=null,d=0,g=t(p),m=g.length;m>d;d++){if(a=g[d],r=h-l,i=c-l,o=a.textContent,s=o.length,r>=0&&s>r){f=a;break}if(i>=0&&s>i)break;l+=s}var y=tag$wrap(f.parentNode);if(n&&s<e.size())for(;y;){var _=y.region();if(e.equals(_))return y;y=y.parent()}return console.timeEnd("nodeAtRegion"),f?tag$wrap(f.parentNode):null},n.prototype.nodesForEntity=function(t){
return q$('[eref="'+t+'"]',this)},n.prototype.nodesInRegion=function(e,n,r){void 0===n&&(n=!0),void 0===r&&(r=!1),console.time("nodesInRegion"),e=s.normalize(e,this).normalize();var i,o,a=e.start(),u=e.end(),h=IM.textNodes(e.root()||this.root()),c=[];c.includeEnds=n,c.region=e;for(var p,l=0,f=[],d=0,g=t(h),m=g.length;m>d;d++){p=g[d];var y=p.textContent,_=y.length;if(l+_>=a&&u>=l){o=tag$wrap(p.parentNode);var v,b=Math.max(0,a-l),T=Math.min(_,Math.max(u-l,0));i={node:o,startOffset:b,endOffset:T,region:new s(b,T,o,this),size:_};var $="all";if(b==_)$="end";else if(0==T)$="start";else if(0==b&&T==_){v=o.dom().parentNode;var I=v!=this._root.dom()&&o.dom()==v.firstChild,w=v!=this._root.dom()&&o.dom()==v.lastChild;I&&(i.opens=o.parent(),f.push(i)),w&&(T=f[f.length-1],T&&T.opens==o.parent()&&(T.closer=i,i.opener=T,f.pop()),i.closes=o.parent()),$="all"}else $="partial";i.mode=$,c.push(i)}if(l+=_,l>u)break}var A=c[0],k=c[c.length-1];if(A&&"end"==A.mode&&(c.prev=A,c.lft=A.node,n||c.shift()),k&&"start"==k.mode&&(c.next=k,c.rgt=k.node,n||c.pop()),r)for(var E,x=0;E=c[x];){if(E.closer){var S=c.indexOf(E.closer);_=E.opens.size();var R={mode:"all",region:new s(0,_,E.opens,this),startOffset:0,endOffset:_,node:E.opens},C=c.splice(x,S-x+1,R);R.children=C}x++}return console.timeEnd("nodesInRegion"),c},n.prototype.linecount=function(){return this.buffer().linecount()},n.prototype.substr=function(t,e){return this.buffer().substr(t,e)},n.prototype.linestr=function(t){return this.buffer().line(t)},n.prototype.expandRegionTo=function(t,e,n){void 0===n&&(n=!0);var r=this.buffer().toString(),i=t.start(),o=t.end();if(n)for(;r[o+1]!=e;)o++;else for(;r[i-1]!=e;)i--;return new s(i,o,this)}}),VIEW=null}()},function(t,e){!function(){return tag$.defineTag("imcaptor","input",function(t){t.prototype.select=function(){return this.dom().value||(this.dom().value="x"),this.dom().select(),this},t.prototype.build=function(){var e=this;return t.__super__.build.apply(e,arguments),e.dom().onfocus=function(t){console.log("dom onfocus!!!!");var n=Imba.Event.wrap({type:"inputfocus",target:e.dom()});return n.process()},e.dom().onblur=function(t){console.log("dom onblur!!!!",t);var n=Imba.Event.wrap({type:"inputblur",target:e.dom(),relatedTarget:t.relatedTarget});return n.process()},e}})}()},function(t,e){!function(){return tag$.defineTag("scrimbla-overlay",function(t){t.prototype.view=function(t){return this._view},t.prototype.setView=function(t){return this._view=t,this},t.prototype.render=function(){return this.setChildren(JSON.stringify(this.object()),3).synced()}}),tag$.defineTag("scrimbla-overlays",function(t){t.prototype.view=function(t){return this._view},t.prototype.setView=function(t){return this._view=t,this},t.prototype.add=function(t,e){return void 0===e&&(e={}),console.log("add overlay!"),this.append(tag$.$scrimbla_overlay().setView(this.view()).setObject(e).end()),this},t.prototype.reposition=function(){return this}})}()},function(t,e,n){(function(){function e(t){this.tokens=[],this.tokens.links={},this.options=t||c.defaults,this.rules=p.normal,this.options.gfm&&(this.options.tables?this.rules=p.tables:this.rules=p.gfm)}function n(t,e){if(this.options=e||c.defaults,this.links=t,this.rules=l.normal,this.renderer=this.options.renderer||new r,this.renderer.options=this.options,!this.links)throw new Error("Tokens array requires a `links` property.");this.options.gfm?this.options.breaks?this.rules=l.breaks:this.rules=l.gfm:this.options.pedantic&&(this.rules=l.pedantic)}function r(t){this.options=t||{}}function i(t){this.tokens=[],this.token=null,this.options=t||c.defaults,this.options.renderer=this.options.renderer||new r,this.renderer=this.options.renderer,this.renderer.options=this.options}function o(t,e){return t.replace(e?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function s(t){return t.replace(/&([#\w]+);/g,function(t,e){return e=e.toLowerCase(),"colon"===e?":":"#"===e.charAt(0)?"x"===e.charAt(1)?String.fromCharCode(parseInt(e.substring(2),16)):String.fromCharCode(+e.substring(1)):""})}function a(t,e){return t=t.source,e=e||"",function n(r,i){return r?(i=i.source||i,i=i.replace(/(^|[^\[])\^/g,"$1"),t=t.replace(r,i),n):new RegExp(t,e)}}function u(){}function h(t){for(var e,n,r=1;r<arguments.length;r++){e=arguments[r];for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t}function c(t,n,r){if(r||"function"==typeof n){r||(r=n,n=null),n=h({},c.defaults,n||{});var s,a,u=n.highlight,p=0;try{s=e.lex(t,n)}catch(l){return r(l)}a=s.length;var f=function(t){if(t)return n.highlight=u,r(t);var e;try{e=i.parse(s,n)}catch(o){t=o}return n.highlight=u,t?r(t):r(null,e)};if(!u||u.length<3)return f();if(delete n.highlight,!a)return f();for(;p<s.length;p++)!function(t){return"code"!==t.type?--a||f():u(t.text,t.lang,function(e,n){return e?f(e):null==n||n===t.text?--a||f():(t.text=n,t.escaped=!0,void(--a||f()))})}(s[p])}else try{return n&&(n=h({},c.defaults,n)),i.parse(e.lex(t,n),n)}catch(l){if(l.message+="\nPlease report this to https://github.com/chjj/marked.",(n||c.defaults).silent)return"<p>An error occured:</p><pre>"+o(l.message+"",!0)+"</pre>";throw l}}var p={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:u,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:u,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,blockquote:/^( *>[^\n]+(\n(?!def)[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment *(?:\n|\s*$)|closed *(?:\n{2,}|\s*$)|closing *(?:\n{2,}|\s*$))/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,table:u,paragraph:/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n*/,text:/^[^\n]+/};p.bullet=/(?:[*+-]|\d+\.)/,p.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,p.item=a(p.item,"gm")(/bull/g,p.bullet)(),p.list=a(p.list)(/bull/g,p.bullet)("hr","\\n+(?=\\1?(?:[-*_] *){3,}(?:\\n+|$))")("def","\\n+(?="+p.def.source+")")(),p.blockquote=a(p.blockquote)("def",p.def)(),p._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|[^\\w\\s@]*@)\\b",p.html=a(p.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,p._tag)(),p.paragraph=a(p.paragraph)("hr",p.hr)("heading",p.heading)("lheading",p.lheading)("blockquote",p.blockquote)("tag","<"+p._tag)("def",p.def)(),p.normal=h({},p),p.gfm=h({},p.normal,{fences:/^ *(`{3,}|~{3,})[ \.]*(\S+)? *\n([\s\S]*?)\s*\1 *(?:\n+|$)/,paragraph:/^/,heading:/^ *(#{1,6}) +([^\n]+?) *#* *(?:\n+|$)/}),p.gfm.paragraph=a(p.paragraph)("(?!","(?!"+p.gfm.fences.source.replace("\\1","\\2")+"|"+p.list.source.replace("\\1","\\3")+"|")(),p.tables=h({},p.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),e.rules=p,e.lex=function(t,n){var r=new e(n);return r.lex(t)},e.prototype.lex=function(t){return t=t.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(t,!0)},e.prototype.token=function(t,e,n){for(var r,i,o,s,a,u,h,c,l,t=t.replace(/^ +$/gm,"");t;)if((o=this.rules.newline.exec(t))&&(t=t.substring(o[0].length),o[0].length>1&&this.tokens.push({type:"space"})),o=this.rules.code.exec(t))t=t.substring(o[0].length),o=o[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:this.options.pedantic?o:o.replace(/\n+$/,"")});else if(o=this.rules.fences.exec(t))t=t.substring(o[0].length),this.tokens.push({type:"code",lang:o[2],text:o[3]||""});else if(o=this.rules.heading.exec(t))t=t.substring(o[0].length),this.tokens.push({type:"heading",depth:o[1].length,text:o[2]});else if(e&&(o=this.rules.nptable.exec(t))){for(t=t.substring(o[0].length),u={type:"table",header:o[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:o[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:o[3].replace(/\n$/,"").split("\n")},c=0;c<u.align.length;c++)/^ *-+: *$/.test(u.align[c])?u.align[c]="right":/^ *:-+: *$/.test(u.align[c])?u.align[c]="center":/^ *:-+ *$/.test(u.align[c])?u.align[c]="left":u.align[c]=null;for(c=0;c<u.cells.length;c++)u.cells[c]=u.cells[c].split(/ *\| */);this.tokens.push(u)}else if(o=this.rules.lheading.exec(t))t=t.substring(o[0].length),this.tokens.push({type:"heading",depth:"="===o[2]?1:2,text:o[1]});else if(o=this.rules.hr.exec(t))t=t.substring(o[0].length),this.tokens.push({type:"hr"});else if(o=this.rules.blockquote.exec(t))t=t.substring(o[0].length),this.tokens.push({type:"blockquote_start"}),o=o[0].replace(/^ *> ?/gm,""),this.token(o,e,!0),this.tokens.push({type:"blockquote_end"});else if(o=this.rules.list.exec(t)){for(t=t.substring(o[0].length),s=o[2],this.tokens.push({type:"list_start",ordered:s.length>1}),o=o[0].match(this.rules.item),r=!1,l=o.length,c=0;l>c;c++)u=o[c],h=u.length,u=u.replace(/^ *([*+-]|\d+\.) +/,""),~u.indexOf("\n ")&&(h-=u.length,u=this.options.pedantic?u.replace(/^ {1,4}/gm,""):u.replace(new RegExp("^ {1,"+h+"}","gm"),"")),this.options.smartLists&&c!==l-1&&(a=p.bullet.exec(o[c+1])[0],s===a||s.length>1&&a.length>1||(t=o.slice(c+1).join("\n")+t,c=l-1)),i=r||/\n\n(?!\s*$)/.test(u),c!==l-1&&(r="\n"===u.charAt(u.length-1),i||(i=r)),this.tokens.push({type:i?"loose_item_start":"list_item_start"}),this.token(u,!1,n),this.tokens.push({type:"list_item_end"});this.tokens.push({type:"list_end"})}else if(o=this.rules.html.exec(t))t=t.substring(o[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:!this.options.sanitizer&&("pre"===o[1]||"script"===o[1]||"style"===o[1]),text:o[0]});else if(!n&&e&&(o=this.rules.def.exec(t)))t=t.substring(o[0].length),this.tokens.links[o[1].toLowerCase()]={href:o[2],title:o[3]};else if(e&&(o=this.rules.table.exec(t))){for(t=t.substring(o[0].length),u={type:"table",header:o[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:o[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:o[3].replace(/(?: *\| *)?\n$/,"").split("\n")},c=0;c<u.align.length;c++)/^ *-+: *$/.test(u.align[c])?u.align[c]="right":/^ *:-+: *$/.test(u.align[c])?u.align[c]="center":/^ *:-+ *$/.test(u.align[c])?u.align[c]="left":u.align[c]=null;for(c=0;c<u.cells.length;c++)u.cells[c]=u.cells[c].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(u)}else if(e&&(o=this.rules.paragraph.exec(t)))t=t.substring(o[0].length),this.tokens.push({type:"paragraph",text:"\n"===o[1].charAt(o[1].length-1)?o[1].slice(0,-1):o[1]});else if(o=this.rules.text.exec(t))t=t.substring(o[0].length),this.tokens.push({type:"text",text:o[0]});else if(t)throw new Error("Infinite loop on byte: "+t.charCodeAt(0));return this.tokens};var l={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:u,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:[^_]|__)+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:u,text:/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/};l._inside=/(?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*/,l._href=/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/,l.link=a(l.link)("inside",l._inside)("href",l._href)(),l.reflink=a(l.reflink)("inside",l._inside)(),l.normal=h({},l),l.pedantic=h({},l.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),l.gfm=h({},l.normal,{escape:a(l.escape)("])","~|])")(),url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:a(l.text)("]|","~]|")("|","|https?://|")()}),l.breaks=h({},l.gfm,{br:a(l.br)("{2,}","*")(),text:a(l.gfm.text)("{2,}","*")()}),n.rules=l,n.output=function(t,e,r){var i=new n(e,r);return i.output(t)},n.prototype.output=function(t){for(var e,n,r,i,s="";t;)if(i=this.rules.escape.exec(t))t=t.substring(i[0].length),s+=i[1];else if(i=this.rules.autolink.exec(t))t=t.substring(i[0].length),"@"===i[2]?(n=":"===i[1].charAt(6)?this.mangle(i[1].substring(7)):this.mangle(i[1]),r=this.mangle("mailto:")+n):(n=o(i[1]),r=n),s+=this.renderer.link(r,null,n);else if(this.inLink||!(i=this.rules.url.exec(t))){if(i=this.rules.tag.exec(t))!this.inLink&&/^<a /i.test(i[0])?this.inLink=!0:this.inLink&&/^<\/a>/i.test(i[0])&&(this.inLink=!1),t=t.substring(i[0].length),s+=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(i[0]):o(i[0]):i[0];else if(i=this.rules.link.exec(t))t=t.substring(i[0].length),this.inLink=!0,s+=this.outputLink(i,{href:i[2],title:i[3]}),this.inLink=!1;else if((i=this.rules.reflink.exec(t))||(i=this.rules.nolink.exec(t))){if(t=t.substring(i[0].length),e=(i[2]||i[1]).replace(/\s+/g," "),e=this.links[e.toLowerCase()],!e||!e.href){s+=i[0].charAt(0),t=i[0].substring(1)+t;continue}this.inLink=!0,s+=this.outputLink(i,e),this.inLink=!1}else if(i=this.rules.strong.exec(t))t=t.substring(i[0].length),s+=this.renderer.strong(this.output(i[2]||i[1]));else if(i=this.rules.em.exec(t))t=t.substring(i[0].length),s+=this.renderer.em(this.output(i[2]||i[1]));else if(i=this.rules.code.exec(t))t=t.substring(i[0].length),s+=this.renderer.codespan(o(i[2],!0));else if(i=this.rules.br.exec(t))t=t.substring(i[0].length),s+=this.renderer.br();else if(i=this.rules.del.exec(t))t=t.substring(i[0].length),s+=this.renderer.del(this.output(i[1]));else if(i=this.rules.text.exec(t))t=t.substring(i[0].length),s+=this.renderer.text(o(this.smartypants(i[0])));else if(t)throw new Error("Infinite loop on byte: "+t.charCodeAt(0))}else t=t.substring(i[0].length),n=o(i[1]),r=n,s+=this.renderer.link(r,null,n);return s},n.prototype.outputLink=function(t,e){var n=o(e.href),r=e.title?o(e.title):null;return"!"!==t[0].charAt(0)?this.renderer.link(n,r,this.output(t[1])):this.renderer.image(n,r,o(t[1]))},n.prototype.smartypants=function(t){return this.options.smartypants?t.replace(/---/g,"—").replace(/--/g,"–").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…"):t},n.prototype.mangle=function(t){if(!this.options.mangle)return t;for(var e,n="",r=t.length,i=0;r>i;i++)e=t.charCodeAt(i),Math.random()>.5&&(e="x"+e.toString(16)),n+="&#"+e+";";return n},r.prototype.code=function(t,e,n){if(this.options.highlight){var r=this.options.highlight(t,e);null!=r&&r!==t&&(n=!0,t=r)}return e?'<pre><code class="'+this.options.langPrefix+o(e,!0)+'">'+(n?t:o(t,!0))+"\n</code></pre>\n":"<pre><code>"+(n?t:o(t,!0))+"\n</code></pre>"},r.prototype.blockquote=function(t){return"<blockquote>\n"+t+"</blockquote>\n"},r.prototype.html=function(t){return t},r.prototype.heading=function(t,e,n){return"<h"+e+' id="'+this.options.headerPrefix+n.toLowerCase().replace(/[^\w]+/g,"-")+'">'+t+"</h"+e+">\n"},r.prototype.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"},r.prototype.list=function(t,e){var n=e?"ol":"ul";return"<"+n+">\n"+t+"</"+n+">\n"},r.prototype.listitem=function(t){return"<li>"+t+"</li>\n"},r.prototype.paragraph=function(t){return"<p>"+t+"</p>\n"},r.prototype.table=function(t,e){return"<table>\n<thead>\n"+t+"</thead>\n<tbody>\n"+e+"</tbody>\n</table>\n"},r.prototype.tablerow=function(t){return"<tr>\n"+t+"</tr>\n"},r.prototype.tablecell=function(t,e){var n=e.header?"th":"td",r=e.align?"<"+n+' style="text-align:'+e.align+'">':"<"+n+">";return r+t+"</"+n+">\n"},r.prototype.strong=function(t){return"<strong>"+t+"</strong>"},r.prototype.em=function(t){return"<em>"+t+"</em>"},r.prototype.codespan=function(t){return"<code>"+t+"</code>"},r.prototype.br=function(){return this.options.xhtml?"<br/>":"<br>"},r.prototype.del=function(t){return"<del>"+t+"</del>"},r.prototype.link=function(t,e,n){if(this.options.sanitize){try{var r=decodeURIComponent(s(t)).replace(/[^\w:]/g,"").toLowerCase()}catch(i){return""}if(0===r.indexOf("javascript:")||0===r.indexOf("vbscript:"))return""}var o='<a href="'+t+'"';return e&&(o+=' title="'+e+'"'),o+=">"+n+"</a>"},r.prototype.image=function(t,e,n){var r='<img src="'+t+'" alt="'+n+'"';return e&&(r+=' title="'+e+'"'),r+=this.options.xhtml?"/>":">"},r.prototype.text=function(t){return t},i.parse=function(t,e,n){var r=new i(e,n);return r.parse(t)},i.prototype.parse=function(t){this.inline=new n(t.links,this.options,this.renderer),this.tokens=t.reverse();for(var e="";this.next();)e+=this.tok();return e},i.prototype.next=function(){return this.token=this.tokens.pop()},i.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},i.prototype.parseText=function(){for(var t=this.token.text;"text"===this.peek().type;)t+="\n"+this.next().text;return this.inline.output(t)},i.prototype.tok=function(){switch(this.token.type){case"space":return"";case"hr":return this.renderer.hr();case"heading":return this.renderer.heading(this.inline.output(this.token.text),this.token.depth,this.token.text);case"code":return this.renderer.code(this.token.text,this.token.lang,this.token.escaped);case"table":var t,e,n,r,i,o="",s="";for(n="",t=0;t<this.token.header.length;t++)r={header:!0,align:this.token.align[t]},n+=this.renderer.tablecell(this.inline.output(this.token.header[t]),{header:!0,align:this.token.align[t]});for(o+=this.renderer.tablerow(n),t=0;t<this.token.cells.length;t++){for(e=this.token.cells[t],n="",i=0;i<e.length;i++)n+=this.renderer.tablecell(this.inline.output(e[i]),{header:!1,align:this.token.align[i]});s+=this.renderer.tablerow(n)}return this.renderer.table(o,s);case"blockquote_start":for(var s="";"blockquote_end"!==this.next().type;)s+=this.tok();return this.renderer.blockquote(s);case"list_start":for(var s="",a=this.token.ordered;"list_end"!==this.next().type;)s+=this.tok();return this.renderer.list(s,a);case"list_item_start":for(var s="";"list_item_end"!==this.next().type;)s+="text"===this.token.type?this.parseText():this.tok();return this.renderer.listitem(s);case"loose_item_start":for(var s="";"list_item_end"!==this.next().type;)s+=this.tok();return this.renderer.listitem(s);case"html":var u=this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);return this.renderer.html(u);case"paragraph":return this.renderer.paragraph(this.inline.output(this.token.text));case"text":return this.renderer.paragraph(this.parseText())}},u.exec=u,c.options=c.setOptions=function(t){return h(c.defaults,t),c},c.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,sanitizer:null,mangle:!0,smartLists:!1,silent:!1,highlight:null,langPrefix:"lang-",smartypants:!1,headerPrefix:"",renderer:new r,xhtml:!1},c.Parser=i,c.parser=i.parse,c.Renderer=r,c.Lexer=e,c.lexer=e.lex,c.InlineLexer=n,c.inlineLexer=n.output,c.parse=c,t.exports=c}).call(function(){return this||window}())},function(t,e,n){!function(){return"undefined"==typeof Imba?(n(61),Imba.CLIENT=!0,n(53),n(62),n(64),n(57),n(54),n(56),n(60),n(58),n(55),n(59),n(63)):console.warn("Imba is already loaded")}()},function(t,e){!function(){function t(t,e,n){for(var r,i,o;(r=n)&&(n=n.next);)(i=n.listener)&&(o=n.path&&i[n.path]?e?i[n.path].apply(i,e):i[n.path]():e?i.apply(n,e):i.call(n)),n.times&&--n.times<=0&&(r.next=n.next,n.listener=null)}return Imba.listen=function(t,e,n,r){var i,o,s,a;return o=t.__listeners__||(t.__listeners__={}),s=o[i=e]||(o[i]={}),a=s.tail||(s.tail=s.next={}),a.listener=n,a.path=r,s.tail=a.next={},a},Imba.once=function(t,e,n){var r=Imba.listen(t,e,n);return r.times=1,r},Imba.unlisten=function(t,e,n,r){var i,o,s=t.__listeners__;if(s&&(i=s[e]))for(;(o=i)&&(i=i.next);)if(i==n||i.listener==n){o.next=i.next,i.listener=null;break}},Imba.emit=function(e,n,r){var i;(i=e.__listeners__)&&(i[n]&&t(n,r,i[n]),i.all&&t(n,[n,r],i.all))},Imba.observeProperty=function(t,e,n,r,i){return i&&"object"==typeof i&&Imba.unlisten(i,"all",t,n),r&&"object"==typeof r&&Imba.listen(r,"all",t,n),this}}()},function(t,e){!function(){function t(t){return t?t.toArray?t.toArray():t:[]}var e=window.getComputedStyle(document.documentElement,"");Imba.CSSKeyMap={};for(var n,r=0,i=t(e),o=i.length;o>r;r++){n=i[r];var s=n.replace(/^-(webkit|ms|moz|o|blink)-/,""),a=s.replace(/-(\w)/g,function(t,e){return e.toUpperCase()});n!=s&&e.hasOwnProperty(s)||(Imba.CSSKeyMap[s]=Imba.CSSKeyMap[a]=n)}return tag$.extendTag("htmlelement",function(t){t.prototype.css=function(t,e){if(t instanceof Object){for(var n=0,r=Object.keys(t),i=r.length;i>n;n++)this.css(r[n],t[r[n]]);return this}if(t=Imba.CSSKeyMap[t]||t,null==e)this.dom().style.removeProperty(t);else{if(void 0==e)return this.dom().style[t];("number"==typeof e||e instanceof Number)&&t.match(/width|height|left|right|top|bottom/)&&(e+="px"),this.dom().style[t]=e}return this}})}()},function(t,e){!function(){function t(t){return t?t.toArray?t.toArray():t:[]}var e=document,n=window,r=window&&void 0!==window.ontouchstart;Imba.Pointer=function(){return this.setButton(-1),this.setEvent({x:0,y:0,type:"uninitialized"}),this},Imba.Pointer.prototype.phase=function(t){return this._phase},Imba.Pointer.prototype.setPhase=function(t){return this._phase=t,this},Imba.Pointer.prototype.prevEvent=function(t){return this._prevEvent},Imba.Pointer.prototype.setPrevEvent=function(t){return this._prevEvent=t,this},Imba.Pointer.prototype.button=function(t){return this._button},Imba.Pointer.prototype.setButton=function(t){return this._button=t,this},Imba.Pointer.prototype.event=function(t){return this._event},Imba.Pointer.prototype.setEvent=function(t){return this._event=t,this},Imba.Pointer.prototype.dirty=function(t){return this._dirty},Imba.Pointer.prototype.setDirty=function(t){return this._dirty=t,this},Imba.Pointer.prototype.events=function(t){return this._events},Imba.Pointer.prototype.setEvents=function(t){return this._events=t,this},Imba.Pointer.prototype.touch=function(t){return this._touch},Imba.Pointer.prototype.setTouch=function(t){return this._touch=t,this},Imba.Pointer.prototype.update=function(t){return this.setEvent(t),this.setDirty(!0),this},Imba.Pointer.prototype.process=function(){var t=this.event();if(this.dirty())if(this.setPrevEvent(t),this.setDirty(!1),"mousedown"==t.type){if(this.setButton(t.button),2==this.button()||this.touch()&&0!=this.button())return;this.touch()&&this.touch().cancel(),this.setTouch(new Imba.Touch(t,this)),this.touch().mousedown(t,t)}else"mousemove"==t.type?this.touch()&&this.touch().mousemove(t,t):"mouseup"==t.type&&(this.setButton(-1),this.touch()&&this.touch().button()==t.button&&(this.touch().mouseup(t,t),this.setTouch(null)));else this.touch()&&this.touch().idle();return this},Imba.Pointer.prototype.cleanup=function(){return Imba.POINTERS},Imba.Pointer.prototype.x=function(){return this.event().x},Imba.Pointer.prototype.y=function(){return this.event().y},Imba.Pointer.update=function(){for(var e=0,r=t(Imba.POINTERS),i=r.length;i>e;e++)r[e].process();return n.requestAnimationFrame(Imba.Pointer.update),this};var i=0,o=50;Imba.Touch=function(t,e){return this.setEvent(t),this.setData({}),this.setActive(!0),this._button=t&&t.button||0,this._suppress=!1,this._captured=!1,this.setBubble(!1),e=e,this.setUpdates(0),this};var s=[],a=0,u={};return Imba.Touch.count=function(){return a},Imba.Touch.lookup=function(t){return t&&(t.__touch__||u[t.identifier])},Imba.Touch.release=function(t,e){var n,r;n=u[t.identifier],delete u[t.identifier],n,r=t.__touch__,delete t.__touch__,r},Imba.Touch.ontouchstart=function(e){for(var n,r=0,i=t(e.changedTouches),o=i.length;o>r;r++)if(n=i[r],!this.lookup(n)){var h=u[n.identifier]=new this(e);n.__touch__=h,s.push(h),a++,h.touchstart(e,n)}return this},Imba.Touch.ontouchmove=function(e){for(var n,r,i=0,o=t(e.changedTouches),s=o.length;s>i;i++)r=o[i],(n=this.lookup(r))&&n.touchmove(e,r);return this},Imba.Touch.ontouchend=function(e){for(var n,r,i=0,o=t(e.changedTouches),s=o.length;s>i;i++)r=o[i],(n=this.lookup(r))&&(n.touchend(e,r),this.release(r,n),a--);return this},Imba.Touch.ontouchcancel=function(e){for(var n,r,i=0,o=t(e.changedTouches),s=o.length;s>i;i++)r=o[i],(n=this.lookup(r))&&(n.touchcancel(e,r),this.release(r,n),a--);return this},Imba.Touch.onmousedown=function(t){return this},Imba.Touch.onmousemove=function(t){return this},Imba.Touch.onmouseup=function(t){return this},Imba.Touch.prototype.phase=function(t){return this._phase},Imba.Touch.prototype.setPhase=function(t){return this._phase=t,this},Imba.Touch.prototype.active=function(t){return this._active},Imba.Touch.prototype.setActive=function(t){return this._active=t,this},Imba.Touch.prototype.event=function(t){return this._event},Imba.Touch.prototype.setEvent=function(t){return this._event=t,this},Imba.Touch.prototype.pointer=function(t){return this._pointer},Imba.Touch.prototype.setPointer=function(t){return this._pointer=t,this},Imba.Touch.prototype.target=function(t){return this._target},Imba.Touch.prototype.setTarget=function(t){return this._target=t,this},Imba.Touch.prototype.handler=function(t){return this._handler},Imba.Touch.prototype.setHandler=function(t){return this._handler=t,this},Imba.Touch.prototype.updates=function(t){return this._updates},Imba.Touch.prototype.setUpdates=function(t){return this._updates=t,this},Imba.Touch.prototype.suppress=function(t){return this._suppress},Imba.Touch.prototype.setSuppress=function(t){return this._suppress=t,this},Imba.Touch.prototype.data=function(t){return this._data},Imba.Touch.prototype.setData=function(t){return this._data=t,this},Imba.Touch.prototype.__bubble={chainable:!0,name:"bubble"},Imba.Touch.prototype.bubble=function(t){return void 0!==t?(this.setBubble(t),this):this._bubble},Imba.Touch.prototype.setBubble=function(t){return this._bubble=t,this},Imba.Touch.prototype.gestures=function(t){return this._gestures},Imba.Touch.prototype.setGestures=function(t){return this._gestures=t,this},Imba.Touch.prototype.capture=function(){return this._captured=!0,this._event&&this._event.preventDefault(),this},Imba.Touch.prototype.isCaptured=function(){return!!this._captured},Imba.Touch.prototype.extend=function(t){return this._gestures||(this._gestures=[]),this._gestures.push(t),this},Imba.Touch.prototype.redirect=function(t){return this._redirect=t,this},Imba.Touch.prototype.suppress=function(){return this._active=!1,this},Imba.Touch.prototype.setSuppress=function(t){return console.warn("Imba.Touch#suppress= is deprecated"),this._supress=t,this},Imba.Touch.prototype.touchstart=function(t,e){return this._event=t,this._touch=e,this._button=0,this._x=e.clientX,this._y=e.clientY,this.began(),t&&this.isCaptured()&&t.preventDefault(),this},Imba.Touch.prototype.touchmove=function(t,e){return this._event=t,this._x=e.clientX,this._y=e.clientY,this.update(),t&&this.isCaptured()&&t.preventDefault(),this},Imba.Touch.prototype.touchend=function(t,e){if(this._event=t,this._x=e.clientX,this._y=e.clientY,this.ended(),i=t.timeStamp,this._maxdr<20){var n=new Imba.Event(t);n.setType("tap"),n.process(),n._responder&&t.preventDefault()}return t&&this.isCaptured()&&t.preventDefault(),this},Imba.Touch.prototype.touchcancel=function(t,e){return this.cancel()},Imba.Touch.prototype.mousedown=function(t,n){var r=this;return r._event=t,r._button=t.button,r._x=n.clientX,r._y=n.clientY,r.began(),r._mousemove=function(t){return r.mousemove(t,t)},e.addEventListener("mousemove",r._mousemove,!0),r},Imba.Touch.prototype.mousemove=function(t,e){return this._x=e.clientX,this._y=e.clientY,this._event=t,this.isCaptured()&&t.preventDefault(),this.update(),this.move(),this},Imba.Touch.prototype.mouseup=function(t,n){return this._x=n.clientX,this._y=n.clientY,this.ended(),e.removeEventListener("mousemove",this._mousemove,!0),this._mousemove=null,this},Imba.Touch.prototype.idle=function(){return this.update()},Imba.Touch.prototype.began=function(){this._maxdr=this._dr=0,this._x0=this._x,this._y0=this._y;var t=this.event().target,e=null;for(this._sourceTarget=t&&tag$wrap(t);t&&(e=tag$wrap(t),!e||!e.ontouchstart||(this._bubble=!1,this.setTarget(e),this.target().ontouchstart(this),this._bubble));)t=t.parentNode;return this._updates++,this},Imba.Touch.prototype.update=function(){var e;if(!this._active)return this;var n=Math.sqrt(this.dx()*this.dx()+this.dy()*this.dy());if(n>this._dr&&(this._maxdr=n),this._dr=n,this._redirect&&(this._target&&this._target.ontouchcancel&&this._target.ontouchcancel(this),this.setTarget(this._redirect),this._redirect=null,this.target().ontouchstart&&this.target().ontouchstart(this)),this._updates++,this._gestures)for(var r=0,i=t(this._gestures),o=i.length;o>r;r++)i[r].ontouchupdate(this);return(e=this.target())&&e.ontouchupdate&&e.ontouchupdate(this),this},Imba.Touch.prototype.move=function(){var e;if(!this._active)return this;if(this._gestures)for(var n,r=0,i=t(this._gestures),o=i.length;o>r;r++)n=i[r],n.ontouchmove&&n.ontouchmove(this,this._event);return(e=this.target())&&e.ontouchmove&&e.ontouchmove(this,this._event),this},Imba.Touch.prototype.ended=function(){var e;if(!this._active)return this;if(this._updates++,this._gestures)for(var n=0,r=t(this._gestures),i=r.length;i>n;n++)r[n].ontouchend(this);return(e=this.target())&&e.ontouchend&&e.ontouchend(this),this},Imba.Touch.prototype.cancel=function(){return this._cancelled||(this._cancelled=!0,this.cancelled(),this._mousemove&&e.removeEventListener("mousemove",this._mousemove,!0)),this},Imba.Touch.prototype.cancelled=function(){var e;if(!this._active)return this;if(this._cancelled=!0,this._updates++,this._gestures)for(var n,r=0,i=t(this._gestures),o=i.length;o>r;r++)n=i[r],n.ontouchcancel&&n.ontouchcancel(this);return(e=this.target())&&e.ontouchcancel&&e.ontouchcancel(this),this},Imba.Touch.prototype.dr=function(){return this._dr},Imba.Touch.prototype.dx=function(){return this._x-this._x0},Imba.Touch.prototype.dy=function(){return this._y-this._y0},Imba.Touch.prototype.x0=function(){return this._x0},Imba.Touch.prototype.y0=function(){return this._y0},Imba.Touch.prototype.x=function(){return this._x},Imba.Touch.prototype.y=function(){return this._y},Imba.Touch.prototype.tx=function(){return this._targetBox||(this._targetBox=this._target.dom().getBoundingClientRect()),this._x-this._targetBox.left},Imba.Touch.prototype.ty=function(){return this._targetBox||(this._targetBox=this._target.dom().getBoundingClientRect()),this._y-this._targetBox.top},Imba.Touch.prototype.button=function(){return this._button},Imba.Touch.prototype.sourceTarget=function(){return this._sourceTarget},Imba.TouchGesture=function(){},Imba.TouchGesture.prototype.__active={"default":!1,name:"active"},Imba.TouchGesture.prototype.active=function(t){return this._active},Imba.TouchGesture.prototype.setActive=function(t){return this._active=t,this},Imba.TouchGesture.prototype._active=!1,Imba.TouchGesture.prototype.ontouchstart=function(t){return this},Imba.TouchGesture.prototype.ontouchupdate=function(t){return this},Imba.TouchGesture.prototype.ontouchend=function(t){return this},Imba.POINTER=new Imba.Pointer,Imba.POINTERS=[Imba.POINTER],Imba.KEYMAP={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"break",20:"caps",27:"esc",32:"space",35:"end",36:"home",37:"larr",38:"uarr",39:"rarr",40:"darr",45:"insert",46:"delete",107:"plus",106:"mult",91:"meta"},Imba.CHARMAP={"%":"modulo","*":"multiply","+":"add","-":"sub","/":"divide",".":"dot"},Imba.Event=function(t){this.setEvent(t),this.setBubble(!0)},Imba.Event.prototype.event=function(t){return this._event},Imba.Event.prototype.setEvent=function(t){return this._event=t,this},Imba.Event.prototype.prefix=function(t){return this._prefix},Imba.Event.prototype.setPrefix=function(t){return this._prefix=t,this},Imba.Event.prototype.data=function(t){return this._data},Imba.Event.prototype.setData=function(t){return this._data=t,this},Imba.Event.prototype.source=function(t){return this._source},Imba.Event.prototype.setSource=function(t){return this._source=t,this},Imba.Event.prototype.__bubble={type:Boolean,chainable:!0,name:"bubble"},Imba.Event.prototype.bubble=function(t){return void 0!==t?(this.setBubble(t),this):this._bubble},Imba.Event.prototype.setBubble=function(t){
return this._bubble=t,this},Imba.Event.wrap=function(t){return new this(t)},Imba.Event.prototype.setType=function(t){return this._type=t,this},Imba.Event.prototype.type=function(){return this._type||this.event().type},Imba.Event.prototype.name=function(){return this._name||(this._name=this.type().toLowerCase().replace(/\:/g,""))},Imba.Event.prototype.bubble=function(t){return void 0!=t?(this.setBubble(t),this):this._bubble},Imba.Event.prototype.halt=function(){return this.setBubble(!1),this},Imba.Event.prototype.cancel=function(){return this.event().preventDefault&&this.event().preventDefault(),this._cancel=!0,this},Imba.Event.prototype.isPrevented=function(){return this.event()&&this.event().defaultPrevented||this._cancel},Imba.Event.prototype.target=function(){return tag$wrap(this.event()._target||this.event().target)},Imba.Event.prototype.responder=function(){return this._responder},Imba.Event.prototype.redirect=function(t){return this._redirect=t,this},Imba.Event.prototype.keychar=function(){if(this.event()instanceof TextEvent)return this.event().data;if(this.event()instanceof KeyboardEvent){var t=this.event().keyIdentifier,e=Imba.KEYMAP[this.event().keyCode];return e||"U+"!=t.substr(0,2)||(e=String.fromCharCode(parseInt(t.substr(2),16))),e}return null},Imba.Event.prototype.keycombo=function(){var t;if(t=this.keychar()){t=Imba.CHARMAP[t]||t;var e=[],n=this.event();return n.ctrlKey&&e.push("ctrl"),n.shiftKey&&e.push("shift"),n.altKey&&e.push("alt"),n.metaKey&&e.push("cmd"),e.push(t),e.join("_").toLowerCase()}},Imba.Event.prototype.process=function(){for(var t,e,n="on"+(this._prefix||"")+this.name(),r=null,i=this.event()._target||this.event().target,o=i._responder||i;o;){if(this._redirect=null,t=tag$wrap(o)){if("string"==typeof t[e=n]||t[e]instanceof String){n=t[n];continue}if(t[n]instanceof Array){r=t[n].concat(t),n=r.shift();continue}t[n]instanceof Function&&(this._responder||(this._responder=t),r?t[n].apply(t,r):t[n](this,this.data()))}if(!this.bubble()||!(o=this._redirect||(t?t.parent():o.parentNode)))break}return this.processed(),this},Imba.Event.prototype.processed=function(){return Imba.emit(Imba,"event",[this]),this},Imba.Event.prototype.x=function(){return this.event().x},Imba.Event.prototype.y=function(){return this.event().y},Imba.Event.prototype.which=function(){return this.event().which},Imba.EventManager=function(e,n){var r=this;n&&n.constructor===Object||(n={});var i=void 0!==n.events?n.events:[];r.setRoot(e),r.setCount(0),r.setListeners([]),r.setDelegators({}),r.setDelegator(function(t){return r.delegate(t),!0});for(var o=0,s=t(i),a=s.length;a>o;o++)r.register(s[o]);return r},Imba.EventManager.prototype.root=function(t){return this._root},Imba.EventManager.prototype.setRoot=function(t){return this._root=t,this},Imba.EventManager.prototype.count=function(t){return this._count},Imba.EventManager.prototype.setCount=function(t){return this._count=t,this},Imba.EventManager.prototype.__enabled={"default":!1,watch:"enabledDidSet",name:"enabled"},Imba.EventManager.prototype.enabled=function(t){return this._enabled},Imba.EventManager.prototype.setEnabled=function(t){var e=this.enabled();return t!=e&&(this._enabled=t),t!=e&&this.enabledDidSet&&this.enabledDidSet(t,e,this.__enabled),this},Imba.EventManager.prototype._enabled=!1,Imba.EventManager.prototype.listeners=function(t){return this._listeners},Imba.EventManager.prototype.setListeners=function(t){return this._listeners=t,this},Imba.EventManager.prototype.delegators=function(t){return this._delegators},Imba.EventManager.prototype.setDelegators=function(t){return this._delegators=t,this},Imba.EventManager.prototype.delegator=function(t){return this._delegator},Imba.EventManager.prototype.setDelegator=function(t){return this._delegator=t,this},Imba.EventManager.prototype.enabledDidSet=function(t){return t?this.onenable():this.ondisable(),this},Imba.EventManager.prototype.register=function(e,n){if(void 0===n&&(n=!0),e instanceof Array){for(var r=0,i=t(e),o=i.length;o>r;r++)this.register(i[r],n);return this}if(this.delegators()[e])return this;var s=this.delegators()[e]=n instanceof Function?n:this.delegator();return this.enabled()?this.root().addEventListener(e,s,!0):void 0},Imba.EventManager.prototype.listen=function(t,e,n){return void 0===n&&(n=!0),this.listeners().push([t,e,n]),this.enabled()&&this.root().addEventListener(t,e,n),this},Imba.EventManager.prototype.delegate=function(t){this.setCount(this.count()+1);var e=Imba.Event.wrap(t);return e.process(),this},Imba.EventManager.prototype.create=function(t,e,n){n&&n.constructor===Object||(n={});var r=void 0!==n.data?n.data:null,i=void 0!==n.source?n.source:null,o=Imba.Event.wrap({type:t,target:e});return r&&(o.setData(r),r),i&&(o.setSource(i),i),o},Imba.EventManager.prototype.trigger=function(){return this.create.apply(this,arguments).process()},Imba.EventManager.prototype.onenable=function(){for(var e=this.delegators(),n=0,r=Object.keys(e),i=r.length;i>n;n++)this.root().addEventListener(r[n],e[r[n]],!0);for(var o,n=0,s=t(this.listeners()),a=s.length;a>n;n++)o=s[n],this.root().addEventListener(o[0],o[1],o[2]);return this},Imba.EventManager.prototype.ondisable=function(){for(var e=this.delegators(),n=0,r=Object.keys(e),i=r.length;i>n;n++)this.root().removeEventListener(r[n],e[r[n]],!0);for(var o,n=0,s=t(this.listeners()),a=s.length;a>n;n++)o=s[n],this.root().removeEventListener(o[0],o[1],o[2]);return this},ED=Imba.Events=new Imba.EventManager(document,{events:["keydown","keyup","keypress","textInput","input","change","submit","focusin","focusout","blur","contextmenu","dblclick","mousewheel","wheel"]}),r&&(Imba.Events.listen("touchstart",function(t){var e,n;return(e=Imba.Events).setCount(n=e.count()+1),Imba.Touch.ontouchstart(t)}),Imba.Events.listen("touchmove",function(t){var e,n;return(e=Imba.Events).setCount(n=e.count()+1),Imba.Touch.ontouchmove(t)}),Imba.Events.listen("touchend",function(t){var e,n;return(e=Imba.Events).setCount(n=e.count()+1),Imba.Touch.ontouchend(t)}),Imba.Events.listen("touchcancel",function(t){var e,n;return(e=Imba.Events).setCount(n=e.count()+1),Imba.Touch.ontouchcancel(t)})),Imba.Events.register("click",function(t){if(t.timeStamp-i>o){var e=new Imba.Event(t);if(e.setType("tap"),e.process(),e._responder)return t.preventDefault()}return Imba.Events.delegate(t)}),Imba.Events.listen("mousedown",function(t){return t.timeStamp-i>o&&Imba.POINTER?Imba.POINTER.update(t).process():void 0}),Imba.Events.listen("mouseup",function(t){return t.timeStamp-i>o&&Imba.POINTER?Imba.POINTER.update(t).process():void 0}),Imba.Events.register(["mousedown","mouseup"]),Imba.Events.setEnabled(!0),!0}()},function(t,e){!function(){return tag$.defineTag("fragment","htmlelement",function(t){t.createNode=function(){return Imba.document().createDocumentFragment()}}),tag$.defineTag("a",function(t){t.prototype.href=function(t){return this.getAttribute("href")},t.prototype.setHref=function(t){return this.setAttribute("href",t),this}}),tag$.defineTag("abbr"),tag$.defineTag("address"),tag$.defineTag("area"),tag$.defineTag("article"),tag$.defineTag("aside"),tag$.defineTag("audio"),tag$.defineTag("b"),tag$.defineTag("base"),tag$.defineTag("bdi"),tag$.defineTag("bdo"),tag$.defineTag("big"),tag$.defineTag("blockquote"),tag$.defineTag("body"),tag$.defineTag("br"),tag$.defineTag("button",function(t){t.prototype.autofocus=function(t){return this.getAttribute("autofocus")},t.prototype.setAutofocus=function(t){return this.setAttribute("autofocus",t),this},t.prototype.type=function(t){return this.getAttribute("type")},t.prototype.setType=function(t){return this.setAttribute("type",t),this},t.prototype.disabled=function(t){return this.getAttribute("disabled")},t.prototype.setDisabled=function(t){return this.setAttribute("disabled",t),this}}),tag$.defineTag("canvas",function(t){t.prototype.setWidth=function(t){return this.width()!=t&&(this.dom().width=t),this},t.prototype.setHeight=function(t){return this.height()!=t&&(this.dom().height=t),this},t.prototype.width=function(){return this.dom().width},t.prototype.height=function(){return this.dom().height},t.prototype.context=function(t){return void 0===t&&(t="2d"),this.dom().getContext(t)}}),tag$.defineTag("caption"),tag$.defineTag("cite"),tag$.defineTag("code"),tag$.defineTag("col"),tag$.defineTag("colgroup"),tag$.defineTag("data"),tag$.defineTag("datalist"),tag$.defineTag("dd"),tag$.defineTag("del"),tag$.defineTag("details"),tag$.defineTag("dfn"),tag$.defineTag("div"),tag$.defineTag("dl"),tag$.defineTag("dt"),tag$.defineTag("em"),tag$.defineTag("embed"),tag$.defineTag("fieldset"),tag$.defineTag("figcaption"),tag$.defineTag("figure"),tag$.defineTag("footer"),tag$.defineTag("form",function(t){t.prototype.method=function(t){return this.getAttribute("method")},t.prototype.setMethod=function(t){return this.setAttribute("method",t),this},t.prototype.action=function(t){return this.getAttribute("action")},t.prototype.setAction=function(t){return this.setAttribute("action",t),this}}),tag$.defineTag("h1"),tag$.defineTag("h2"),tag$.defineTag("h3"),tag$.defineTag("h4"),tag$.defineTag("h5"),tag$.defineTag("h6"),tag$.defineTag("head"),tag$.defineTag("header"),tag$.defineTag("hr"),tag$.defineTag("html"),tag$.defineTag("i"),tag$.defineTag("iframe",function(t){t.prototype.src=function(t){return this.getAttribute("src")},t.prototype.setSrc=function(t){return this.setAttribute("src",t),this}}),tag$.defineTag("img",function(t){t.prototype.src=function(t){return this.getAttribute("src")},t.prototype.setSrc=function(t){return this.setAttribute("src",t),this}}),tag$.defineTag("input",function(t){t.prototype.name=function(t){return this.getAttribute("name")},t.prototype.setName=function(t){return this.setAttribute("name",t),this},t.prototype.type=function(t){return this.getAttribute("type")},t.prototype.setType=function(t){return this.setAttribute("type",t),this},t.prototype.required=function(t){return this.getAttribute("required")},t.prototype.setRequired=function(t){return this.setAttribute("required",t),this},t.prototype.disabled=function(t){return this.getAttribute("disabled")},t.prototype.setDisabled=function(t){return this.setAttribute("disabled",t),this},t.prototype.autofocus=function(t){return this.getAttribute("autofocus")},t.prototype.setAutofocus=function(t){return this.setAttribute("autofocus",t),this},t.prototype.value=function(){return this.dom().value},t.prototype.setValue=function(t){return t!=this.dom().value&&(this.dom().value=t),this},t.prototype.setPlaceholder=function(t){return t!=this.dom().placeholder&&(this.dom().placeholder=t),this},t.prototype.placeholder=function(){return this.dom().placeholder},t.prototype.checked=function(){return this.dom().checked},t.prototype.setChecked=function(t){return t!=this.dom().checked&&(this.dom().checked=t),this}}),tag$.defineTag("ins"),tag$.defineTag("kbd"),tag$.defineTag("keygen"),tag$.defineTag("label"),tag$.defineTag("legend"),tag$.defineTag("li"),tag$.defineTag("link",function(t){t.prototype.rel=function(t){return this.getAttribute("rel")},t.prototype.setRel=function(t){return this.setAttribute("rel",t),this},t.prototype.type=function(t){return this.getAttribute("type")},t.prototype.setType=function(t){return this.setAttribute("type",t),this},t.prototype.href=function(t){return this.getAttribute("href")},t.prototype.setHref=function(t){return this.setAttribute("href",t),this},t.prototype.media=function(t){return this.getAttribute("media")},t.prototype.setMedia=function(t){return this.setAttribute("media",t),this}}),tag$.defineTag("main"),tag$.defineTag("map"),tag$.defineTag("mark"),tag$.defineTag("menu"),tag$.defineTag("menuitem"),tag$.defineTag("meta",function(t){t.prototype.name=function(t){return this.getAttribute("name")},t.prototype.setName=function(t){return this.setAttribute("name",t),this},t.prototype.content=function(t){return this.getAttribute("content")},t.prototype.setContent=function(t){return this.setAttribute("content",t),this},t.prototype.charset=function(t){return this.getAttribute("charset")},t.prototype.setCharset=function(t){return this.setAttribute("charset",t),this}}),tag$.defineTag("meter"),tag$.defineTag("nav"),tag$.defineTag("noscript"),tag$.defineTag("object"),tag$.defineTag("ol"),tag$.defineTag("optgroup"),tag$.defineTag("option",function(t){t.prototype.value=function(t){return this.getAttribute("value")},t.prototype.setValue=function(t){return this.setAttribute("value",t),this}}),tag$.defineTag("output"),tag$.defineTag("p"),tag$.defineTag("param"),tag$.defineTag("pre"),tag$.defineTag("progress"),tag$.defineTag("q"),tag$.defineTag("rp"),tag$.defineTag("rt"),tag$.defineTag("ruby"),tag$.defineTag("s"),tag$.defineTag("samp"),tag$.defineTag("script",function(t){t.prototype.src=function(t){return this.getAttribute("src")},t.prototype.setSrc=function(t){return this.setAttribute("src",t),this},t.prototype.type=function(t){return this.getAttribute("type")},t.prototype.setType=function(t){return this.setAttribute("type",t),this},t.prototype.async=function(t){return this.getAttribute("async")},t.prototype.setAsync=function(t){return this.setAttribute("async",t),this},t.prototype.defer=function(t){return this.getAttribute("defer")},t.prototype.setDefer=function(t){return this.setAttribute("defer",t),this}}),tag$.defineTag("section"),tag$.defineTag("select",function(t){t.prototype.name=function(t){return this.getAttribute("name")},t.prototype.setName=function(t){return this.setAttribute("name",t),this},t.prototype.multiple=function(t){return this.getAttribute("multiple")},t.prototype.setMultiple=function(t){return this.setAttribute("multiple",t),this},t.prototype.required=function(t){return this.getAttribute("required")},t.prototype.setRequired=function(t){return this.setAttribute("required",t),this},t.prototype.disabled=function(t){return this.getAttribute("disabled")},t.prototype.setDisabled=function(t){return this.setAttribute("disabled",t),this},t.prototype.value=function(){return this.dom().value},t.prototype.setValue=function(t){return t!=this.dom().value&&(this.dom().value=t),this}}),tag$.defineTag("small"),tag$.defineTag("source"),tag$.defineTag("span"),tag$.defineTag("strong"),tag$.defineTag("style"),tag$.defineTag("sub"),tag$.defineTag("summary"),tag$.defineTag("sup"),tag$.defineTag("table"),tag$.defineTag("tbody"),tag$.defineTag("td"),tag$.defineTag("textarea",function(t){t.prototype.name=function(t){return this.getAttribute("name")},t.prototype.setName=function(t){return this.setAttribute("name",t),this},t.prototype.disabled=function(t){return this.getAttribute("disabled")},t.prototype.setDisabled=function(t){return this.setAttribute("disabled",t),this},t.prototype.required=function(t){return this.getAttribute("required")},t.prototype.setRequired=function(t){return this.setAttribute("required",t),this},t.prototype.rows=function(t){return this.getAttribute("rows")},t.prototype.setRows=function(t){return this.setAttribute("rows",t),this},t.prototype.cols=function(t){return this.getAttribute("cols")},t.prototype.setCols=function(t){return this.setAttribute("cols",t),this},t.prototype.autofocus=function(t){return this.getAttribute("autofocus")},t.prototype.setAutofocus=function(t){return this.setAttribute("autofocus",t),this},t.prototype.value=function(){return this.dom().value},t.prototype.setValue=function(t){return t!=this.dom().value&&(this.dom().value=t),this},t.prototype.setPlaceholder=function(t){return t!=this.dom().placeholder&&(this.dom().placeholder=t),this},t.prototype.placeholder=function(){return this.dom().placeholder}}),tag$.defineTag("tfoot"),tag$.defineTag("th"),tag$.defineTag("thead"),tag$.defineTag("time"),tag$.defineTag("title"),tag$.defineTag("tr"),tag$.defineTag("track"),tag$.defineTag("u"),tag$.defineTag("ul"),tag$.defineTag("video"),tag$.defineTag("wbr")}()},function(t,e){!function(){function t(t){return t?t.toArray?t.toArray():t:[]}return Imba.document=function(){return window.document},Imba.root=function(){return tag$wrap(Imba.document().body)},tag$.defineTag("htmlelement","element",function(e){e.inherit=function(t){if(t.prototype._empty=!0,t._protoDom=null,!this._nodeType)return t._nodeType=t._name,t._classes=[];t._nodeType=this._nodeType;var e="_"+t._name.replace(/_/g,"-");return"#"!=t._name[0]?t._classes=this._classes.concat(e):void 0},e.buildNode=function(){var t=Imba.document().createElement(this._nodeType),e=this._classes.join(" ");return e&&(t.className=e),t},e.createNode=function(){var t=this._protoDom||(this._protoDom=this.buildNode());return t.cloneNode(!1)},e.dom=function(){return this._protoDom||(this._protoDom=this.buildNode())},e.prototype.id=function(t){return this.getAttribute("id")},e.prototype.setId=function(t){return this.setAttribute("id",t),this},e.prototype.tabindex=function(t){return this.getAttribute("tabindex")},e.prototype.setTabindex=function(t){return this.setAttribute("tabindex",t),this},e.prototype.title=function(t){return this.getAttribute("title")},e.prototype.setTitle=function(t){return this.setAttribute("title",t),this},e.prototype.role=function(t){return this.getAttribute("role")},e.prototype.setRole=function(t){return this.setAttribute("role",t),this},e.prototype.width=function(){return this._dom.offsetWidth},e.prototype.height=function(){return this._dom.offsetHeight},e.prototype.setChildren=function(t,e){return this._empty?this.append(t):this.empty().append(t),this._children=null,this},e.prototype.setHtml=function(t){return this._dom.innerHTML=t,this},e.prototype.html=function(){return this._dom.innerHTML},e.prototype.empty=function(){for(;this._dom.firstChild;)this._dom.removeChild(this._dom.firstChild);return this._children=null,this._empty=!0,this},e.prototype.remove=function(t){var e=this.dom(),n=t&&t.dom();return n&&n.parentNode==e&&e.removeChild(n),this},e.prototype.emit=function(t,e){e&&e.constructor===Object||(e={});var n=void 0!==e.data?e.data:null,r=void 0!==e.bubble?e.bubble:!0;return Imba.Events.trigger(t,this,{data:n,bubble:r}),this},e.prototype.css=function(t,e){if(t instanceof Object)for(var n=0,r=Object.keys(t),i=r.length;i>n;n++)this.css(r[n],t[r[n]]);else if(null==e)this.dom().style.removeProperty(t);else{if(void 0==e)return this.dom().style[t];("number"==typeof e||e instanceof Number)&&t.match(/width|height|left|right|top|bottom/)&&(e+="px"),this.dom().style[t]=e}return this},e.prototype.dataset=function(e,n){if(e instanceof Object){for(var r=0,i=Object.keys(e),o=i.length;o>r;r++)this.dataset(i[r],e[i[r]]);return this}if(2==arguments.length)return this.setAttribute("data-"+e,n),this;if(e)return this.getAttribute("data-"+e);var s=this.dom().dataset;if(!s){s={};for(var a,r=0,u=t(this.dom().attributes),h=u.length;h>r;r++)a=u[r],"data-"==a.name.substr(0,5)&&(s[Imba.toCamelCase(a.name.slice(5))]=a.value)}return s},e.prototype.find=function(t){return new Imba.Selector(t,this)},e.prototype.first=function(t){return t?this.find(t).first():tag$wrap(this.dom().firstElementChild)},e.prototype.last=function(t){return t?this.find(t).last():tag$wrap(this.dom().lastElementChild)},e.prototype.child=function(t){return tag$wrap(this.dom().children[t||0])},e.prototype.children=function(t){var e=new Imba.Selector(null,this,this._dom.children);return t?e.filter(t):e},e.prototype.orphanize=function(){var t;return(t=this.dom().parentNode)&&t.removeChild(this._dom),this},e.prototype.matches=function(t){var e;return t instanceof Function?t(this):(t.query&&(t=t.query()),(e=this._dom.webkitMatchesSelector||this._dom.matches)?e.call(this._dom,t):void 0)},e.prototype.closest=function(t){if(!t)return this.parent();var e=this;for(t.query&&(t=t.query());e;){if(e.matches(t))return e;e=e.parent()}return null},e.prototype.up=function(t){return t?this.parent()&&this.parent().closest(t):this.parent()},e.prototype.path=function(t){var e=this,n=[];for(t&&t.query&&(t=t.query());e;)(!t||e.matches(t))&&n.push(e),e=e.parent();return n},e.prototype.parents=function(t){var e=this.parent();return e?e.path(t):[]},e.prototype.siblings=function(t){var e,n=this;if(!(e=this.parent()))return[];var r=this.dom().parentNode.children,i=new Imba.Selector(null,this,r);return i.filter(function(e){return e!=n&&(!t||e.matches(t))})},e.prototype.next=function(t){if(t){for(var e=this;e=e.next();)if(e.matches(t))return e;return null}return tag$wrap(this.dom().nextElementSibling)},e.prototype.prev=function(t){if(t){for(var e=this;e=e.prev();)if(e.matches(t))return e;return null}return tag$wrap(this.dom().previousElementSibling)},e.prototype.contains=function(t){return this.dom().contains(t&&t._dom||t)},e.prototype.index=function(){for(var t=0,e=this.dom();e.previousSibling;)e=e.previousSibling,t++;return t},e.prototype.insert=function(t,e){e&&e.constructor===Object||(e={});var n=void 0!==e.before?e.before:null,r=void 0!==e.after?e.after:null;return r&&(n=r.next()),t instanceof Array&&(t=tag$.$fragment().setContent(t,0).end()),n?this.dom().insertBefore(t.dom(),n.dom()):this.append(t),this},e.prototype.focus=function(){return this.dom().focus(),this},e.prototype.blur=function(){return this.dom().blur(),this},e.prototype.template=function(){return null},e.prototype.prepend=function(t){var e=this._dom.childNodes[0];return e?this.insertBefore(t,e):this.appendChild(t),this},e.prototype.append=function(e){if(!e)return this;if(e instanceof Array)for(var n,r=0,i=t(e),o=i.length;o>r;r++)n=i[r],n&&this.append(n);else if("string"==typeof e||e instanceof String||"number"==typeof e||e instanceof Number){var s=Imba.document().createTextNode(e);this._dom.appendChild(s),this._empty&&(this._empty=!1)}else this._dom.appendChild(e._dom||e),this._empty&&(this._empty=!1);return this},e.prototype.insertBefore=function(t,e){return("string"==typeof t||t instanceof String)&&(t=Imba.document().createTextNode(t)),t&&e&&this.dom().insertBefore(t._dom||t,e._dom||e),this},e.prototype.appendChild=function(t){return("string"==typeof t||t instanceof String)&&(t=Imba.document().createTextNode(t)),t&&this.dom().appendChild(t._dom||t),this},e.prototype.removeChild=function(t){return t&&this.dom().removeChild(t._dom||t),this},e.prototype.toString=function(){return this._dom.toString()},e.prototype.classes=function(){return console.log("Imba.Tag#classes is deprecated"),this._dom.classList}}),tag$.defineTag("svgelement","htmlelement")}()},function(t,e){!function(){return document.documentElement.classList?void 0:(tag$.extendTag("htmlelement",function(t){t.prototype.hasFlag=function(t){return new RegExp("(^|\\s)"+t+"(\\s|$)").test(this._dom.className)},t.prototype.addFlag=function(t){return this.hasFlag(t)?this:(this._dom.className+=(this._dom.className?" ":"")+t,this)},t.prototype.unflag=function(t){if(!this.hasFlag(t))return this;var e=new RegExp("(^|\\s)*"+t+"(\\s|$)*","g");return this._dom.className=this._dom.className.replace(e,""),this},t.prototype.toggleFlag=function(t){return this.hasFlag(t)?this.unflag(t):this.flag(t)},t.prototype.flag=function(t,e){return 2==arguments.length&&!!e==!1?this.unflag(t):this.addFlag(t)}}),!0)}()},function(t,e){!function(){function t(t){return t?t.toArray?t.toArray():t:[]}function e(n,r,i){if(r instanceof u)n.removeChild(r);else if(r instanceof Array)for(var o=0,s=t(r),a=s.length;a>o;o++)e(n,s[o],i);else{var h=i?i.nextSibling:n._dom.firstChild;if(!(h instanceof Text&&h.textContent==r))throw"cannot remove string";n.removeChild(h)}return i}function n(e,r){if(r instanceof u)e.appendChild(r);else if(r instanceof Array)for(var i=0,o=t(r),s=o.length;s>i;i++)n(e,o[i]);else null!=r&&r!==!1&&e.appendChild(Imba.document().createTextNode(r))}function r(e,n,i){if(n instanceof u)e.insertBefore(n,i);else if(n instanceof Array)for(var o=0,s=t(n),a=s.length;a>o;o++)r(e,s[o],i);else null!=n&&n!==!1&&e.insertBefore(Imba.document().createTextNode(n),i);return i}function i(t,e,i){var o=i?i.nextSibling:t._dom.firstChild;return o?(r(t,e,o),o.previousSibling):(n(t,e),t._dom.lastChild)}function o(e,n,r,o){for(var s,a=n.length,u=n[a-1],h=[],c=[],p=[],l=0,f=0,d=0,g=t(r),m=g.length;m>d;d++){s=g[d];var y=n.indexOf(s);if(h.push(y),-1!=y){for(var _=h.length-2;_>=0;)if(-1==h[_])_--;else{if(y>h[_])break;_=c[_]}c.push(_);var v=-1==_?0:p[_]+1;v>l&&(l=v,f=d),p.push(v)}else e.removeChild(s),c.push(-1),p.push(-1)}for(var b=[],T=h.length-1;T>=0;)T==f&&-1!=h[T]&&(b[h[T]]=!0,f=c[f]),T-=1;for(var $=0,g=t(n),m=g.length;m>$;$++)if(!b[$]){var I=n[$-1];i(e,g[$],I&&I._dom||o)}return u&&u._dom||o}function s(t,e,n,r){var i=e.length,s=i,a=e[i-1];if(i==n.length&&e[0]===n[0])for(;s--&&e[s]===n[s];);return-1==s?a&&a._dom||r:o(t,e,n,r)}function a(n,r,o,h){var c=null==r||r===!1,p=null==o||o===!1;if(r===o)return c?h:r&&r._dom?r._dom:h?h.nextSibling:n._dom.firstChild;if(r instanceof Array){if(o instanceof Array){if(!r["static"]&&!o["static"])return s(n,r,o,h);if(r["static"]==o["static"]){for(var l=0,f=t(r),d=f.length;d>l;l++)h=a(n,f[l],o[l],h);return h}e(n,o,h)}else o instanceof u?n.removeChild(o):p||n.removeChild(h?h.nextSibling:n._dom.firstChild);return i(n,r,h)}if(r instanceof u)return p||e(n,o,h),i(n,r,h),r;if(c)return p||e(n,o,h),h;var g;if(o instanceof Array)e(n,o,h);else if(o instanceof u)n.removeChild(o);else if(!p&&(g=h?h.nextSibling:n._dom.firstChild,g instanceof Text&&g.textContent!=r))return g.textContent=r,g;return i(n,r,h)}var u=Imba.TAGS.element;return tag$.extendTag("htmlelement",function(e){e.prototype.setChildren=function(e,r){var i=this._children;if(e===i)return this;if(i){if(2==r)return this;if(1==r)for(var o=null,h=0,c=t(e),p=c.length;p>h;h++)o=a(this,c[h],i[h],o);else if(3==r)if(e instanceof u)this.empty(),this.appendChild(e);else{if(!(e instanceof Array))return this.setText(e),this;i instanceof Array?s(this,e,i,null):(this.empty(),n(this,e))}else e instanceof Array&&i instanceof Array?s(this,e,i,null):(this.empty(),n(this,e))}else this.empty(),n(this,e);return this._children=e,this},e.prototype.setStaticChildren=function(e){for(var n=this._children,r=null,i=0,o=t(e),s=o.length;s>i;i++)r=a(this,o[i],n[i],r);return this._children=e,this},e.prototype.content=function(){return this._content||this.children().toArray()},e.prototype.setText=function(t){return t!=this._children&&(this._children=t,this.dom().textContent=null==t||t===!1?"":t),this}})}()},function(t,e){!function(){function t(t,e){return e&&e.indexOf?e.indexOf(t):[].indexOf.call(t,e)}return tag$.SVG.defineTag("svgelement",function(e){e.namespaceURI=function(){return"http://www.w3.org/2000/svg"};var n="circle defs ellipse g line linearGradient mask path pattern polygon polyline radialGradient rect stop svg text tspan".split(" ");e.buildNode=function(){var t=Imba.document().createElementNS(this.namespaceURI(),this._nodeType),e=this._classes.join(" ");return e&&(t.className.baseVal=e),t},e.inherit=function(e){if(e._protoDom=null,t(e._name,n)>=0)return e._nodeType=e._name,e._classes=[];e._nodeType=this._nodeType;var r="_"+e._name.replace(/_/g,"-");return e._classes=this._classes.concat(r)},Imba.attr(e,"x"),Imba.attr(e,"y"),Imba.attr(e,"width"),Imba.attr(e,"height"),Imba.attr(e,"stroke"),Imba.attr(e,"stroke-width")}),tag$.SVG.defineTag("svg",function(t){Imba.attr(t,"viewbox")}),tag$.SVG.defineTag("g"),tag$.SVG.defineTag("defs"),tag$.SVG.defineTag("symbol",function(t){Imba.attr(t,"preserveAspectRatio"),Imba.attr(t,"viewBox")}),tag$.SVG.defineTag("marker",function(t){Imba.attr(t,"markerUnits"),Imba.attr(t,"refX"),Imba.attr(t,"refY"),Imba.attr(t,"markerWidth"),Imba.attr(t,"markerHeight"),Imba.attr(t,"orient")}),tag$.SVG.defineTag("rect",function(t){Imba.attr(t,"rx"),Imba.attr(t,"ry")}),tag$.SVG.defineTag("circle",function(t){Imba.attr(t,"cx"),Imba.attr(t,"cy"),Imba.attr(t,"r")}),tag$.SVG.defineTag("ellipse",function(t){Imba.attr(t,"cx"),Imba.attr(t,"cy"),Imba.attr(t,"rx"),Imba.attr(t,"ry")}),tag$.SVG.defineTag("path",function(t){Imba.attr(t,"d"),Imba.attr(t,"pathLength")}),tag$.SVG.defineTag("line",function(t){Imba.attr(t,"x1"),Imba.attr(t,"x2"),Imba.attr(t,"y1"),Imba.attr(t,"y2")}),tag$.SVG.defineTag("polyline",function(t){Imba.attr(t,"points")}),tag$.SVG.defineTag("polygon",function(t){Imba.attr(t,"points")}),tag$.SVG.defineTag("text",function(t){Imba.attr(t,"dx"),Imba.attr(t,"dy"),Imba.attr(t,"text-anchor"),Imba.attr(t,"rotate"),Imba.attr(t,"textLength"),Imba.attr(t,"lengthAdjust")}),tag$.SVG.defineTag("tspan",function(t){Imba.attr(t,"dx"),Imba.attr(t,"dy"),Imba.attr(t,"rotate"),Imba.attr(t,"textLength"),Imba.attr(t,"lengthAdjust")})}()},function(t,e,n){(function(t){!function(){t=window,Imba={VERSION:"0.14.1",DEBUG:!1};var e=/-./g;return Imba.isClient=function(){return Imba.CLIENT===!0},Imba.isServer=function(){return!1},Imba.subclass=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t.prototype=Object.create(e.prototype),t.__super__=t.prototype.__super__=e.prototype,t.prototype.initialize=t.prototype.constructor=t,t},Imba.iterable=function(t){return t?t.toArray?t.toArray():t:[]},Imba.await=function(t){return t instanceof Array?Promise.all(t):t&&t.then?t:Promise.resolve(t)},Imba.toCamelCase=function(t){return t.replace(e,function(t){return t.charAt(1).toUpperCase()})},Imba.toCamelCase=function(t){return t.replace(e,function(t){return t.charAt(1).toUpperCase()})},Imba.indexOf=function(t,e){return e&&e.indexOf?e.indexOf(t):[].indexOf.call(t,e)},Imba.prop=function(t,e,n){return t.defineProperty?t.defineProperty(e,n):void 0},Imba.attr=function(t,e,n){if(t.defineAttribute)return t.defineAttribute(e,n);var r=Imba.toCamelCase(e),i=Imba.toCamelCase("set-"+e);t.prototype[r]=function(){return this.getAttribute(e)},t.prototype[i]=function(t){return this.setAttribute(e,t),this}}}()}).call(e,function(){return this}())},function(t,e){(function(t){!function(){function e(t,e){return e&&e.indexOf?e.indexOf(t):[].indexOf.call(t,e)}var n;return n||(n=t.requestAnimationFrame),n||(n=t.webkitRequestAnimationFrame),n||(n=t.mozRequestAnimationFrame),n||(n=function(t){return setTimeout(t,1e3/60)}),Imba.tick=function(t){this._scheduled&&n(Imba.ticker()),Imba.Scheduler.willRun(),this.emit(this,"tick",[t]),Imba.Scheduler.didRun()},Imba.ticker=function(){var t=this;return t._ticker||(t._ticker=function(e){return t.tick(e)})},Imba.schedule=function(t,e){return void 0===e&&(e="tick"),this.listen(this,"tick",t,e),this._scheduled||(this._scheduled=!0,n(Imba.ticker())),this},Imba.unschedule=function(t,e){this.unlisten(this,"tick",t,e);var n=this.__listeners__||(this.__listeners__={});return n.tick&&n.tick.next&&n.tick.next.listener||(this._scheduled=!1),this},Imba.setTimeout=function(t,e){return setTimeout(function(){return e(),Imba.Scheduler.markDirty()},t)},Imba.setInterval=function(t,e){return setInterval(function(){return e(),Imba.Scheduler.markDirty()},t)},Imba.clearInterval=function(t){return clearInterval(t)},Imba.clearTimeout=function(t){return clearTimeout(t)},Imba.Scheduler=function(t){var e=this;e._target=t,e._marked=!1,e._active=!1,e._marker=function(){return e.mark()},e._ticker=function(t){return e.tick(t)},e._events=!0,e._fps=1,e._dt=0,e._timestamp=0,e._ticks=0,e._flushes=0},Imba.Scheduler.markDirty=function(){return this._dirty=!0,this},Imba.Scheduler.isDirty=function(){return!!this._dirty},Imba.Scheduler.willRun=function(){return this._active=!0},Imba.Scheduler.didRun=function(){return this._active=!1,this._dirty=!1},Imba.Scheduler.isActive=function(){return!!this._active},Imba.Scheduler.prototype.active=function(){return this._active},Imba.Scheduler.prototype.dt=function(){return this._dt},Imba.Scheduler.prototype.configure=function(t){t&&t.constructor===Object||(t={});var e=void 0!==t.fps?t.fps:1,n=void 0!==t.events?t.events:!0;return null!=n&&(this._events=n),null!=e&&(this._fps=e),this},Imba.Scheduler.prototype.mark=function(){return this._marked=!0,this},Imba.Scheduler.prototype.flush=function(){return this._marked=!1,this._flushes++,this._target.tick(),this},Imba.Scheduler.prototype.tick=function(t){this._ticks++,this._dt=t;var e=this._fps;if(60==e)this._marked=!0;else if(30==e)this._ticks%2&&(this._marked=!0);else if(e){var n=60/e/60*1e3,r=Math.floor(Date.now()/n);this._beat!=r&&(this._beat=r,this._marked=!0)}return(this._marked||this._events&&Imba.Scheduler.isDirty())&&this.flush(),
this},Imba.Scheduler.prototype.activate=function(){return this._active||(this._active=!0,this._commit=this._target.commit,this._target.commit=function(){return this},Imba.schedule(this),this._events&&Imba.listen(Imba,"event",this,"onevent"),this._target&&this._target.flag&&this._target.flag("scheduled_"),this.tick(0)),this},Imba.Scheduler.prototype.deactivate=function(){return this._active&&(this._active=!1,this._target.commit=this._commit,Imba.unschedule(this),Imba.unlisten(Imba,"event",this),this._target&&this._target.unflag&&this._target.unflag("scheduled_")),this},Imba.Scheduler.prototype.track=function(){return this._marker},Imba.Scheduler.prototype.onevent=function(t){var n;return this._marked?this:(this._events instanceof Function?this._events(t)&&this.mark():this._events instanceof Array?e((n=t)&&n.type&&n.type(),this._events)>=0&&this.mark():this._events&&t._responder&&this.mark(),this)},Imba.Scheduler}()}).call(e,function(){return this}())},function(t,e){!function(){function t(t){return t?t.toArray?t.toArray():t:[]}return Imba.Selector=function(e,n,r){if(this._query=e instanceof Imba.Selector?e.query():e,this._context=n,r){for(var i=0,o=t(r),s=o.length,a=[];s>i;i++)a.push(tag$wrap(o[i]));this._nodes=a}return this._lazy=!r,this},Imba.Selector.one=function(t,e){var n=(e||Imba.document()).querySelector(t);return n&&tag$wrap(n)||null},Imba.Selector.all=function(t,e){return new Imba.Selector(t,e)},Imba.Selector.prototype.query=function(t){return this._query},Imba.Selector.prototype.setQuery=function(t){return this._query=t,this},Imba.Selector.prototype.reload=function(){return this._nodes=null,this},Imba.Selector.prototype.scope=function(){var t;return this._scope?this._scope:(t=this._context)?this._scope=t.toScope?t.toScope():t:Imba.document()},Imba.Selector.prototype.first=function(){return this._lazy?tag$wrap(this._first||(this._first=this.scope().querySelector(this.query()))):this.nodes()[0]},Imba.Selector.prototype.last=function(){return this.nodes()[this._nodes.length-1]},Imba.Selector.prototype.nodes=function(){if(this._nodes)return this._nodes;for(var e=this.scope().querySelectorAll(this.query()),n=0,r=t(e),i=r.length,o=[];i>n;n++)o.push(tag$wrap(r[n]));return this._nodes=o,this._lazy=!1,this._nodes},Imba.Selector.prototype.count=function(){return this.nodes().length},Imba.Selector.prototype.len=function(){return this.nodes().length},Imba.Selector.prototype.some=function(){return this.count()>=1},Imba.Selector.prototype.at=function(t){return this.nodes()[t]},Imba.Selector.prototype.forEach=function(t){return this.nodes().forEach(t),this},Imba.Selector.prototype.map=function(t){return this.nodes().map(t)},Imba.Selector.prototype.toArray=function(){return this.nodes()},Imba.Selector.prototype.closest=function(t){return this._nodes=this.map(function(e){return e.closest(t)}),this},Imba.Selector.prototype.siblings=function(t){return this._nodes=this.map(function(e){return e.siblings(t)}),this},Imba.Selector.prototype.find=function(t){return this._nodes=this.__query__(t.query(),this.nodes()),this},Imba.Selector.prototype.reject=function(t){return this.filter(t,!1)},Imba.Selector.prototype.filter=function(t,e){void 0===e&&(e=!0);var n=t instanceof Function&&t||function(e){return e.matches(t)},r=this.nodes().filter(function(t){return n(t)==e});return new Imba.Selector("",this._scope,r)},Imba.Selector.prototype.__query__=function(t,e){for(var n=[],r=0,i=e.length;i>r;)n.push.apply(n,e[r++].querySelectorAll(t));return n},Imba.Selector.prototype.__matches__=function(){return!0},Imba.Selector.prototype.flag=function(t){return this.forEach(function(e){return e.flag(t)})},Imba.Selector.prototype.unflag=function(t){return this.forEach(function(e){return e.unflag(t)})},q$=function(t,e){return new Imba.Selector(t,e)},q$$=function(t,e){var n=(e||Imba.document()).querySelector(t);return n&&tag$wrap(n)||null},tag$.extendTag("element",function(t){t.prototype.querySelectorAll=function(t){return this._dom.querySelectorAll(t)},t.prototype.querySelector=function(t){return this._dom.querySelector(t)},t.prototype.find=function(t){return new Imba.Selector(t,this)}})}()},function(t,e){!function(){function t(t,e){return e&&e.indexOf?e.indexOf(t):[].indexOf.call(t,e)}function e(t,e){for(var n=0,r=Object.keys(e),i=r.length;i>n;n++)null==t[$1=r[n]]?t[$1]=e[r[n]]:t[$1];return t.prototype=Object.create(e.prototype),t.__super__=t.prototype.__super__=e.prototype,t.prototype.initialize=t.prototype.constructor=t,e.inherit&&e.inherit(t),t}function n(){return function(t){return this.setDom(t),this}}function r(t){return function(){return t.build()}}Imba["static"]=function(t,e){return t["static"]=e,t},Imba.Tag=function(t){this.setDom(t)},Imba.Tag.createNode=function(){throw"Not implemented"},Imba.Tag.build=function(){return new this(this.createNode())},Imba.Tag.prototype.object=function(t){return this._object},Imba.Tag.prototype.setObject=function(t){return this._object=t,this},Imba.Tag.prototype.dom=function(){return this._dom},Imba.Tag.prototype.setDom=function(t){return t._tag=this,this._dom=t,this},Imba.Tag.prototype.setRef=function(t,e){return this.flag(this._ref=t),this},Imba.Tag.prototype.setHandler=function(t,e,n){var r="on"+t;if(e instanceof Function)this[r]=e;else if(e instanceof Array){var i=e.shift();this[r]=function(t){return n[i].apply(n,e.concat(t))}}else this[r]=function(t){return n[e](t)};return this},Imba.Tag.prototype.setId=function(t){return this.dom().id=t,this},Imba.Tag.prototype.id=function(){return this.dom().id},Imba.Tag.prototype.setAttribute=function(t,e){var n=this.dom().getAttribute(t);return n==e?e:null!=e&&e!==!1?this.dom().setAttribute(t,e):this.dom().removeAttribute(t)},Imba.Tag.prototype.removeAttribute=function(t){return this.dom().removeAttribute(t)},Imba.Tag.prototype.getAttribute=function(t){return this.dom().getAttribute(t)},Imba.Tag.prototype.setContent=function(t,e){return this.setChildren(t,e),this},Imba.Tag.prototype.setChildren=function(t,e){throw"Not implemented"},Imba.Tag.prototype.text=function(t){return this._dom.textContent},Imba.Tag.prototype.setText=function(t){return this._empty=!1,this._dom.textContent=null==t?t="":t,this},Imba.Tag.prototype.dataset=function(t,e){throw"Not implemented"},Imba.Tag.prototype.render=function(){return this},Imba.Tag.prototype.build=function(){return this.render(),this},Imba.Tag.prototype.commit=function(){return this.render(),this},Imba.Tag.prototype.tick=function(){return this.render(),this},Imba.Tag.prototype.end=function(){return this._built?this.commit():(this._built=!0,this.build()),this},Imba.Tag.prototype.synced=function(){return this},Imba.Tag.prototype.awaken=function(){return this},Imba.Tag.prototype.flags=function(){return this._dom.classList},Imba.Tag.prototype.flag=function(t,e){return 2!=arguments.length||e?this._dom.classList.add(t):this._dom.classList.remove(t),this},Imba.Tag.prototype.unflag=function(t){return this._dom.classList.remove(t),this},Imba.Tag.prototype.toggleFlag=function(t){return this._dom.classList.toggle(t),this},Imba.Tag.prototype.hasFlag=function(t){return this._dom.classList.contains(t)},Imba.Tag.prototype.scheduler=function(){return null==this._scheduler?this._scheduler=new Imba.Scheduler(this):this._scheduler},Imba.Tag.prototype.schedule=function(t){return void 0===t&&(t={}),this.scheduler().configure(t).activate(),this},Imba.Tag.prototype.unschedule=function(){return this._scheduler&&this.scheduler().deactivate(),this},Imba.Tag.prototype.parent=function(){return tag$wrap(this.dom().parentNode)},Imba.Tag.prototype.log=function(){for(var t=arguments,e=t.length,n=new Array(e>0?e:0);e>0;)n[e-1]=t[--e];return n.unshift(console),Function.prototype.call.apply(console.log,n),this},Imba.Tag.prototype.initialize=Imba.Tag,HTML_TAGS="a abbr address area article aside audio b base bdi bdo big blockquote body br button canvas caption cite code col colgroup data datalist dd del details dfn div dl dt em embed fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 head header hr html i iframe img input ins kbd keygen label legend li link main map mark menu menuitem meta meter nav noscript object ol optgroup option output p param pre progress q rp rt ruby s samp script section select small source span strong style sub summary sup table tbody td textarea tfoot th thead time title tr track u ul var video wbr".split(" "),HTML_TAGS_UNSAFE="article aside header section".split(" "),SVG_TAGS="circle defs ellipse g line linearGradient mask path pattern polygon polyline radialGradient rect stop svg text tspan".split(" "),Imba.Tags=function(){},Imba.Tags.prototype.__clone=function(t){var e=Object.create(this);return e._parent=this,e},Imba.Tags.prototype.defineNamespace=function(t){var e=Object.create(this);return e._parent=this,e._ns=t,this[t.toUpperCase()]=e,e},Imba.Tags.prototype.baseType=function(e){return t(e,HTML_TAGS)>=0?"htmlelement":"div"},Imba.Tags.prototype.defineTag=function(t,i,o){void 0==o&&"function"==typeof i&&(o=i,i=""),void 0==i&&(i=""),i||(i=this.baseType(t));var s=this[i],a=n(),u=t.replace(/\-/g,"_");return a._name=t,e(a,s),"#"==t[0]?(this[t]=a,Imba.SINGLETONS[t.slice(1)]=a):(this[t]=a,this["$"+u]=r(a)),o&&(2==o.length&&(a.hasOwnProperty("TAGS")||(a.TAGS=(s.TAGS||this).__clone())),o.call(a,a,a.TAGS||this)),a},Imba.Tags.prototype.defineSingleton=function(t,e,n){return this.defineTag(t,e,n)},Imba.Tags.prototype.extendTag=function(t,e,n){void 0==n&&"function"==typeof e&&(n=e,e=""),void 0==e&&(e="");var r="string"==typeof t||t instanceof String?this[t]:t;return n&&n&&n.call(r,r,r.prototype),r},Imba.TAGS=new Imba.Tags,Imba.TAGS.element=Imba.Tag;var i=Imba.TAGS.defineNamespace("svg");i.baseType=function(t){return"svgelement"},Imba.SINGLETONS={},Imba.defineTag=function(t,e,n){return void 0==n&&"function"==typeof e&&(n=e,e=""),void 0==e&&(e=""),Imba.TAGS.defineTag(t,e,n)},Imba.defineSingletonTag=function(t,e,n){return void 0==n&&"function"==typeof e&&(n=e,e="div"),void 0==e&&(e="div"),Imba.TAGS.defineTag(this.name(),e,n)},Imba.extendTag=function(t,e){return Imba.TAGS.extendTag(t,e)},Imba.tag=function(t){var e=Imba.TAGS[t];if(!e)throw new Error("tag "+t+" is not defined");return new e(e.createNode())},Imba.tagWithId=function(t,e){var n=Imba.TAGS[t];if(!n)throw new Error("tag "+t+" is not defined");var r=n.createNode();return r.id=e,new n(r)},Imba.getTagSingleton=function(t){var e,n,r;return(e=Imba.SINGLETONS[t])?e&&e.Instance?e.Instance:(n=Imba.document().getElementById(t))?(r=e.Instance=new e(n),r.awaken(n),r):(n=e.createNode(),n.id=t,r=e.Instance=new e(n),r.end().awaken(n),r):(n=Imba.document().getElementById(t))?Imba.getTagForDom(n):void 0};var o="undefined"!=typeof SVGElement;return Imba.getTagForDom=function(t){var e;if(!t)return null;if(t._dom)return t;if(t._tag)return t._tag;if(!t.nodeName)return null;var n=null,r=t.id,i=t.nodeName.toLowerCase(),s=Imba.TAGS,a=i,u=t.className;if(r&&Imba.SINGLETONS[r])return Imba.getTagSingleton(r);o&&t instanceof SVGElement&&(n="svg",u=t.className.baseVal,s=s.SVG);var h;return u&&((e=u.match(/\b_([a-z\-]+)\b(?!\s*_[a-z\-]+)/))&&(i=e[1]),(e=u.match(/\b([A-Z\-]+)_\b/))&&(n=e[1])),h=s[i]||s[a],h?new h(t).awaken(t):null},tag$=Imba.TAGS,t$=Imba.tag,tc$=Imba.tagWithFlags,ti$=Imba.tagWithId,tic$=Imba.tagWithIdAndFlags,id$=Imba.getTagSingleton,tag$wrap=Imba.getTagForDom}()},function(t,e){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");e.encode=function(t){if(t>=0&&t<n.length)return n[t];throw new TypeError("Must be between 0 and 63: "+t)},e.decode=function(t){var e=65,n=90,r=97,i=122,o=48,s=57,a=43,u=47,h=26,c=52;return t>=e&&n>=t?t-e:t>=r&&i>=t?t-r+h:t>=o&&s>=t?t-o+c:t==a?62:t==u?63:-1}},function(t,e){function n(t,r,i,o,s,a){var u=Math.floor((r-t)/2)+t,h=s(i,o[u],!0);return 0===h?u:h>0?r-u>1?n(u,r,i,o,s,a):a==e.LEAST_UPPER_BOUND?r<o.length?r:-1:u:u-t>1?n(t,u,i,o,s,a):a==e.LEAST_UPPER_BOUND?u:0>t?-1:t}e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2,e.search=function(t,r,i,o){if(0===r.length)return-1;var s=n(-1,r.length,t,r,i,o||e.GREATEST_LOWER_BOUND);if(0>s)return-1;for(;s-1>=0&&0===i(r[s],r[s-1],!0);)--s;return s}},function(t,e,n){function r(t,e){var n=t.generatedLine,r=e.generatedLine,i=t.generatedColumn,s=e.generatedColumn;return r>n||r==n&&s>=i||o.compareByGeneratedPositionsInflated(t,e)<=0}function i(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}var o=n(4);i.prototype.unsortedForEach=function(t,e){this._array.forEach(t,e)},i.prototype.add=function(t){r(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))},i.prototype.toArray=function(){return this._sorted||(this._array.sort(o.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},e.MappingList=i},function(t,e){function n(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function r(t,e){return Math.round(t+Math.random()*(e-t))}function i(t,e,o,s){if(s>o){var a=r(o,s),u=o-1;n(t,a,s);for(var h=t[s],c=o;s>c;c++)e(t[c],h)<=0&&(u+=1,n(t,u,c));n(t,u+1,c);var p=u+1;i(t,e,o,p-1),i(t,e,p+1,s)}}e.quickSort=function(t,e){i(t,e,0,t.length-1)}},function(t,e,n){function r(t){var e=t;return"string"==typeof t&&(e=JSON.parse(t.replace(/^\)\]\}'/,""))),null!=e.sections?new s(e):new i(e)}function i(t){var e=t;"string"==typeof t&&(e=JSON.parse(t.replace(/^\)\]\}'/,"")));var n=a.getArg(e,"version"),r=a.getArg(e,"sources"),i=a.getArg(e,"names",[]),o=a.getArg(e,"sourceRoot",null),s=a.getArg(e,"sourcesContent",null),u=a.getArg(e,"mappings"),c=a.getArg(e,"file",null);if(n!=this._version)throw new Error("Unsupported version: "+n);r=r.map(a.normalize).map(function(t){return o&&a.isAbsolute(o)&&a.isAbsolute(t)?a.relative(o,t):t}),this._names=h.fromArray(i,!0),this._sources=h.fromArray(r,!0),this.sourceRoot=o,this.sourcesContent=s,this._mappings=u,this.file=c}function o(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function s(t){var e=t;"string"==typeof t&&(e=JSON.parse(t.replace(/^\)\]\}'/,"")));var n=a.getArg(e,"version"),i=a.getArg(e,"sections");if(n!=this._version)throw new Error("Unsupported version: "+n);this._sources=new h,this._names=new h;var o={line:-1,column:0};this._sections=i.map(function(t){if(t.url)throw new Error("Support for url field in sections not implemented.");var e=a.getArg(t,"offset"),n=a.getArg(e,"line"),i=a.getArg(e,"column");if(n<o.line||n===o.line&&i<o.column)throw new Error("Section offsets must be ordered and non-overlapping.");return o=e,{generatedOffset:{generatedLine:n+1,generatedColumn:i+1},consumer:new r(a.getArg(t,"map"))}})}var a=n(4),u=n(66),h=n(11).ArraySet,c=n(12),p=n(68).quickSort;r.fromSourceMap=function(t){return i.fromSourceMap(t)},r.prototype._version=3,r.prototype.__generatedMappings=null,Object.defineProperty(r.prototype,"_generatedMappings",{get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),r.prototype.__originalMappings=null,Object.defineProperty(r.prototype,"_originalMappings",{get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),r.prototype._charIsMappingSeparator=function(t,e){var n=t.charAt(e);return";"===n||","===n},r.prototype._parseMappings=function(t,e){throw new Error("Subclasses must implement _parseMappings")},r.GENERATED_ORDER=1,r.ORIGINAL_ORDER=2,r.GREATEST_LOWER_BOUND=1,r.LEAST_UPPER_BOUND=2,r.prototype.eachMapping=function(t,e,n){var i,o=e||null,s=n||r.GENERATED_ORDER;switch(s){case r.GENERATED_ORDER:i=this._generatedMappings;break;case r.ORIGINAL_ORDER:i=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var u=this.sourceRoot;i.map(function(t){var e=null===t.source?null:this._sources.at(t.source);return null!=e&&null!=u&&(e=a.join(u,e)),{source:e,generatedLine:t.generatedLine,generatedColumn:t.generatedColumn,originalLine:t.originalLine,originalColumn:t.originalColumn,name:null===t.name?null:this._names.at(t.name)}},this).forEach(t,o)},r.prototype.allGeneratedPositionsFor=function(t){var e=a.getArg(t,"line"),n={source:a.getArg(t,"source"),originalLine:e,originalColumn:a.getArg(t,"column",0)};if(null!=this.sourceRoot&&(n.source=a.relative(this.sourceRoot,n.source)),!this._sources.has(n.source))return[];n.source=this._sources.indexOf(n.source);var r=[],i=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",a.compareByOriginalPositions,u.LEAST_UPPER_BOUND);if(i>=0){var o=this._originalMappings[i];if(void 0===t.column)for(var s=o.originalLine;o&&o.originalLine===s;)r.push({line:a.getArg(o,"generatedLine",null),column:a.getArg(o,"generatedColumn",null),lastColumn:a.getArg(o,"lastGeneratedColumn",null)}),o=this._originalMappings[++i];else for(var h=o.originalColumn;o&&o.originalLine===e&&o.originalColumn==h;)r.push({line:a.getArg(o,"generatedLine",null),column:a.getArg(o,"generatedColumn",null),lastColumn:a.getArg(o,"lastGeneratedColumn",null)}),o=this._originalMappings[++i]}return r},e.SourceMapConsumer=r,i.prototype=Object.create(r.prototype),i.prototype.consumer=r,i.fromSourceMap=function(t){var e=Object.create(i.prototype),n=e._names=h.fromArray(t._names.toArray(),!0),r=e._sources=h.fromArray(t._sources.toArray(),!0);e.sourceRoot=t._sourceRoot,e.sourcesContent=t._generateSourcesContent(e._sources.toArray(),e.sourceRoot),e.file=t._file;for(var s=t._mappings.toArray().slice(),u=e.__generatedMappings=[],c=e.__originalMappings=[],l=0,f=s.length;f>l;l++){var d=s[l],g=new o;g.generatedLine=d.generatedLine,g.generatedColumn=d.generatedColumn,d.source&&(g.source=r.indexOf(d.source),g.originalLine=d.originalLine,g.originalColumn=d.originalColumn,d.name&&(g.name=n.indexOf(d.name)),c.push(g)),u.push(g)}return p(e.__originalMappings,a.compareByOriginalPositions),e},i.prototype._version=3,Object.defineProperty(i.prototype,"sources",{get:function(){return this._sources.toArray().map(function(t){return null!=this.sourceRoot?a.join(this.sourceRoot,t):t},this)}}),i.prototype._parseMappings=function(t,e){for(var n,r,i,s,u,h=1,l=0,f=0,d=0,g=0,m=0,y=t.length,_=0,v={},b={},T=[],$=[];y>_;)if(";"===t.charAt(_))h++,_++,l=0;else if(","===t.charAt(_))_++;else{for(n=new o,n.generatedLine=h,s=_;y>s&&!this._charIsMappingSeparator(t,s);s++);if(r=t.slice(_,s),i=v[r])_+=r.length;else{for(i=[];s>_;)c.decode(t,_,b),u=b.value,_=b.rest,i.push(u);if(2===i.length)throw new Error("Found a source, but no line and column");if(3===i.length)throw new Error("Found a source and line, but no column");v[r]=i}n.generatedColumn=l+i[0],l=n.generatedColumn,i.length>1&&(n.source=g+i[1],g+=i[1],n.originalLine=f+i[2],f=n.originalLine,n.originalLine+=1,n.originalColumn=d+i[3],d=n.originalColumn,i.length>4&&(n.name=m+i[4],m+=i[4])),$.push(n),"number"==typeof n.originalLine&&T.push(n)}p($,a.compareByGeneratedPositionsDeflated),this.__generatedMappings=$,p(T,a.compareByOriginalPositions),this.__originalMappings=T},i.prototype._findMapping=function(t,e,n,r,i,o){if(t[n]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[n]);if(t[r]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[r]);return u.search(t,e,i,o)},i.prototype.computeColumnSpans=function(){for(var t=0;t<this._generatedMappings.length;++t){var e=this._generatedMappings[t];if(t+1<this._generatedMappings.length){var n=this._generatedMappings[t+1];if(e.generatedLine===n.generatedLine){e.lastGeneratedColumn=n.generatedColumn-1;continue}}e.lastGeneratedColumn=1/0}},i.prototype.originalPositionFor=function(t){var e={generatedLine:a.getArg(t,"line"),generatedColumn:a.getArg(t,"column")},n=this._findMapping(e,this._generatedMappings,"generatedLine","generatedColumn",a.compareByGeneratedPositionsDeflated,a.getArg(t,"bias",r.GREATEST_LOWER_BOUND));if(n>=0){var i=this._generatedMappings[n];if(i.generatedLine===e.generatedLine){var o=a.getArg(i,"source",null);null!==o&&(o=this._sources.at(o),null!=this.sourceRoot&&(o=a.join(this.sourceRoot,o)));var s=a.getArg(i,"name",null);return null!==s&&(s=this._names.at(s)),{source:o,line:a.getArg(i,"originalLine",null),column:a.getArg(i,"originalColumn",null),name:s}}}return{source:null,line:null,column:null,name:null}},i.prototype.hasContentsOfAllSources=function(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return null==t}):!1},i.prototype.sourceContentFor=function(t,e){if(!this.sourcesContent)return null;if(null!=this.sourceRoot&&(t=a.relative(this.sourceRoot,t)),this._sources.has(t))return this.sourcesContent[this._sources.indexOf(t)];var n;if(null!=this.sourceRoot&&(n=a.urlParse(this.sourceRoot))){var r=t.replace(/^file:\/\//,"");if("file"==n.scheme&&this._sources.has(r))return this.sourcesContent[this._sources.indexOf(r)];if((!n.path||"/"==n.path)&&this._sources.has("/"+t))return this.sourcesContent[this._sources.indexOf("/"+t)]}if(e)return null;throw new Error('"'+t+'" is not in the SourceMap.')},i.prototype.generatedPositionFor=function(t){var e=a.getArg(t,"source");if(null!=this.sourceRoot&&(e=a.relative(this.sourceRoot,e)),!this._sources.has(e))return{line:null,column:null,lastColumn:null};e=this._sources.indexOf(e);var n={source:e,originalLine:a.getArg(t,"line"),originalColumn:a.getArg(t,"column")},i=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",a.compareByOriginalPositions,a.getArg(t,"bias",r.GREATEST_LOWER_BOUND));if(i>=0){var o=this._originalMappings[i];if(o.source===n.source)return{line:a.getArg(o,"generatedLine",null),column:a.getArg(o,"generatedColumn",null),lastColumn:a.getArg(o,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},e.BasicSourceMapConsumer=i,s.prototype=Object.create(r.prototype),s.prototype.constructor=r,s.prototype._version=3,Object.defineProperty(s.prototype,"sources",{get:function(){for(var t=[],e=0;e<this._sections.length;e++)for(var n=0;n<this._sections[e].consumer.sources.length;n++)t.push(this._sections[e].consumer.sources[n]);return t}}),s.prototype.originalPositionFor=function(t){var e={generatedLine:a.getArg(t,"line"),generatedColumn:a.getArg(t,"column")},n=u.search(e,this._sections,function(t,e){var n=t.generatedLine-e.generatedOffset.generatedLine;return n?n:t.generatedColumn-e.generatedOffset.generatedColumn}),r=this._sections[n];return r?r.consumer.originalPositionFor({line:e.generatedLine-(r.generatedOffset.generatedLine-1),column:e.generatedColumn-(r.generatedOffset.generatedLine===e.generatedLine?r.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}},s.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})},s.prototype.sourceContentFor=function(t,e){for(var n=0;n<this._sections.length;n++){var r=this._sections[n],i=r.consumer.sourceContentFor(t,!0);if(i)return i}if(e)return null;throw new Error('"'+t+'" is not in the SourceMap.')},s.prototype.generatedPositionFor=function(t){for(var e=0;e<this._sections.length;e++){var n=this._sections[e];if(-1!==n.consumer.sources.indexOf(a.getArg(t,"source"))){var r=n.consumer.generatedPositionFor(t);if(r){var i={line:r.line+(n.generatedOffset.generatedLine-1),column:r.column+(n.generatedOffset.generatedLine===r.line?n.generatedOffset.generatedColumn-1:0)};return i}}}return{line:null,column:null}},s.prototype._parseMappings=function(t,e){this.__generatedMappings=[],this.__originalMappings=[];for(var n=0;n<this._sections.length;n++)for(var r=this._sections[n],i=r.consumer._generatedMappings,o=0;o<i.length;o++){var s=i[o],u=r.consumer._sources.at(s.source);null!==r.consumer.sourceRoot&&(u=a.join(r.consumer.sourceRoot,u)),this._sources.add(u),u=this._sources.indexOf(u);var h=r.consumer._names.at(s.name);this._names.add(h),h=this._names.indexOf(h);var c={source:u,generatedLine:s.generatedLine+(r.generatedOffset.generatedLine-1),generatedColumn:s.generatedColumn+(r.generatedOffset.generatedLine===s.generatedLine?r.generatedOffset.generatedColumn-1:0),originalLine:s.originalLine,originalColumn:s.originalColumn,name:h};this.__generatedMappings.push(c),"number"==typeof c.originalLine&&this.__originalMappings.push(c)}p(this.__generatedMappings,a.compareByGeneratedPositionsDeflated),p(this.__originalMappings,a.compareByOriginalPositions)},e.IndexedSourceMapConsumer=s},function(t,e,n){function r(t,e,n,r,i){this.children=[],this.sourceContents={},this.line=null==t?null:t,this.column=null==e?null:e,this.source=null==n?null:n,this.name=null==i?null:i,this[u]=!0,null!=r&&this.add(r)}var i=n(13).SourceMapGenerator,o=n(4),s=/(\r?\n)/,a=10,u="$$$isSourceNode$$$";r.fromStringWithSourceMap=function(t,e,n){function i(t,e){if(null===t||void 0===t.source)a.add(e);else{var i=n?o.join(n,t.source):t.source;a.add(new r(t.originalLine,t.originalColumn,i,e,t.name))}}var a=new r,u=t.split(s),h=function(){var t=u.shift(),e=u.shift()||"";return t+e},c=1,p=0,l=null;return e.eachMapping(function(t){if(null!==l){if(!(c<t.generatedLine)){var e=u[0],n=e.substr(0,t.generatedColumn-p);return u[0]=e.substr(t.generatedColumn-p),p=t.generatedColumn,i(l,n),void(l=t)}i(l,h()),c++,p=0}for(;c<t.generatedLine;)a.add(h()),c++;if(p<t.generatedColumn){var e=u[0];a.add(e.substr(0,t.generatedColumn)),u[0]=e.substr(t.generatedColumn),p=t.generatedColumn}l=t},this),u.length>0&&(l&&i(l,h()),a.add(u.join(""))),e.sources.forEach(function(t){var r=e.sourceContentFor(t);null!=r&&(null!=n&&(t=o.join(n,t)),a.setSourceContent(t,r))}),a},r.prototype.add=function(t){if(Array.isArray(t))t.forEach(function(t){this.add(t)},this);else{if(!t[u]&&"string"!=typeof t)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);t&&this.children.push(t)}return this},r.prototype.prepend=function(t){if(Array.isArray(t))for(var e=t.length-1;e>=0;e--)this.prepend(t[e]);else{if(!t[u]&&"string"!=typeof t)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);this.children.unshift(t)}return this},r.prototype.walk=function(t){for(var e,n=0,r=this.children.length;r>n;n++)e=this.children[n],e[u]?e.walk(t):""!==e&&t(e,{source:this.source,line:this.line,column:this.column,name:this.name})},r.prototype.join=function(t){var e,n,r=this.children.length;if(r>0){for(e=[],n=0;r-1>n;n++)e.push(this.children[n]),e.push(t);e.push(this.children[n]),this.children=e}return this},r.prototype.replaceRight=function(t,e){var n=this.children[this.children.length-1];return n[u]?n.replaceRight(t,e):"string"==typeof n?this.children[this.children.length-1]=n.replace(t,e):this.children.push("".replace(t,e)),this},r.prototype.setSourceContent=function(t,e){this.sourceContents[o.toSetString(t)]=e},r.prototype.walkSourceContents=function(t){for(var e=0,n=this.children.length;n>e;e++)this.children[e][u]&&this.children[e].walkSourceContents(t);for(var r=Object.keys(this.sourceContents),e=0,n=r.length;n>e;e++)t(o.fromSetString(r[e]),this.sourceContents[r[e]])},r.prototype.toString=function(){var t="";return this.walk(function(e){t+=e}),t},r.prototype.toStringWithSourceMap=function(t){var e={code:"",line:1,column:0},n=new i(t),r=!1,o=null,s=null,u=null,h=null;return this.walk(function(t,i){e.code+=t,null!==i.source&&null!==i.line&&null!==i.column?((o!==i.source||s!==i.line||u!==i.column||h!==i.name)&&n.addMapping({source:i.source,original:{line:i.line,column:i.column},generated:{line:e.line,column:e.column},name:i.name}),o=i.source,s=i.line,u=i.column,h=i.name,r=!0):r&&(n.addMapping({generated:{line:e.line,column:e.column}}),o=null,r=!1);for(var c=0,p=t.length;p>c;c++)t.charCodeAt(c)===a?(e.line++,e.column=0,c+1===p?(o=null,r=!1):r&&n.addMapping({source:i.source,original:{line:i.line,column:i.column},generated:{line:e.line,column:e.column},name:i.name})):e.column++}),this.walkSourceContents(function(t,e){n.setSourceContent(t,e)}),{code:e.code,map:n}},e.SourceNode=r},function(t,e,n){e.SourceMapGenerator=n(13).SourceMapGenerator,e.SourceMapConsumer=n(69).SourceMapConsumer,e.SourceNode=n(70).SourceNode}]);